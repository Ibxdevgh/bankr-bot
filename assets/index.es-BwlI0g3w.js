const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-NDtl-syI.js","assets/wagmi-DukDWchA.js","assets/react-CvrAlPOO.js","assets/reown-Cxi39rOn.js","assets/core-CNuiOGJ9.js"])))=>i.map(i=>d[i]);
import{_ as _a}from"./wagmi-DukDWchA.js";import{c as fl,a as k,e as mt,C as gl,f as yl,s as br,g as ml,l as Ia,m as vr,I as Di,n as $t,o as wl,p as bl,q as kt,t as Ei,u as ze,v as vl,w as Yr,x as Zr,y as Ts,N as Xr,P as gn,Q as Dl,z as El,A as yn,B as li,D as Pa,E as ut,F as it,G as wt,H as Qe}from"./reown-Cxi39rOn.js";import{g as $a}from"./react-CvrAlPOO.js";function Vi(i,{strict:e=!0}={}){return!i||typeof i!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(i):i.startsWith("0x")}function mn(i){return Vi(i,{strict:!1})?Math.ceil((i.length-2)/2):i.length}const Sa="2.23.2";let Oi={getDocsUrl:({docsBaseUrl:i,docsPath:e="",docsSlug:t})=>e?`${i??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${Sa}`};class Ut extends Error{constructor(e,t={}){var a;const s=(()=>{var c;return t.cause instanceof Ut?t.cause.details:(c=t.cause)!=null&&c.message?t.cause.message:t.details})(),r=t.cause instanceof Ut&&t.cause.docsPath||t.docsPath,n=(a=Oi.getDocsUrl)==null?void 0:a.call(Oi,{...t,docsPath:r}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...s?[`Details: ${s}`]:[],...Oi.version?[`Version: ${Oi.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=r,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=Sa}walk(e){return Ca(this,e)}}function Ca(i,e){return e!=null&&e(i)?i:i&&typeof i=="object"&&"cause"in i&&i.cause!==void 0?Ca(i.cause,e):e?null:i}class Oa extends Ut{constructor({size:e,targetSize:t,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function _i(i,{dir:e,size:t=32}={}){return typeof i=="string"?_l(i,{dir:e,size:t}):Il(i,{dir:e,size:t})}function _l(i,{dir:e,size:t=32}={}){if(t===null)return i;const s=i.replace("0x","");if(s.length>t*2)throw new Oa({size:Math.ceil(s.length/2),targetSize:t,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function Il(i,{dir:e,size:t=32}={}){if(t===null)return i;if(i.length>t)throw new Oa({size:i.length,targetSize:t,type:"bytes"});const s=new Uint8Array(t);for(let r=0;r<t;r++){const n=e==="right";s[n?r:t-r-1]=i[n?r:i.length-r-1]}return s}class Pl extends Ut{constructor({max:e,min:t,signed:s,size:r,value:n}){super(`Number "${n}" is not in safe ${r?`${r*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class $l extends Ut{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Ii(i,{size:e}){if(mn(i)>e)throw new $l({givenSize:mn(i),maxSize:e})}function Dr(i,e={}){const{signed:t}=e;e.size&&Ii(i,{size:e.size});const s=BigInt(i);if(!t)return s;const r=(i.length-2)/2,n=(1n<<BigInt(r)*8n-1n)-1n;return s<=n?s:s-BigInt(`0x${"f".padStart(r*2,"f")}`)-1n}function Sl(i,e={}){return Number(Dr(i,e))}const Cl=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function Er(i,e={}){return typeof i=="number"||typeof i=="bigint"?xa(i,e):typeof i=="string"?xl(i,e):typeof i=="boolean"?Ol(i,e):Aa(i,e)}function Ol(i,e={}){const t=`0x${Number(i)}`;return typeof e.size=="number"?(Ii(t,{size:e.size}),_i(t,{size:e.size})):t}function Aa(i,e={}){let t="";for(let r=0;r<i.length;r++)t+=Cl[i[r]];const s=`0x${t}`;return typeof e.size=="number"?(Ii(s,{size:e.size}),_i(s,{dir:"right",size:e.size})):s}function xa(i,e={}){const{signed:t,size:s}=e,r=BigInt(i);let n;s?t?n=(1n<<BigInt(s)*8n-1n)-1n:n=2n**(BigInt(s)*8n)-1n:typeof i=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&t?-n-1n:0;if(n&&r>n||r<o){const c=typeof i=="bigint"?"n":"";throw new Pl({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:t,size:s,value:`${i}${c}`})}const a=`0x${(t&&r<0?(1n<<BigInt(s*8))+BigInt(r):r).toString(16)}`;return s?_i(a,{size:s}):a}const Al=new TextEncoder;function xl(i,e={}){const t=Al.encode(i);return Aa(t,e)}const Tl=new TextEncoder;function Nl(i,e={}){return typeof i=="number"||typeof i=="bigint"?jl(i,e):typeof i=="boolean"?Rl(i,e):Vi(i)?Ta(i,e):Na(i,e)}function Rl(i,e={}){const t=new Uint8Array(1);return t[0]=Number(i),typeof e.size=="number"?(Ii(t,{size:e.size}),_i(t,{size:e.size})):t}const lt={zero:48,nine:57,A:65,F:70,a:97,f:102};function wn(i){if(i>=lt.zero&&i<=lt.nine)return i-lt.zero;if(i>=lt.A&&i<=lt.F)return i-(lt.A-10);if(i>=lt.a&&i<=lt.f)return i-(lt.a-10)}function Ta(i,e={}){let t=i;e.size&&(Ii(t,{size:e.size}),t=_i(t,{dir:"right",size:e.size}));let s=t.slice(2);s.length%2&&(s=`0${s}`);const r=s.length/2,n=new Uint8Array(r);for(let o=0,a=0;o<r;o++){const c=wn(s.charCodeAt(a++)),l=wn(s.charCodeAt(a++));if(c===void 0||l===void 0)throw new Ut(`Invalid byte sequence ("${s[a-2]}${s[a-1]}" in "${s}").`);n[o]=c*16+l}return n}function jl(i,e){const t=xa(i,e);return Ta(t)}function Na(i,e={}){const t=Tl.encode(i);return typeof e.size=="number"?(Ii(t,{size:e.size}),_i(t,{dir:"right",size:e.size})):t}function Es(i){if(!Number.isSafeInteger(i)||i<0)throw new Error("positive integer expected, got "+i)}function kl(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Ns(i,...e){if(!kl(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error("Uint8Array expected of length "+e+", got length="+i.length)}function YE(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Es(i.outputLen),Es(i.blockLen)}function bn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function ql(i,e){Ns(i);const t=e.outputLen;if(i.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const as=BigInt(2**32-1),vn=BigInt(32);function Ll(i,e=!1){return e?{h:Number(i&as),l:Number(i>>vn&as)}:{h:Number(i>>vn&as)|0,l:Number(i&as)|0}}function Ul(i,e=!1){let t=new Uint32Array(i.length),s=new Uint32Array(i.length);for(let r=0;r<i.length;r++){const{h:n,l:o}=Ll(i[r],e);[t[r],s[r]]=[n,o]}return[t,s]}const Bl=(i,e,t)=>i<<t|e>>>32-t,Ml=(i,e,t)=>e<<t|i>>>32-t,zl=(i,e,t)=>e<<t-32|i>>>64-t,Fl=(i,e,t)=>i<<t-32|e>>>64-t,Ht=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Vl(i){return new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4))}function ZE(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function XE(i,e){return i<<32-e|i>>>e}const Dn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Hl(i){return i<<24&4278190080|i<<8&16711680|i>>>8&65280|i>>>24&255}function En(i){for(let e=0;e<i.length;e++)i[e]=Hl(i[e])}function Kl(i){if(typeof i!="string")throw new Error("utf8ToBytes expected string, got "+typeof i);return new Uint8Array(new TextEncoder().encode(i))}function Ra(i){return typeof i=="string"&&(i=Kl(i)),Ns(i),i}function e0(...i){let e=0;for(let s=0;s<i.length;s++){const r=i[s];Ns(r),e+=r.length}const t=new Uint8Array(e);for(let s=0,r=0;s<i.length;s++){const n=i[s];t.set(n,r),r+=n.length}return t}class Gl{clone(){return this._cloneInto()}}function Wl(i){const e=s=>i().update(Ra(s)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function t0(i=32){if(Ht&&typeof Ht.getRandomValues=="function")return Ht.getRandomValues(new Uint8Array(i));if(Ht&&typeof Ht.randomBytes=="function")return Ht.randomBytes(i);throw new Error("crypto.getRandomValues must be defined")}const ja=[],ka=[],qa=[],Jl=BigInt(0),Ai=BigInt(1),Ql=BigInt(2),Yl=BigInt(7),Zl=BigInt(256),Xl=BigInt(113);for(let i=0,e=Ai,t=1,s=0;i<24;i++){[t,s]=[s,(2*t+3*s)%5],ja.push(2*(5*s+t)),ka.push((i+1)*(i+2)/2%64);let r=Jl;for(let n=0;n<7;n++)e=(e<<Ai^(e>>Yl)*Xl)%Zl,e&Ql&&(r^=Ai<<(Ai<<BigInt(n))-Ai);qa.push(r)}const[eh,th]=Ul(qa,!0),_n=(i,e,t)=>t>32?zl(i,e,t):Bl(i,e,t),In=(i,e,t)=>t>32?Fl(i,e,t):Ml(i,e,t);function ih(i,e=24){const t=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)t[o]=i[o]^i[o+10]^i[o+20]^i[o+30]^i[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],h=t[c+1],p=_n(l,h,1)^t[a],d=In(l,h,1)^t[a+1];for(let b=0;b<50;b+=10)i[o+b]^=p,i[o+b+1]^=d}let r=i[2],n=i[3];for(let o=0;o<24;o++){const a=ka[o],c=_n(r,n,a),l=In(r,n,a),h=ja[o];r=i[h],n=i[h+1],i[h]=c,i[h+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=i[o+a];for(let a=0;a<10;a++)i[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}i[0]^=eh[s],i[1]^=th[s]}t.fill(0)}class en extends Gl{constructor(e,t,s,r=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=s,this.enableXOF=r,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Es(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Vl(this.state)}keccak(){Dn||En(this.state32),ih(this.state32,this.rounds),Dn||En(this.state32),this.posOut=0,this.pos=0}update(e){bn(this);const{blockLen:t,state:s}=this;e=Ra(e);const r=e.length;for(let n=0;n<r;){const o=Math.min(t-this.pos,r-n);for(let a=0;a<o;a++)s[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:s,blockLen:r}=this;e[s]^=t,(t&128)!==0&&s===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){bn(this,!1),Ns(e),this.finish();const t=this.state,{blockLen:s}=this;for(let r=0,n=e.length;r<n;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,n-r);e.set(t.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Es(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ql(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:s,outputLen:r,rounds:n,enableXOF:o}=this;return e||(e=new en(t,s,r,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=s,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}}const sh=(i,e,t)=>Wl(()=>new en(e,i,t)),rh=sh(1,136,256/8);function La(i,e){const t=e||"hex",s=rh(Vi(i,{strict:!1})?Nl(i):i);return t==="bytes"?s:Er(s)}class nh extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}}const Ks=new nh(8192);function oh(i,e){if(Ks.has(`${i}.${e}`))return Ks.get(`${i}.${e}`);const t=i.substring(2).toLowerCase(),s=La(Na(t),"bytes"),r=t.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&r[o]&&(r[o]=r[o].toUpperCase()),(s[o>>1]&15)>=8&&r[o+1]&&(r[o+1]=r[o+1].toUpperCase());const n=`0x${r.join("")}`;return Ks.set(`${i}.${e}`,n),n}function ah(i){const e=La(`0x${i.substring(4)}`).substring(26);return oh(`0x${e}`)}async function ch({hash:i,signature:e}){const t=Vi(i)?i:Er(i),{secp256k1:s}=await _a(async()=>{const{secp256k1:o}=await import("./secp256k1-NDtl-syI.js");return{secp256k1:o}},__vite__mapDeps([0,1,2,3]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:h,v:p,yParity:d}=e,b=Number(d??p),f=Pn(b);return new s.Signature(Dr(l),Dr(h)).addRecoveryBit(f)}const o=Vi(e)?e:Er(e),a=Sl(`0x${o.slice(130)}`),c=Pn(a);return s.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function Pn(i){if(i===0||i===1)return i;if(i===27)return 0;if(i===28)return 1;throw new Error("Invalid yParityOrV value")}async function lh({hash:i,signature:e}){return ah(await ch({hash:i,signature:e}))}function Ua(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function Bi(i,e){e||(e=i.reduce((r,n)=>r+n.length,0));const t=Ua(e);let s=0;for(const r of i)t.set(r,s),s+=r.length;return t}function hh(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var r=0;r<i.length;r++){var n=i.charAt(r),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=r}var a=i.length,c=i.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function p(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var m=0,y=0,E=0,w=f.length;E!==w&&f[E]===0;)E++,m++;for(var P=(w-E)*h+1>>>0,$=new Uint8Array(P);E!==w;){for(var O=f[E],u=0,g=P-1;(O!==0||u<y)&&g!==-1;g--,u++)O+=256*$[g]>>>0,$[g]=O%a>>>0,O=O/a>>>0;if(O!==0)throw new Error("Non-zero carry");y=u,E++}for(var D=P-y;D!==P&&$[D]===0;)D++;for(var _=c.repeat(m);D<P;++D)_+=i.charAt($[D]);return _}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var m=0;if(f[m]!==" "){for(var y=0,E=0;f[m]===c;)y++,m++;for(var w=(f.length-m)*l+1>>>0,P=new Uint8Array(w);f[m];){var $=t[f.charCodeAt(m)];if($===255)return;for(var O=0,u=w-1;($!==0||O<E)&&u!==-1;u--,O++)$+=a*P[u]>>>0,P[u]=$%256>>>0,$=$/256>>>0;if($!==0)throw new Error("Non-zero carry");E=O,m++}if(f[m]!==" "){for(var g=w-E;g!==w&&P[g]===0;)g++;for(var D=new Uint8Array(y+(w-g)),_=y;g!==w;)D[_++]=P[g++];return D}}}function b(f){var m=d(f);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:d,decode:b}}var uh=hh,ph=uh;const dh=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},fh=i=>new TextEncoder().encode(i),gh=i=>new TextDecoder().decode(i);let yh=class{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},mh=class{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ba(this,e)}},wh=class{constructor(e){this.decoders=e}or(e){return Ba(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Ba=(i,e)=>new wh({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});let bh=class{constructor(e,t,s,r){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=r,this.encoder=new yh(e,t,s),this.decoder=new mh(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Rs=({name:i,prefix:e,encode:t,decode:s})=>new bh(i,e,t,s),Qi=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:r}=ph(t,e);return Rs({prefix:i,name:e,encode:s,decode:n=>dh(r(n))})},vh=(i,e,t,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=i.length;for(;i[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,l=0;for(let h=0;h<n;++h){const p=r[i[h]];if(p===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|p,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Dh=(i,e,t)=>{const s=e[e.length-1]==="=",r=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>t;)o-=t,n+=e[r&a>>o];if(o&&(n+=e[r&a<<t-o]),s)for(;n.length*t&7;)n+="=";return n},we=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>Rs({prefix:e,name:i,encode(r){return Dh(r,s,t)},decode(r){return vh(r,s,t,i)}}),Eh=Rs({prefix:"\0",name:"identity",encode:i=>gh(i),decode:i=>fh(i)}),_h=Object.freeze(Object.defineProperty({__proto__:null,identity:Eh},Symbol.toStringTag,{value:"Module"})),Ih=we({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ph=Object.freeze(Object.defineProperty({__proto__:null,base2:Ih},Symbol.toStringTag,{value:"Module"})),$h=we({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Sh=Object.freeze(Object.defineProperty({__proto__:null,base8:$h},Symbol.toStringTag,{value:"Module"})),Ch=Qi({prefix:"9",name:"base10",alphabet:"0123456789"}),Oh=Object.freeze(Object.defineProperty({__proto__:null,base10:Ch},Symbol.toStringTag,{value:"Module"})),Ah=we({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xh=we({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Th=Object.freeze(Object.defineProperty({__proto__:null,base16:Ah,base16upper:xh},Symbol.toStringTag,{value:"Module"})),Nh=we({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Rh=we({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),jh=we({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kh=we({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),qh=we({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Lh=we({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Uh=we({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bh=we({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Mh=we({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),zh=Object.freeze(Object.defineProperty({__proto__:null,base32:Nh,base32hex:qh,base32hexpad:Uh,base32hexpadupper:Bh,base32hexupper:Lh,base32pad:jh,base32padupper:kh,base32upper:Rh,base32z:Mh},Symbol.toStringTag,{value:"Module"})),Fh=Qi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Vh=Qi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Hh=Object.freeze(Object.defineProperty({__proto__:null,base36:Fh,base36upper:Vh},Symbol.toStringTag,{value:"Module"})),Kh=Qi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Gh=Qi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Wh=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Kh,base58flickr:Gh},Symbol.toStringTag,{value:"Module"})),Jh=we({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qh=we({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Yh=we({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Zh=we({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Xh=Object.freeze(Object.defineProperty({__proto__:null,base64:Jh,base64pad:Qh,base64url:Yh,base64urlpad:Zh},Symbol.toStringTag,{value:"Module"})),Ma=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),eu=Ma.reduce((i,e,t)=>(i[t]=e,i),[]),tu=Ma.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function iu(i){return i.reduce((e,t)=>(e+=eu[t],e),"")}function su(i){const e=[];for(const t of i){const s=tu[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const ru=Rs({prefix:"ðŸš€",name:"base256emoji",encode:iu,decode:su}),nu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:ru},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const $n={..._h,...Ph,...Sh,...Oh,...Th,...zh,...Hh,...Wh,...Xh,...nu};function za(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const Sn=za("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),Gs=za("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Ua(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Fa={utf8:Sn,"utf-8":Sn,hex:$n.base16,latin1:Gs,ascii:Gs,binary:Gs,...$n};function Me(i,e="utf8"){const t=Fa[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}function ke(i,e="utf8"){const t=Fa[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}var ou={};const au=":";function di(i){const[e,t]=i.split(au);return{namespace:e,reference:t}}function Cn(i,e=[]){const t=[];return Object.keys(i).forEach(s=>{if(e.length&&!e.includes(s))return;const r=i[s];t.push(...r.accounts)}),t}function Va(i,e){return i.includes(":")?[i]:e.chains||[]}var cu=Object.defineProperty,lu=Object.defineProperties,hu=Object.getOwnPropertyDescriptors,On=Object.getOwnPropertySymbols,uu=Object.prototype.hasOwnProperty,pu=Object.prototype.propertyIsEnumerable,An=(i,e,t)=>e in i?cu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,xn=(i,e)=>{for(var t in e||(e={}))uu.call(e,t)&&An(i,t,e[t]);if(On)for(var t of On(e))pu.call(e,t)&&An(i,t,e[t]);return i},du=(i,e)=>lu(i,hu(e));const fu="ReactNative",je={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},gu="js";function _s(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function St(){return!mt.getDocument()&&!!mt.getNavigator()&&navigator.product===fu}function yu(){return St()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function mu(){return St()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Pi(){return!_s()&&!!mt.getNavigator()&&!!mt.getDocument()}function Yi(){return St()?je.reactNative:_s()?je.node:Pi()?je.browser:je.unknown}function Tn(){var i;try{return St()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(i=global.Application)==null?void 0:i.applicationId:void 0}catch{return}}function wu(i,e){const t=new URLSearchParams(i);for(const s of Object.keys(e).sort())if(e.hasOwnProperty(s)){const r=e[s];r!==void 0&&t.set(s,r)}return t.toString()}function bu(i){var e,t;const s=Ha();try{return i!=null&&i.url&&s.url&&new URL(i.url).host!==new URL(s.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${i.url} differs from the actual page url:${s.url}. This is probably unintended and can lead to issues.`),i.url=s.url),(e=i==null?void 0:i.icons)!=null&&e.length&&i.icons.length>0&&(i.icons=i.icons.filter(r=>r!=="")),du(xn(xn({},s),i),{url:(i==null?void 0:i.url)||s.url,name:(i==null?void 0:i.name)||s.name,description:(i==null?void 0:i.description)||s.description,icons:(t=i==null?void 0:i.icons)!=null&&t.length&&i.icons.length>0?i.icons:s.icons})}catch(r){return console.warn("Error populating app metadata",r),i||s}}function Ha(){return fl.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function vu(){if(Yi()===je.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:s}=global.Platform;return[t,s].join("-")}const i=yl();if(i===null)return"unknown";const e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function Du(){var i;const e=Yi();return e===je.browser?[e,((i=mt.getLocation())==null?void 0:i.host)||"unknown"].join(":"):e}function Ka(i,e,t){const s=vu(),r=Du();return[[i,e].join("-"),[gu,t].join("-"),s,r].join("/")}function Eu({protocol:i,version:e,relayUrl:t,sdkVersion:s,auth:r,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=t.split("?"),h=Ka(i,e,s),p={auth:r,ua:h,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=wu(l[1]||"",p);return l[0]+"?"+d}function qt(i,e){return i.filter(t=>e.includes(t)).length===i.length}function _r(i){return Object.fromEntries(i.entries())}function Ir(i){return new Map(Object.entries(i))}function xt(i=k.FIVE_MINUTES,e){const t=k.toMiliseconds(i||k.FIVE_MINUTES);let s,r,n,o;return{resolve:a=>{n&&s&&(clearTimeout(n),s(a),o=Promise.resolve(a))},reject:a=>{n&&r&&(clearTimeout(n),r(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},t),s=a,r=c})}}function _t(i,e,t){return new Promise(async(s,r)=>{const n=setTimeout(()=>r(new Error(t)),e);try{const o=await i;s(o)}catch(o){r(o)}clearTimeout(n)})}function Ga(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function _u(i){return Ga("topic",i)}function Iu(i){return Ga("id",i)}function Wa(i){const[e,t]=i.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")s.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))s.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return s}function ce(i,e){return k.fromMiliseconds(Date.now()+k.toMiliseconds(i))}function Dt(i){return Date.now()>=k.toMiliseconds(i)}function Q(i,e){return`${i}${e?`:${e}`:""}`}function rt(i=[],e=[]){return[...new Set([...i,...e])]}async function Pu({id:i,topic:e,wcDeepLink:t}){var s;try{if(!t)return;const r=typeof t=="string"?JSON.parse(t):t,n=r==null?void 0:r.href;if(typeof n!="string")return;const o=$u(n,i,e),a=Yi();if(a===je.browser){if(!((s=mt.getDocument())!=null&&s.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Su(o)}else a===je.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(r){console.error(r)}}function $u(i,e,t){const s=`requestId=${e}&sessionTopic=${t}`;i.endsWith("/")&&(i=i.slice(0,-1));let r=`${i}`;if(i.startsWith("https://t.me")){const n=i.includes("?")?"&startapp=":"?startapp=";r=`${r}${n}${xu(s,!0)}`}else r=`${r}/wc?${s}`;return r}function Su(i){let e="_self";Au()?e="_top":(Ou()||i.startsWith("https://")||i.startsWith("http://"))&&(e="_blank"),window.open(i,e,"noreferrer noopener")}async function Cu(i,e){let t="";try{if(Pi()&&(t=localStorage.getItem(e),t))return t;t=await i.getItem(e)}catch(s){console.error(s)}return t}function Nn(i,e){if(!i.includes(e))return null;const t=i.split(/([&,?,=])/),s=t.indexOf(e);return t[s+2]}function Rn(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,i=>{const e=Math.random()*16|0;return(i==="x"?e:e&3|8).toString(16)})}function tn(){return typeof process<"u"&&ou.IS_VITEST==="true"}function Ou(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Au(){try{return window.self!==window.top}catch{return!1}}function xu(i,e=!1){const t=Buffer.from(i).toString("base64");return e?t.replace(/[=]/g,""):t}function Ja(i){return Buffer.from(i,"base64").toString("utf-8")}function Tu(i){return new Promise(e=>setTimeout(e,i))}function Hi(i){if(!Number.isSafeInteger(i)||i<0)throw new Error("positive integer expected, got "+i)}function Nu(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Zi(i,...e){if(!Nu(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error("Uint8Array expected of length "+e+", got length="+i.length)}function sn(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hi(i.outputLen),Hi(i.blockLen)}function fi(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Qa(i,e){Zi(i);const t=e.outputLen;if(i.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const cs=BigInt(2**32-1),jn=BigInt(32);function Ru(i,e=!1){return e?{h:Number(i&cs),l:Number(i>>jn&cs)}:{h:Number(i>>jn&cs)|0,l:Number(i&cs)|0}}function ju(i,e=!1){let t=new Uint32Array(i.length),s=new Uint32Array(i.length);for(let r=0;r<i.length;r++){const{h:n,l:o}=Ru(i[r],e);[t[r],s[r]]=[n,o]}return[t,s]}const ku=(i,e,t)=>i<<t|e>>>32-t,qu=(i,e,t)=>e<<t|i>>>32-t,Lu=(i,e,t)=>e<<t-32|i>>>64-t,Uu=(i,e,t)=>i<<t-32|e>>>64-t,Kt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Bu(i){return new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4))}function Ws(i){return new DataView(i.buffer,i.byteOffset,i.byteLength)}function Ze(i,e){return i<<32-e|i>>>e}const kn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Mu(i){return i<<24&4278190080|i<<8&16711680|i>>>8&65280|i>>>24&255}function qn(i){for(let e=0;e<i.length;e++)i[e]=Mu(i[e])}function zu(i){if(typeof i!="string")throw new Error("utf8ToBytes expected string, got "+typeof i);return new Uint8Array(new TextEncoder().encode(i))}function gi(i){return typeof i=="string"&&(i=zu(i)),Zi(i),i}function Fu(...i){let e=0;for(let s=0;s<i.length;s++){const r=i[s];Zi(r),e+=r.length}const t=new Uint8Array(e);for(let s=0,r=0;s<i.length;s++){const n=i[s];t.set(n,r),r+=n.length}return t}let rn=class{clone(){return this._cloneInto()}};function Ya(i){const e=s=>i().update(gi(s)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function $i(i=32){if(Kt&&typeof Kt.getRandomValues=="function")return Kt.getRandomValues(new Uint8Array(i));if(Kt&&typeof Kt.randomBytes=="function")return Kt.randomBytes(i);throw new Error("crypto.getRandomValues must be defined")}const Za=[],Xa=[],ec=[],Vu=BigInt(0),xi=BigInt(1),Hu=BigInt(2),Ku=BigInt(7),Gu=BigInt(256),Wu=BigInt(113);for(let i=0,e=xi,t=1,s=0;i<24;i++){[t,s]=[s,(2*t+3*s)%5],Za.push(2*(5*s+t)),Xa.push((i+1)*(i+2)/2%64);let r=Vu;for(let n=0;n<7;n++)e=(e<<xi^(e>>Ku)*Wu)%Gu,e&Hu&&(r^=xi<<(xi<<BigInt(n))-xi);ec.push(r)}const[Ju,Qu]=ju(ec,!0),Ln=(i,e,t)=>t>32?Lu(i,e,t):ku(i,e,t),Un=(i,e,t)=>t>32?Uu(i,e,t):qu(i,e,t);function Yu(i,e=24){const t=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)t[o]=i[o]^i[o+10]^i[o+20]^i[o+30]^i[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],h=t[c+1],p=Ln(l,h,1)^t[a],d=Un(l,h,1)^t[a+1];for(let b=0;b<50;b+=10)i[o+b]^=p,i[o+b+1]^=d}let r=i[2],n=i[3];for(let o=0;o<24;o++){const a=Xa[o],c=Ln(r,n,a),l=Un(r,n,a),h=Za[o];r=i[h],n=i[h+1],i[h]=c,i[h+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=i[o+a];for(let a=0;a<10;a++)i[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}i[0]^=Ju[s],i[1]^=Qu[s]}t.fill(0)}let Zu=class tc extends rn{constructor(e,t,s,r=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=s,this.enableXOF=r,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Hi(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Bu(this.state)}keccak(){kn||qn(this.state32),Yu(this.state32,this.rounds),kn||qn(this.state32),this.posOut=0,this.pos=0}update(e){fi(this);const{blockLen:t,state:s}=this;e=gi(e);const r=e.length;for(let n=0;n<r;){const o=Math.min(t-this.pos,r-n);for(let a=0;a<o;a++)s[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:s,blockLen:r}=this;e[s]^=t,(t&128)!==0&&s===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){fi(this,!1),Zi(e),this.finish();const t=this.state,{blockLen:s}=this;for(let r=0,n=e.length;r<n;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,n-r);e.set(t.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Hi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Qa(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:s,outputLen:r,rounds:n,enableXOF:o}=this;return e||(e=new tc(t,s,r,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=s,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Xu=(i,e,t)=>Ya(()=>new Zu(e,i,t)),ep=Xu(1,136,256/8),tp="https://rpc.walletconnect.org/v1";function ic(i){const e=`Ethereum Signed Message:
${i.length}`,t=new TextEncoder().encode(e+i);return"0x"+Buffer.from(ep(t)).toString("hex")}async function ip(i,e,t,s,r,n){switch(t.t){case"eip191":return await sp(i,e,t.s);case"eip1271":return await rp(i,e,t.s,s,r,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function sp(i,e,t){return(await lh({hash:ic(e),signature:t})).toLowerCase()===i.toLowerCase()}async function rp(i,e,t,s,r,n){const o=di(s);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${s}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l="0000000000000000000000000000000000000000000000000000000000000041",h=t.substring(2),p=ic(e).substring(2),d=a+p+c+l+h,b=await fetch(`${n||tp}/?chainId=${s}&projectId=${r}`,{method:"POST",body:JSON.stringify({id:np(),jsonrpc:"2.0",method:"eth_call",params:[{to:i,data:d},"latest"]})}),{result:f}=await b.json();return f?f.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function np(){return Date.now()+Math.floor(Math.random()*1e3)}function op(i){const e=atob(i),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const s=t[0];if(s===0)throw new Error("No signatures found");const r=1+s*64;if(t.length<r)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const n=Buffer.from(i,"base64").slice(1,65);return ml.encode(n)}var ap=Object.defineProperty,cp=Object.defineProperties,lp=Object.getOwnPropertyDescriptors,Bn=Object.getOwnPropertySymbols,hp=Object.prototype.hasOwnProperty,up=Object.prototype.propertyIsEnumerable,Mn=(i,e,t)=>e in i?ap(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pp=(i,e)=>{for(var t in e||(e={}))hp.call(e,t)&&Mn(i,t,e[t]);if(Bn)for(var t of Bn(e))up.call(e,t)&&Mn(i,t,e[t]);return i},dp=(i,e)=>cp(i,lp(e));const fp="did:pkh:",nn=i=>i==null?void 0:i.split(":"),gp=i=>{const e=i&&nn(i);if(e)return i.includes(fp)?e[3]:e[1]},Pr=i=>{const e=i&&nn(i);if(e)return e[2]+":"+e[3]},Is=i=>{const e=i&&nn(i);if(e)return e.pop()};async function zn(i){const{cacao:e,projectId:t}=i,{s,p:r}=e,n=sc(r,r.iss),o=Is(r.iss);return await ip(o,n,s,Pr(r.iss),t)}const sc=(i,e)=>{const t=`${i.domain} wants you to sign in with your Ethereum account:`,s=Is(e);if(!i.aud&&!i.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let r=i.statement||void 0;const n=`URI: ${i.aud||i.uri}`,o=`Version: ${i.version}`,a=`Chain ID: ${gp(e)}`,c=`Nonce: ${i.nonce}`,l=`Issued At: ${i.iat}`,h=i.exp?`Expiration Time: ${i.exp}`:void 0,p=i.nbf?`Not Before: ${i.nbf}`:void 0,d=i.requestId?`Request ID: ${i.requestId}`:void 0,b=i.resources?`Resources:${i.resources.map(m=>`
- ${m}`).join("")}`:void 0,f=ws(i.resources);if(f){const m=Ki(f);r=Ip(r,m)}return[t,s,"",r,"",n,o,a,c,l,h,p,d,b].filter(m=>m!=null).join(`
`)};function yp(i){return Buffer.from(JSON.stringify(i)).toString("base64")}function mp(i){return JSON.parse(Buffer.from(i,"base64").toString("utf-8"))}function Bt(i){if(!i)throw new Error("No recap provided, value is undefined");if(!i.att)throw new Error("No `att` property found");const e=Object.keys(i.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const s=i.att[t];if(Array.isArray(s))throw new Error(`Resource must be an object: ${t}`);if(typeof s!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(s).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(s).forEach(r=>{const n=s[r];if(!Array.isArray(n))throw new Error(`Ability limits ${r} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${r} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${r}) must be an array of objects, found: ${o}`)})})})}function wp(i,e,t,s={}){return t==null||t.sort((r,n)=>r.localeCompare(n)),{att:{[i]:bp(e,t,s)}}}function bp(i,e,t={}){e=e==null?void 0:e.sort((r,n)=>r.localeCompare(n));const s=e.map(r=>({[`${i}/${r}`]:[t]}));return Object.assign({},...s)}function rc(i){return Bt(i),`urn:recap:${yp(i).replace(/=/g,"")}`}function Ki(i){const e=mp(i.replace("urn:recap:",""));return Bt(e),e}function vp(i,e,t){const s=wp(i,e,t);return rc(s)}function Dp(i){return i&&i.includes("urn:recap:")}function Ep(i,e){const t=Ki(i),s=Ki(e),r=_p(t,s);return rc(r)}function _p(i,e){Bt(i),Bt(e);const t=Object.keys(i.att).concat(Object.keys(e.att)).sort((r,n)=>r.localeCompare(n)),s={att:{}};return t.forEach(r=>{var n,o;Object.keys(((n=i.att)==null?void 0:n[r])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[r])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;s.att[r]=dp(pp({},s.att[r]),{[a]:((c=i.att[r])==null?void 0:c[a])||((l=e.att[r])==null?void 0:l[a])})})}),s}function Ip(i="",e){Bt(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(i.includes(t))return i;const s=[];let r=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(p=>({ability:p.split("/")[0],action:p.split("/")[1]}));c.sort((p,d)=>p.action.localeCompare(d.action));const l={};c.forEach(p=>{l[p.ability]||(l[p.ability]=[]),l[p.ability].push(p.action)});const h=Object.keys(l).map(p=>(r++,`(${r}) '${p}': '${l[p].join("', '")}' for '${a}'.`));s.push(h.join(", ").replace(".,","."))});const n=s.join(" "),o=`${t}${n}`;return`${i?i+" ":""}${o}`}function Fn(i){var e;const t=Ki(i);Bt(t);const s=(e=t.att)==null?void 0:e.eip155;return s?Object.keys(s).map(r=>r.split("/")[1]):[]}function Vn(i){const e=Ki(i);Bt(e);const t=[];return Object.values(e.att).forEach(s=>{Object.values(s).forEach(r=>{var n;(n=r==null?void 0:r[0])!=null&&n.chains&&t.push(r[0].chains)})}),[...new Set(t.flat())]}function ws(i){if(!i)return;const e=i==null?void 0:i[i.length-1];return Dp(e)?e:void 0}function Js(i){if(!Number.isSafeInteger(i)||i<0)throw new Error("positive integer expected, got "+i)}function nc(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function Re(i,...e){if(!nc(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error("Uint8Array expected of length "+e+", got length="+i.length)}function Hn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Pp(i,e){Re(i);const t=e.outputLen;if(i.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Kn(i){if(typeof i!="boolean")throw new Error(`boolean expected, not ${i}`)}const It=i=>new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)),$p=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Sp=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Sp)throw new Error("Non little-endian hardware is not supported");function Cp(i){if(typeof i!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(i))}function $r(i){if(typeof i=="string")i=Cp(i);else if(nc(i))i=Sr(i);else throw new Error("Uint8Array expected, got "+typeof i);return i}function Op(i,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(i,e)}function Ap(i,e){if(i.length!==e.length)return!1;let t=0;for(let s=0;s<i.length;s++)t|=i[s]^e[s];return t===0}const xp=(i,e)=>{function t(s,...r){if(Re(s),i.nonceLength!==void 0){const l=r[0];if(!l)throw new Error("nonce / iv required");i.varSizeNonce?Re(l):Re(l,i.nonceLength)}const n=i.tagLength;n&&r[1]!==void 0&&Re(r[1]);const o=e(s,...r),a=(l,h)=>{if(h!==void 0){if(l!==2)throw new Error("cipher output not supported");Re(h)}};let c=!1;return{encrypt(l,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Re(l),a(o.encrypt.length,h),o.encrypt(l,h)},decrypt(l,h){if(Re(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,h),o.decrypt(l,h)}}}return Object.assign(t,i),t};function Gn(i,e,t=!0){if(e===void 0)return new Uint8Array(i);if(e.length!==i)throw new Error("invalid output length, expected "+i+", got: "+e.length);if(t&&!Tp(e))throw new Error("invalid output, must be aligned");return e}function Wn(i,e,t,s){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,s);const r=BigInt(32),n=BigInt(4294967295),o=Number(t>>r&n),a=Number(t&n);i.setUint32(e+4,o,s),i.setUint32(e+0,a,s)}function Tp(i){return i.byteOffset%4===0}function Sr(i){return Uint8Array.from(i)}function yi(...i){for(let e=0;e<i.length;e++)i[e].fill(0)}const oc=i=>Uint8Array.from(i.split("").map(e=>e.charCodeAt(0))),Np=oc("expand 16-byte k"),Rp=oc("expand 32-byte k"),jp=It(Np),kp=It(Rp);function G(i,e){return i<<e|i>>>32-e}function Cr(i){return i.byteOffset%4===0}const ls=64,qp=16,ac=2**32-1,Jn=new Uint32Array;function Lp(i,e,t,s,r,n,o,a){const c=r.length,l=new Uint8Array(ls),h=It(l),p=Cr(r)&&Cr(n),d=p?It(r):Jn,b=p?It(n):Jn;for(let f=0;f<c;o++){if(i(e,t,s,h,o,a),o>=ac)throw new Error("arx: counter overflow");const m=Math.min(ls,c-f);if(p&&m===ls){const y=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let E=0,w;E<qp;E++)w=y+E,b[w]=d[w]^h[E];f+=ls;continue}for(let y=0,E;y<m;y++)E=f+y,n[E]=r[E]^l[y];f+=m}}function Up(i,e){const{allowShortKeys:t,extendNonceFn:s,counterLength:r,counterRight:n,rounds:o}=Op({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof i!="function")throw new Error("core must be a function");return Js(r),Js(o),Kn(n),Kn(t),(a,c,l,h,p=0)=>{Re(a),Re(c),Re(l);const d=l.length;if(h===void 0&&(h=new Uint8Array(d)),Re(h),Js(p),p<0||p>=ac)throw new Error("arx: counter overflow");if(h.length<d)throw new Error(`arx: output (${h.length}) is shorter than data (${d})`);const b=[];let f=a.length,m,y;if(f===32)b.push(m=Sr(a)),y=kp;else if(f===16&&t)m=new Uint8Array(32),m.set(a),m.set(a,16),y=jp,b.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);Cr(c)||b.push(c=Sr(c));const E=It(m);if(s){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(y,E,It(c.subarray(0,16)),E),c=c.subarray(16)}const w=16-r;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const $=new Uint8Array(12);$.set(c,n?0:12-c.length),c=$,b.push(c)}const P=It(c);return Lp(i,y,E,P,l,h,p,o),yi(...b),h}}const fe=(i,e)=>i[e++]&255|(i[e++]&255)<<8;class Bp{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=$r(e),Re(e,32);const t=fe(e,0),s=fe(e,2),r=fe(e,4),n=fe(e,6),o=fe(e,8),a=fe(e,10),c=fe(e,12),l=fe(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|s<<3)&8191,this.r[2]=(s>>>10|r<<6)&7939,this.r[3]=(r>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let h=0;h<8;h++)this.pad[h]=fe(e,16+2*h)}process(e,t,s=!1){const r=s?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],h=o[3],p=o[4],d=o[5],b=o[6],f=o[7],m=o[8],y=o[9],E=fe(e,t+0),w=fe(e,t+2),P=fe(e,t+4),$=fe(e,t+6),O=fe(e,t+8),u=fe(e,t+10),g=fe(e,t+12),D=fe(e,t+14);let _=n[0]+(E&8191),I=n[1]+((E>>>13|w<<3)&8191),S=n[2]+((w>>>10|P<<6)&8191),N=n[3]+((P>>>7|$<<9)&8191),L=n[4]+(($>>>4|O<<12)&8191),v=n[5]+(O>>>1&8191),C=n[6]+((O>>>14|u<<2)&8191),x=n[7]+((u>>>11|g<<5)&8191),q=n[8]+((g>>>8|D<<8)&8191),U=n[9]+(D>>>5|r),T=0,R=T+_*a+I*(5*y)+S*(5*m)+N*(5*f)+L*(5*b);T=R>>>13,R&=8191,R+=v*(5*d)+C*(5*p)+x*(5*h)+q*(5*l)+U*(5*c),T+=R>>>13,R&=8191;let B=T+_*c+I*a+S*(5*y)+N*(5*m)+L*(5*f);T=B>>>13,B&=8191,B+=v*(5*b)+C*(5*d)+x*(5*p)+q*(5*h)+U*(5*l),T+=B>>>13,B&=8191;let M=T+_*l+I*c+S*a+N*(5*y)+L*(5*m);T=M>>>13,M&=8191,M+=v*(5*f)+C*(5*b)+x*(5*d)+q*(5*p)+U*(5*h),T+=M>>>13,M&=8191;let z=T+_*h+I*l+S*c+N*a+L*(5*y);T=z>>>13,z&=8191,z+=v*(5*m)+C*(5*f)+x*(5*b)+q*(5*d)+U*(5*p),T+=z>>>13,z&=8191;let F=T+_*p+I*h+S*l+N*c+L*a;T=F>>>13,F&=8191,F+=v*(5*y)+C*(5*m)+x*(5*f)+q*(5*b)+U*(5*d),T+=F>>>13,F&=8191;let ee=T+_*d+I*p+S*h+N*l+L*c;T=ee>>>13,ee&=8191,ee+=v*a+C*(5*y)+x*(5*m)+q*(5*f)+U*(5*b),T+=ee>>>13,ee&=8191;let V=T+_*b+I*d+S*p+N*h+L*l;T=V>>>13,V&=8191,V+=v*c+C*a+x*(5*y)+q*(5*m)+U*(5*f),T+=V>>>13,V&=8191;let De=T+_*f+I*b+S*d+N*p+L*h;T=De>>>13,De&=8191,De+=v*l+C*c+x*a+q*(5*y)+U*(5*m),T+=De>>>13,De&=8191;let oe=T+_*m+I*f+S*b+N*d+L*p;T=oe>>>13,oe&=8191,oe+=v*h+C*l+x*c+q*a+U*(5*y),T+=oe>>>13,oe&=8191;let ae=T+_*y+I*m+S*f+N*b+L*d;T=ae>>>13,ae&=8191,ae+=v*p+C*h+x*l+q*c+U*a,T+=ae>>>13,ae&=8191,T=(T<<2)+T|0,T=T+R|0,R=T&8191,T=T>>>13,B+=T,n[0]=R,n[1]=B,n[2]=M,n[3]=z,n[4]=F,n[5]=ee,n[6]=V,n[7]=De,n[8]=oe,n[9]=ae}finalize(){const{h:e,pad:t}=this,s=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=r,r=e[a]>>>13,e[a]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,s[0]=e[0]+5,r=s[0]>>>13,s[0]&=8191;for(let a=1;a<10;a++)s[a]=e[a]+r,r=s[a]>>>13,s[a]&=8191;s[9]-=8192;let n=(r^1)-1;for(let a=0;a<10;a++)s[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|s[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;yi(s)}update(e){Hn(this);const{buffer:t,blockLen:s}=this;e=$r(e);const r=e.length;for(let n=0;n<r;){const o=Math.min(s-this.pos,r-n);if(o===s){for(;s<=r-n;n+=s)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===s&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){yi(this.h,this.r,this.buffer,this.pad)}digestInto(e){Hn(this),Pp(e,this),this.finished=!0;const{buffer:t,h:s}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=s[o]>>>0,e[n++]=s[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}}function Mp(i){const e=(s,r)=>i(r).update($r(s)).digest(),t=i(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=s=>i(s),e}const zp=Mp(i=>new Bp(i));function Fp(i,e,t,s,r,n=20){let o=i[0],a=i[1],c=i[2],l=i[3],h=e[0],p=e[1],d=e[2],b=e[3],f=e[4],m=e[5],y=e[6],E=e[7],w=r,P=t[0],$=t[1],O=t[2],u=o,g=a,D=c,_=l,I=h,S=p,N=d,L=b,v=f,C=m,x=y,q=E,U=w,T=P,R=$,B=O;for(let z=0;z<n;z+=2)u=u+I|0,U=G(U^u,16),v=v+U|0,I=G(I^v,12),u=u+I|0,U=G(U^u,8),v=v+U|0,I=G(I^v,7),g=g+S|0,T=G(T^g,16),C=C+T|0,S=G(S^C,12),g=g+S|0,T=G(T^g,8),C=C+T|0,S=G(S^C,7),D=D+N|0,R=G(R^D,16),x=x+R|0,N=G(N^x,12),D=D+N|0,R=G(R^D,8),x=x+R|0,N=G(N^x,7),_=_+L|0,B=G(B^_,16),q=q+B|0,L=G(L^q,12),_=_+L|0,B=G(B^_,8),q=q+B|0,L=G(L^q,7),u=u+S|0,B=G(B^u,16),x=x+B|0,S=G(S^x,12),u=u+S|0,B=G(B^u,8),x=x+B|0,S=G(S^x,7),g=g+N|0,U=G(U^g,16),q=q+U|0,N=G(N^q,12),g=g+N|0,U=G(U^g,8),q=q+U|0,N=G(N^q,7),D=D+L|0,T=G(T^D,16),v=v+T|0,L=G(L^v,12),D=D+L|0,T=G(T^D,8),v=v+T|0,L=G(L^v,7),_=_+I|0,R=G(R^_,16),C=C+R|0,I=G(I^C,12),_=_+I|0,R=G(R^_,8),C=C+R|0,I=G(I^C,7);let M=0;s[M++]=o+u|0,s[M++]=a+g|0,s[M++]=c+D|0,s[M++]=l+_|0,s[M++]=h+I|0,s[M++]=p+S|0,s[M++]=d+N|0,s[M++]=b+L|0,s[M++]=f+v|0,s[M++]=m+C|0,s[M++]=y+x|0,s[M++]=E+q|0,s[M++]=w+U|0,s[M++]=P+T|0,s[M++]=$+R|0,s[M++]=O+B|0}const Vp=Up(Fp,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Hp=new Uint8Array(16),Qn=(i,e)=>{i.update(e);const t=e.length%16;t&&i.update(Hp.subarray(t))},Kp=new Uint8Array(32);function Yn(i,e,t,s,r){const n=i(e,t,Kp),o=zp.create(n);r&&Qn(o,r),Qn(o,s);const a=new Uint8Array(16),c=$p(a);Wn(c,0,BigInt(r?r.length:0),!0),Wn(c,8,BigInt(s.length),!0),o.update(a);const l=o.digest();return yi(n,a),l}const Gp=i=>(e,t,s)=>({encrypt(r,n){const o=r.length;n=Gn(o+16,n,!1),n.set(r);const a=n.subarray(0,-16);i(e,t,a,a,1);const c=Yn(i,e,t,a,s);return n.set(c,o),yi(c),n},decrypt(r,n){n=Gn(r.length-16,n,!1);const o=r.subarray(0,-16),a=r.subarray(-16),c=Yn(i,e,t,o,s);if(!Ap(a,c))throw new Error("invalid tag");return n.set(r.subarray(0,-16)),i(e,t,n,n,1),yi(c),n}}),cc=xp({blockSize:64,nonceLength:12,tagLength:16},Gp(Vp));let lc=class extends rn{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,sn(e);const s=gi(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,n=new Uint8Array(r);n.set(s.length>r?e.create().update(s).digest():s);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return fi(this),this.iHash.update(e),this}digestInto(e){fi(this),Zi(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:s,finished:r,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=s._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const js=(i,e,t)=>new lc(i,e).update(t).digest();js.create=(i,e)=>new lc(i,e);function Wp(i,e,t){return sn(i),t===void 0&&(t=new Uint8Array(i.outputLen)),js(i,gi(t),gi(e))}const Qs=new Uint8Array([0]),Zn=new Uint8Array;function Jp(i,e,t,s=32){if(sn(i),Hi(s),s>255*i.outputLen)throw new Error("Length should be <= 255*HashLen");const r=Math.ceil(s/i.outputLen);t===void 0&&(t=Zn);const n=new Uint8Array(r*i.outputLen),o=js.create(i,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<r;l++)Qs[0]=l+1,a.update(l===0?Zn:c).update(t).update(Qs).digestInto(c),n.set(c,i.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Qs.fill(0),n.slice(0,s)}const Qp=(i,e,t,s,r)=>Jp(i,Wp(i,e,t),s,r);function Yp(i,e,t,s){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,s);const r=BigInt(32),n=BigInt(4294967295),o=Number(t>>r&n),a=Number(t&n),c=s?4:0,l=s?0:4;i.setUint32(e+c,o,s),i.setUint32(e+l,a,s)}function Zp(i,e,t){return i&e^~i&t}function Xp(i,e,t){return i&e^i&t^e&t}let ed=class extends rn{constructor(e,t,s,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ws(this.buffer)}update(e){fi(this);const{view:t,buffer:s,blockLen:r}=this;e=gi(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(r-this.pos,n-o);if(a===r){const c=Ws(e);for(;r<=n-o;o+=r)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fi(this),Qa(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:r,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(s,0),o=0);for(let p=o;p<r;p++)t[p]=0;Yp(s,r-8,BigInt(this.length*8),n),this.process(s,0);const a=Ws(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)a.setUint32(4*p,h[p],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:r,finished:n,destroyed:o,pos:a}=this;return e.length=r,e.pos=a,e.finished=n,e.destroyed=o,r%t&&e.buffer.set(s),e}};const td=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),bt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),vt=new Uint32Array(64);class id extends ed{constructor(){super(64,32,8,!1),this.A=bt[0]|0,this.B=bt[1]|0,this.C=bt[2]|0,this.D=bt[3]|0,this.E=bt[4]|0,this.F=bt[5]|0,this.G=bt[6]|0,this.H=bt[7]|0}get(){const{A:e,B:t,C:s,D:r,E:n,F:o,G:a,H:c}=this;return[e,t,s,r,n,o,a,c]}set(e,t,s,r,n,o,a,c){this.A=e|0,this.B=t|0,this.C=s|0,this.D=r|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let p=0;p<16;p++,t+=4)vt[p]=e.getUint32(t,!1);for(let p=16;p<64;p++){const d=vt[p-15],b=vt[p-2],f=Ze(d,7)^Ze(d,18)^d>>>3,m=Ze(b,17)^Ze(b,19)^b>>>10;vt[p]=m+vt[p-7]+f+vt[p-16]|0}let{A:s,B:r,C:n,D:o,E:a,F:c,G:l,H:h}=this;for(let p=0;p<64;p++){const d=Ze(a,6)^Ze(a,11)^Ze(a,25),b=h+d+Zp(a,c,l)+td[p]+vt[p]|0,f=(Ze(s,2)^Ze(s,13)^Ze(s,22))+Xp(s,r,n)|0;h=l,l=c,c=a,a=o+b|0,o=n,n=r,r=s,s=b+f|0}s=s+this.A|0,r=r+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,h=h+this.H|0,this.set(s,r,n,o,a,c,l,h)}roundClean(){vt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Xi=Ya(()=>new id);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ks=BigInt(0),qs=BigInt(1),sd=BigInt(2);function Mt(i){return i instanceof Uint8Array||ArrayBuffer.isView(i)&&i.constructor.name==="Uint8Array"}function es(i){if(!Mt(i))throw new Error("Uint8Array expected")}function mi(i,e){if(typeof e!="boolean")throw new Error(i+" boolean expected, got "+e)}const rd=Array.from({length:256},(i,e)=>e.toString(16).padStart(2,"0"));function wi(i){es(i);let e="";for(let t=0;t<i.length;t++)e+=rd[i[t]];return e}function hi(i){const e=i.toString(16);return e.length&1?"0"+e:e}function on(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);return i===""?ks:BigInt("0x"+i)}const ht={_0:48,_9:57,A:65,F:70,a:97,f:102};function Xn(i){if(i>=ht._0&&i<=ht._9)return i-ht._0;if(i>=ht.A&&i<=ht.F)return i-(ht.A-10);if(i>=ht.a&&i<=ht.f)return i-(ht.a-10)}function bi(i){if(typeof i!="string")throw new Error("hex string expected, got "+typeof i);const e=i.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(t);for(let r=0,n=0;r<t;r++,n+=2){const o=Xn(i.charCodeAt(n)),a=Xn(i.charCodeAt(n+1));if(o===void 0||a===void 0){const c=i[n]+i[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}s[r]=o*16+a}return s}function Lt(i){return on(wi(i))}function Gi(i){return es(i),on(wi(Uint8Array.from(i).reverse()))}function vi(i,e){return bi(i.toString(16).padStart(e*2,"0"))}function Ls(i,e){return vi(i,e).reverse()}function nd(i){return bi(hi(i))}function Ne(i,e,t){let s;if(typeof e=="string")try{s=bi(e)}catch(n){throw new Error(i+" must be hex string or Uint8Array, cause: "+n)}else if(Mt(e))s=Uint8Array.from(e);else throw new Error(i+" must be hex string or Uint8Array");const r=s.length;if(typeof t=="number"&&r!==t)throw new Error(i+" of length "+t+" expected, got "+r);return s}function Wi(...i){let e=0;for(let s=0;s<i.length;s++){const r=i[s];es(r),e+=r.length}const t=new Uint8Array(e);for(let s=0,r=0;s<i.length;s++){const n=i[s];t.set(n,r),r+=n.length}return t}function od(i,e){if(i.length!==e.length)return!1;let t=0;for(let s=0;s<i.length;s++)t|=i[s]^e[s];return t===0}function ad(i){if(typeof i!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(i))}const Ys=i=>typeof i=="bigint"&&ks<=i;function Us(i,e,t){return Ys(i)&&Ys(e)&&Ys(t)&&e<=i&&i<t}function gt(i,e,t,s){if(!Us(e,t,s))throw new Error("expected valid "+i+": "+t+" <= n < "+s+", got "+e)}function hc(i){let e;for(e=0;i>ks;i>>=qs,e+=1);return e}function cd(i,e){return i>>BigInt(e)&qs}function ld(i,e,t){return i|(t?qs:ks)<<BigInt(e)}const an=i=>(sd<<BigInt(i-1))-qs,Zs=i=>new Uint8Array(i),eo=i=>Uint8Array.from(i);function uc(i,e,t){if(typeof i!="number"||i<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let s=Zs(i),r=Zs(i),n=0;const o=()=>{s.fill(1),r.fill(0),n=0},a=(...h)=>t(r,s,...h),c=(h=Zs())=>{r=a(eo([0]),h),s=a(),h.length!==0&&(r=a(eo([1]),h),s=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){s=a();const d=s.slice();p.push(d),h+=s.length}return Wi(...p)};return(h,p)=>{o(),c(h);let d;for(;!(d=p(l()));)c();return o(),d}}const hd={bigint:i=>typeof i=="bigint",function:i=>typeof i=="function",boolean:i=>typeof i=="boolean",string:i=>typeof i=="string",stringOrUint8Array:i=>typeof i=="string"||Mt(i),isSafeInteger:i=>Number.isSafeInteger(i),array:i=>Array.isArray(i),field:(i,e)=>e.Fp.isValid(i),hash:i=>typeof i=="function"&&Number.isSafeInteger(i.outputLen)};function Si(i,e,t={}){const s=(r,n,o)=>{const a=hd[n];if(typeof a!="function")throw new Error("invalid validator function");const c=i[r];if(!(o&&c===void 0)&&!a(c,i))throw new Error("param "+String(r)+" is invalid. Expected "+n+", got "+c)};for(const[r,n]of Object.entries(e))s(r,n,!1);for(const[r,n]of Object.entries(t))s(r,n,!0);return i}const ud=()=>{throw new Error("not implemented")};function Or(i){const e=new WeakMap;return(t,...s)=>{const r=e.get(t);if(r!==void 0)return r;const n=i(t,...s);return e.set(t,n),n}}var pd=Object.freeze({__proto__:null,isBytes:Mt,abytes:es,abool:mi,bytesToHex:wi,numberToHexUnpadded:hi,hexToNumber:on,hexToBytes:bi,bytesToNumberBE:Lt,bytesToNumberLE:Gi,numberToBytesBE:vi,numberToBytesLE:Ls,numberToVarBytesBE:nd,ensureBytes:Ne,concatBytes:Wi,equalBytes:od,utf8ToBytes:ad,inRange:Us,aInRange:gt,bitLen:hc,bitGet:cd,bitSet:ld,bitMask:an,createHmacDrbg:uc,validateObject:Si,notImplemented:ud,memoized:Or});const de=BigInt(0),se=BigInt(1),Nt=BigInt(2),dd=BigInt(3),Ar=BigInt(4),to=BigInt(5),io=BigInt(8);function Ce(i,e){const t=i%e;return t>=de?t:e+t}function pc(i,e,t){if(e<de)throw new Error("invalid exponent, negatives unsupported");if(t<=de)throw new Error("invalid modulus");if(t===se)return de;let s=se;for(;e>de;)e&se&&(s=s*i%t),i=i*i%t,e>>=se;return s}function Ge(i,e,t){let s=i;for(;e-- >de;)s*=s,s%=t;return s}function xr(i,e){if(i===de)throw new Error("invert: expected non-zero number");if(e<=de)throw new Error("invert: expected positive modulus, got "+e);let t=Ce(i,e),s=e,r=de,n=se;for(;t!==de;){const o=s/t,a=s%t,c=r-n*o;s=t,t=a,r=n,n=c}if(s!==se)throw new Error("invert: does not exist");return Ce(r,e)}function fd(i){const e=(i-se)/Nt;let t,s,r;for(t=i-se,s=0;t%Nt===de;t/=Nt,s++);for(r=Nt;r<i&&pc(r,e,i)!==i-se;r++)if(r>1e3)throw new Error("Cannot find square root: likely non-prime P");if(s===1){const o=(i+se)/Ar;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(t+se)/Nt;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=s,l=o.pow(o.mul(o.ONE,r),t),h=o.pow(a,n),p=o.pow(a,t);for(;!o.eql(p,o.ONE);){if(o.eql(p,o.ZERO))return o.ZERO;let d=1;for(let f=o.sqr(p);d<c&&!o.eql(f,o.ONE);d++)f=o.sqr(f);const b=o.pow(l,se<<BigInt(c-d-1));l=o.sqr(b),h=o.mul(h,b),p=o.mul(p,l),c=d}return h}}function gd(i){if(i%Ar===dd){const e=(i+se)/Ar;return function(t,s){const r=t.pow(s,e);if(!t.eql(t.sqr(r),s))throw new Error("Cannot find square root");return r}}if(i%io===to){const e=(i-to)/io;return function(t,s){const r=t.mul(s,Nt),n=t.pow(r,e),o=t.mul(s,n),a=t.mul(t.mul(o,Nt),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),s))throw new Error("Cannot find square root");return c}}return fd(i)}const yd=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function md(i){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=yd.reduce((s,r)=>(s[r]="function",s),e);return Si(i,t)}function wd(i,e,t){if(t<de)throw new Error("invalid exponent, negatives unsupported");if(t===de)return i.ONE;if(t===se)return e;let s=i.ONE,r=e;for(;t>de;)t&se&&(s=i.mul(s,r)),r=i.sqr(r),t>>=se;return s}function bd(i,e){const t=new Array(e.length),s=e.reduce((n,o,a)=>i.is0(o)?n:(t[a]=n,i.mul(n,o)),i.ONE),r=i.inv(s);return e.reduceRight((n,o,a)=>i.is0(o)?n:(t[a]=i.mul(n,t[a]),i.mul(n,o)),r),t}function dc(i,e){const t=e!==void 0?e:i.toString(2).length,s=Math.ceil(t/8);return{nBitLength:t,nByteLength:s}}function fc(i,e,t=!1,s={}){if(i<=de)throw new Error("invalid field: expected ORDER > 0, got "+i);const{nBitLength:r,nByteLength:n}=dc(i,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:i,isLE:t,BITS:r,BYTES:n,MASK:an(r),ZERO:de,ONE:se,create:c=>Ce(c,i),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return de<=c&&c<i},is0:c=>c===de,isOdd:c=>(c&se)===se,neg:c=>Ce(-c,i),eql:(c,l)=>c===l,sqr:c=>Ce(c*c,i),add:(c,l)=>Ce(c+l,i),sub:(c,l)=>Ce(c-l,i),mul:(c,l)=>Ce(c*l,i),pow:(c,l)=>wd(a,c,l),div:(c,l)=>Ce(c*xr(l,i),i),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>xr(c,i),sqrt:s.sqrt||(c=>(o||(o=gd(i)),o(a,c))),invertBatch:c=>bd(a,c),cmov:(c,l,h)=>h?l:c,toBytes:c=>t?Ls(c,n):vi(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?Gi(c):Lt(c)}});return Object.freeze(a)}function gc(i){if(typeof i!="bigint")throw new Error("field order must be bigint");const e=i.toString(2).length;return Math.ceil(e/8)}function yc(i){const e=gc(i);return e+Math.ceil(e/2)}function vd(i,e,t=!1){const s=i.length,r=gc(e),n=yc(e);if(s<16||s<n||s>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+s);const o=t?Gi(i):Lt(i),a=Ce(o,e-se)+se;return t?Ls(a,r):vi(a,r)}const so=BigInt(0),hs=BigInt(1);function Xs(i,e){const t=e.negate();return i?t:e}function mc(i,e){if(!Number.isSafeInteger(i)||i<=0||i>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+i)}function er(i,e){mc(i,e);const t=Math.ceil(e/i)+1,s=2**(i-1);return{windows:t,windowSize:s}}function Dd(i,e){if(!Array.isArray(i))throw new Error("array expected");i.forEach((t,s)=>{if(!(t instanceof e))throw new Error("invalid point at index "+s)})}function Ed(i,e){if(!Array.isArray(i))throw new Error("array of scalars expected");i.forEach((t,s)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+s)})}const tr=new WeakMap,wc=new WeakMap;function ir(i){return wc.get(i)||1}function _d(i,e){return{constTimeNegate:Xs,hasPrecomputes(t){return ir(t)!==1},unsafeLadder(t,s,r=i.ZERO){let n=t;for(;s>so;)s&hs&&(r=r.add(n)),n=n.double(),s>>=hs;return r},precomputeWindow(t,s){const{windows:r,windowSize:n}=er(s,e),o=[];let a=t,c=a;for(let l=0;l<r;l++){c=a,o.push(c);for(let h=1;h<n;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,s,r){const{windows:n,windowSize:o}=er(t,e);let a=i.ZERO,c=i.BASE;const l=BigInt(2**t-1),h=2**t,p=BigInt(t);for(let d=0;d<n;d++){const b=d*o;let f=Number(r&l);r>>=p,f>o&&(f-=h,r+=hs);const m=b,y=b+Math.abs(f)-1,E=d%2!==0,w=f<0;f===0?c=c.add(Xs(E,s[m])):a=a.add(Xs(w,s[y]))}return{p:a,f:c}},wNAFUnsafe(t,s,r,n=i.ZERO){const{windows:o,windowSize:a}=er(t,e),c=BigInt(2**t-1),l=2**t,h=BigInt(t);for(let p=0;p<o;p++){const d=p*a;if(r===so)break;let b=Number(r&c);if(r>>=h,b>a&&(b-=l,r+=hs),b===0)continue;let f=s[d+Math.abs(b)-1];b<0&&(f=f.negate()),n=n.add(f)}return n},getPrecomputes(t,s,r){let n=tr.get(s);return n||(n=this.precomputeWindow(s,t),t!==1&&tr.set(s,r(n))),n},wNAFCached(t,s,r){const n=ir(t);return this.wNAF(n,this.getPrecomputes(n,t,r),s)},wNAFCachedUnsafe(t,s,r,n){const o=ir(t);return o===1?this.unsafeLadder(t,s,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,r),s,n)},setWindowSize(t,s){mc(s,e),wc.set(t,s),tr.delete(t)}}}function Id(i,e,t,s){if(Dd(t,i),Ed(s,e),t.length!==s.length)throw new Error("arrays of points and scalars must have equal length");const r=i.ZERO,n=hc(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(r),l=Math.floor((e.BITS-1)/o)*o;let h=r;for(let p=l;p>=0;p-=o){c.fill(r);for(let b=0;b<s.length;b++){const f=s[b],m=Number(f>>BigInt(p)&BigInt(a));c[m]=c[m].add(t[b])}let d=r;for(let b=c.length-1,f=r;b>0;b--)f=f.add(c[b]),d=d.add(f);if(h=h.add(d),p!==0)for(let b=0;b<o;b++)h=h.double()}return h}function bc(i){return md(i.Fp),Si(i,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...dc(i.n,i.nBitLength),...i,p:i.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Gt=BigInt(0),sr=BigInt(1);function Pd(i){return Si(i,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...i})}function $d(i){const e=Pd(i),{P:t}=e,s=w=>Ce(w,t),r=e.montgomeryBits,n=Math.ceil(r/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>pc(w,t-BigInt(2),t));function l(w,P,$){const O=s(w*(P-$));return P=s(P-O),$=s($+O),[P,$]}const h=(e.a-BigInt(2))/BigInt(4);function p(w,P){gt("u",w,Gt,t),gt("scalar",P,Gt,t);const $=P,O=w;let u=sr,g=Gt,D=w,_=sr,I=Gt,S;for(let L=BigInt(r-1);L>=Gt;L--){const v=$>>L&sr;I^=v,S=l(I,u,D),u=S[0],D=S[1],S=l(I,g,_),g=S[0],_=S[1],I=v;const C=u+g,x=s(C*C),q=u-g,U=s(q*q),T=x-U,R=D+_,B=D-_,M=s(B*C),z=s(R*q),F=M+z,ee=M-z;D=s(F*F),_=s(O*s(ee*ee)),u=s(x*U),g=s(T*(x+s(h*T)))}S=l(I,u,D),u=S[0],D=S[1],S=l(I,g,_),g=S[0],_=S[1];const N=c(g);return s(u*N)}function d(w){return Ls(s(w),n)}function b(w){const P=Ne("u coordinate",w,n);return o===32&&(P[31]&=127),Gi(P)}function f(w){const P=Ne("scalar",w),$=P.length;if($!==n&&$!==o){let O=""+n+" or "+o;throw new Error("invalid scalar, expected "+O+" bytes, got "+$)}return Gi(a(P))}function m(w,P){const $=b(P),O=f(w),u=p($,O);if(u===Gt)throw new Error("invalid private or public key received");return d(u)}const y=d(e.Gu);function E(w){return m(w,y)}return{scalarMult:m,scalarMultBase:E,getSharedSecret:(w,P)=>m(w,P),getPublicKey:w=>E(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:y}}const Tr=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const Sd=BigInt(1),ro=BigInt(2),Cd=BigInt(3),Od=BigInt(5);BigInt(8);function Ad(i){const e=BigInt(10),t=BigInt(20),s=BigInt(40),r=BigInt(80),n=Tr,o=i*i%n*i%n,a=Ge(o,ro,n)*o%n,c=Ge(a,Sd,n)*i%n,l=Ge(c,Od,n)*c%n,h=Ge(l,e,n)*l%n,p=Ge(h,t,n)*h%n,d=Ge(p,s,n)*p%n,b=Ge(d,r,n)*d%n,f=Ge(b,r,n)*d%n,m=Ge(f,e,n)*l%n;return{pow_p_5_8:Ge(m,ro,n)*i%n,b2:o}}function xd(i){return i[0]&=248,i[31]&=127,i[31]|=64,i}const Nr=$d({P:Tr,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:i=>{const e=Tr,{pow_p_5_8:t,b2:s}=Ad(i);return Ce(Ge(t,Cd,e)*s,e)},adjustScalarBytes:xd,randomBytes:$i});function no(i){i.lowS!==void 0&&mi("lowS",i.lowS),i.prehash!==void 0&&mi("prehash",i.prehash)}function Td(i){const e=bc(i);Si(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:s,a:r}=e;if(t){if(!s.eql(r,s.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Nd,hexToBytes:Rd}=pd;class jd extends Error{constructor(e=""){super(e)}}const dt={Err:jd,_tlv:{encode:(i,e)=>{const{Err:t}=dt;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const s=e.length/2,r=hi(s);if(r.length/2&128)throw new t("tlv.encode: long form length too big");const n=s>127?hi(r.length/2|128):"";return hi(i)+n+r+e},decode(i,e){const{Err:t}=dt;let s=0;if(i<0||i>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[s++]!==i)throw new t("tlv.decode: wrong tlv");const r=e[s++],n=!!(r&128);let o=0;if(!n)o=r;else{const c=r&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(s,s+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const h of l)o=o<<8|h;if(s+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(s,s+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(s+o)}}},_int:{encode(i){const{Err:e}=dt;if(i<ft)throw new e("integer: negative integers are not allowed");let t=hi(i);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(i){const{Err:e}=dt;if(i[0]&128)throw new e("invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Nd(i)}},toSig(i){const{Err:e,_int:t,_tlv:s}=dt,r=typeof i=="string"?Rd(i):i;es(r);const{v:n,l:o}=s.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=s.decode(2,n),{v:l,l:h}=s.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(i){const{_tlv:e,_int:t}=dt,s=e.encode(2,t.encode(i.r)),r=e.encode(2,t.encode(i.s)),n=s+r;return e.encode(48,n)}},ft=BigInt(0),ue=BigInt(1);BigInt(2);const oo=BigInt(3);BigInt(4);function kd(i){const e=Td(i),{Fp:t}=e,s=fc(e.n,e.nBitLength),r=e.toBytes||((m,y,E)=>{const w=y.toAffine();return Wi(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),n=e.fromBytes||(m=>{const y=m.subarray(1),E=t.fromBytes(y.subarray(0,t.BYTES)),w=t.fromBytes(y.subarray(t.BYTES,2*t.BYTES));return{x:E,y:w}});function o(m){const{a:y,b:E}=e,w=t.sqr(m),P=t.mul(w,m);return t.add(t.add(P,t.mul(m,y)),E)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return Us(m,ue,e.n)}function c(m){const{allowedPrivateKeyLengths:y,nByteLength:E,wrapPrivateKey:w,n:P}=e;if(y&&typeof m!="bigint"){if(Mt(m)&&(m=wi(m)),typeof m!="string"||!y.includes(m.length))throw new Error("invalid private key");m=m.padStart(E*2,"0")}let $;try{$=typeof m=="bigint"?m:Lt(Ne("private key",m,E))}catch{throw new Error("invalid private key, expected hex or "+E+" bytes, got "+typeof m)}return w&&($=Ce($,P)),gt("private key",$,ue,P),$}function l(m){if(!(m instanceof d))throw new Error("ProjectivePoint expected")}const h=Or((m,y)=>{const{px:E,py:w,pz:P}=m;if(t.eql(P,t.ONE))return{x:E,y:w};const $=m.is0();y==null&&(y=$?t.ONE:t.inv(P));const O=t.mul(E,y),u=t.mul(w,y),g=t.mul(P,y);if($)return{x:t.ZERO,y:t.ZERO};if(!t.eql(g,t.ONE))throw new Error("invZ was invalid");return{x:O,y:u}}),p=Or(m=>{if(m.is0()){if(e.allowInfinityPoint&&!t.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:y,y:E}=m.toAffine();if(!t.isValid(y)||!t.isValid(E))throw new Error("bad point: x or y not FE");const w=t.sqr(E),P=o(y);if(!t.eql(w,P))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(y,E,w){if(this.px=y,this.py=E,this.pz=w,y==null||!t.isValid(y))throw new Error("x required");if(E==null||!t.isValid(E))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(y){const{x:E,y:w}=y||{};if(!y||!t.isValid(E)||!t.isValid(w))throw new Error("invalid affine point");if(y instanceof d)throw new Error("projective point not allowed");const P=$=>t.eql($,t.ZERO);return P(E)&&P(w)?d.ZERO:new d(E,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const E=t.invertBatch(y.map(w=>w.pz));return y.map((w,P)=>w.toAffine(E[P])).map(d.fromAffine)}static fromHex(y){const E=d.fromAffine(n(Ne("pointHex",y)));return E.assertValidity(),E}static fromPrivateKey(y){return d.BASE.multiply(c(y))}static msm(y,E){return Id(d,s,y,E)}_setWindowSize(y){f.setWindowSize(this,y)}assertValidity(){p(this)}hasEvenY(){const{y}=this.toAffine();if(t.isOdd)return!t.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){l(y);const{px:E,py:w,pz:P}=this,{px:$,py:O,pz:u}=y,g=t.eql(t.mul(E,u),t.mul($,P)),D=t.eql(t.mul(w,u),t.mul(O,P));return g&&D}negate(){return new d(this.px,t.neg(this.py),this.pz)}double(){const{a:y,b:E}=e,w=t.mul(E,oo),{px:P,py:$,pz:O}=this;let u=t.ZERO,g=t.ZERO,D=t.ZERO,_=t.mul(P,P),I=t.mul($,$),S=t.mul(O,O),N=t.mul(P,$);return N=t.add(N,N),D=t.mul(P,O),D=t.add(D,D),u=t.mul(y,D),g=t.mul(w,S),g=t.add(u,g),u=t.sub(I,g),g=t.add(I,g),g=t.mul(u,g),u=t.mul(N,u),D=t.mul(w,D),S=t.mul(y,S),N=t.sub(_,S),N=t.mul(y,N),N=t.add(N,D),D=t.add(_,_),_=t.add(D,_),_=t.add(_,S),_=t.mul(_,N),g=t.add(g,_),S=t.mul($,O),S=t.add(S,S),_=t.mul(S,N),u=t.sub(u,_),D=t.mul(S,I),D=t.add(D,D),D=t.add(D,D),new d(u,g,D)}add(y){l(y);const{px:E,py:w,pz:P}=this,{px:$,py:O,pz:u}=y;let g=t.ZERO,D=t.ZERO,_=t.ZERO;const I=e.a,S=t.mul(e.b,oo);let N=t.mul(E,$),L=t.mul(w,O),v=t.mul(P,u),C=t.add(E,w),x=t.add($,O);C=t.mul(C,x),x=t.add(N,L),C=t.sub(C,x),x=t.add(E,P);let q=t.add($,u);return x=t.mul(x,q),q=t.add(N,v),x=t.sub(x,q),q=t.add(w,P),g=t.add(O,u),q=t.mul(q,g),g=t.add(L,v),q=t.sub(q,g),_=t.mul(I,x),g=t.mul(S,v),_=t.add(g,_),g=t.sub(L,_),_=t.add(L,_),D=t.mul(g,_),L=t.add(N,N),L=t.add(L,N),v=t.mul(I,v),x=t.mul(S,x),L=t.add(L,v),v=t.sub(N,v),v=t.mul(I,v),x=t.add(x,v),N=t.mul(L,x),D=t.add(D,N),N=t.mul(q,x),g=t.mul(C,g),g=t.sub(g,N),N=t.mul(C,L),_=t.mul(q,_),_=t.add(_,N),new d(g,D,_)}subtract(y){return this.add(y.negate())}is0(){return this.equals(d.ZERO)}wNAF(y){return f.wNAFCached(this,y,d.normalizeZ)}multiplyUnsafe(y){const{endo:E,n:w}=e;gt("scalar",y,ft,w);const P=d.ZERO;if(y===ft)return P;if(this.is0()||y===ue)return this;if(!E||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,y,d.normalizeZ);let{k1neg:$,k1:O,k2neg:u,k2:g}=E.splitScalar(y),D=P,_=P,I=this;for(;O>ft||g>ft;)O&ue&&(D=D.add(I)),g&ue&&(_=_.add(I)),I=I.double(),O>>=ue,g>>=ue;return $&&(D=D.negate()),u&&(_=_.negate()),_=new d(t.mul(_.px,E.beta),_.py,_.pz),D.add(_)}multiply(y){const{endo:E,n:w}=e;gt("scalar",y,ue,w);let P,$;if(E){const{k1neg:O,k1:u,k2neg:g,k2:D}=E.splitScalar(y);let{p:_,f:I}=this.wNAF(u),{p:S,f:N}=this.wNAF(D);_=f.constTimeNegate(O,_),S=f.constTimeNegate(g,S),S=new d(t.mul(S.px,E.beta),S.py,S.pz),P=_.add(S),$=I.add(N)}else{const{p:O,f:u}=this.wNAF(y);P=O,$=u}return d.normalizeZ([P,$])[0]}multiplyAndAddUnsafe(y,E,w){const P=d.BASE,$=(u,g)=>g===ft||g===ue||!u.equals(P)?u.multiplyUnsafe(g):u.multiply(g),O=$(this,E).add($(y,w));return O.is0()?void 0:O}toAffine(y){return h(this,y)}isTorsionFree(){const{h:y,isTorsionFree:E}=e;if(y===ue)return!0;if(E)return E(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:E}=e;return y===ue?this:E?E(d,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return mi("isCompressed",y),this.assertValidity(),r(d,this,y)}toHex(y=!0){return mi("isCompressed",y),wi(this.toRawBytes(y))}}d.BASE=new d(e.Gx,e.Gy,t.ONE),d.ZERO=new d(t.ZERO,t.ONE,t.ZERO);const b=e.nBitLength,f=_d(d,e.endo?Math.ceil(b/2):b);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function qd(i){const e=bc(i);return Si(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Ld(i){const e=qd(i),{Fp:t,n:s}=e,r=t.BYTES+1,n=2*t.BYTES+1;function o(v){return Ce(v,s)}function a(v){return xr(v,s)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:p}=kd({...e,toBytes(v,C,x){const q=C.toAffine(),U=t.toBytes(q.x),T=Wi;return mi("isCompressed",x),x?T(Uint8Array.from([C.hasEvenY()?2:3]),U):T(Uint8Array.from([4]),U,t.toBytes(q.y))},fromBytes(v){const C=v.length,x=v[0],q=v.subarray(1);if(C===r&&(x===2||x===3)){const U=Lt(q);if(!Us(U,ue,t.ORDER))throw new Error("Point is not on curve");const T=h(U);let R;try{R=t.sqrt(T)}catch(M){const z=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+z)}const B=(R&ue)===ue;return(x&1)===1!==B&&(R=t.neg(R)),{x:U,y:R}}else if(C===n&&x===4){const U=t.fromBytes(q.subarray(0,t.BYTES)),T=t.fromBytes(q.subarray(t.BYTES,2*t.BYTES));return{x:U,y:T}}else{const U=r,T=n;throw new Error("invalid Point, expected length of "+U+", or uncompressed "+T+", got "+C)}}}),d=v=>wi(vi(v,e.nByteLength));function b(v){const C=s>>ue;return v>C}function f(v){return b(v)?o(-v):v}const m=(v,C,x)=>Lt(v.slice(C,x));class y{constructor(C,x,q){this.r=C,this.s=x,this.recovery=q,this.assertValidity()}static fromCompact(C){const x=e.nByteLength;return C=Ne("compactSignature",C,x*2),new y(m(C,0,x),m(C,x,2*x))}static fromDER(C){const{r:x,s:q}=dt.toSig(Ne("DER",C));return new y(x,q)}assertValidity(){gt("r",this.r,ue,s),gt("s",this.s,ue,s)}addRecoveryBit(C){return new y(this.r,this.s,C)}recoverPublicKey(C){const{r:x,s:q,recovery:U}=this,T=u(Ne("msgHash",C));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const R=U===2||U===3?x+e.n:x;if(R>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const B=(U&1)===0?"02":"03",M=c.fromHex(B+d(R)),z=a(R),F=o(-T*z),ee=o(q*z),V=c.BASE.multiplyAndAddUnsafe(M,F,ee);if(!V)throw new Error("point at infinify");return V.assertValidity(),V}hasHighS(){return b(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return bi(this.toDERHex())}toDERHex(){return dt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return bi(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const E={isValidPrivateKey(v){try{return l(v),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const v=yc(e.n);return vd(e.randomBytes(v),e.n)},precompute(v=8,C=c.BASE){return C._setWindowSize(v),C.multiply(BigInt(3)),C}};function w(v,C=!0){return c.fromPrivateKey(v).toRawBytes(C)}function P(v){const C=Mt(v),x=typeof v=="string",q=(C||x)&&v.length;return C?q===r||q===n:x?q===2*r||q===2*n:v instanceof c}function $(v,C,x=!0){if(P(v))throw new Error("first arg must be private key");if(!P(C))throw new Error("second arg must be public key");return c.fromHex(C).multiply(l(v)).toRawBytes(x)}const O=e.bits2int||function(v){if(v.length>8192)throw new Error("input is too large");const C=Lt(v),x=v.length*8-e.nBitLength;return x>0?C>>BigInt(x):C},u=e.bits2int_modN||function(v){return o(O(v))},g=an(e.nBitLength);function D(v){return gt("num < 2^"+e.nBitLength,v,ft,g),vi(v,e.nByteLength)}function _(v,C,x=I){if(["recovered","canonical"].some(oe=>oe in x))throw new Error("sign() legacy options not supported");const{hash:q,randomBytes:U}=e;let{lowS:T,prehash:R,extraEntropy:B}=x;T==null&&(T=!0),v=Ne("msgHash",v),no(x),R&&(v=Ne("prehashed msgHash",q(v)));const M=u(v),z=l(C),F=[D(z),D(M)];if(B!=null&&B!==!1){const oe=B===!0?U(t.BYTES):B;F.push(Ne("extraEntropy",oe))}const ee=Wi(...F),V=M;function De(oe){const ae=O(oe);if(!p(ae))return;const Ct=a(ae),ot=c.BASE.multiply(ae).toAffine(),Ye=o(ot.x);if(Ye===ft)return;const at=o(Ct*o(V+Ye*z));if(at===ft)return;let ct=(ot.x===Ye?0:2)|Number(ot.y&ue),os=at;return T&&b(at)&&(os=f(at),ct^=1),new y(Ye,os,ct)}return{seed:ee,k2sig:De}}const I={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function N(v,C,x=I){const{seed:q,k2sig:U}=_(v,C,x),T=e;return uc(T.hash.outputLen,T.nByteLength,T.hmac)(q,U)}c.BASE._setWindowSize(8);function L(v,C,x,q=S){var at;const U=v;C=Ne("msgHash",C),x=Ne("publicKey",x);const{lowS:T,prehash:R,format:B}=q;if(no(q),"strict"in q)throw new Error("options.strict was renamed to lowS");if(B!==void 0&&B!=="compact"&&B!=="der")throw new Error("format must be compact or der");const M=typeof U=="string"||Mt(U),z=!M&&!B&&typeof U=="object"&&U!==null&&typeof U.r=="bigint"&&typeof U.s=="bigint";if(!M&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let F,ee;try{if(z&&(F=new y(U.r,U.s)),M){try{B!=="compact"&&(F=y.fromDER(U))}catch(ct){if(!(ct instanceof dt.Err))throw ct}!F&&B!=="der"&&(F=y.fromCompact(U))}ee=c.fromHex(x)}catch{return!1}if(!F||T&&F.hasHighS())return!1;R&&(C=e.hash(C));const{r:V,s:De}=F,oe=u(C),ae=a(De),Ct=o(oe*ae),ot=o(V*ae),Ye=(at=c.BASE.multiplyAndAddUnsafe(ee,Ct,ot))==null?void 0:at.toAffine();return Ye?o(Ye.x)===V:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:$,sign:N,verify:L,ProjectivePoint:c,Signature:y,utils:E}}function Ud(i){return{hash:i,hmac:(e,...t)=>js(i,e,Fu(...t)),randomBytes:$i}}function Bd(i,e){const t=s=>Ld({...i,...Ud(s)});return{...t(e),create:t}}const vc=fc(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Md=vc.create(BigInt("-3")),zd=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fd=Bd({a:Md,b:zd,Fp:vc,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Xi),Dc="base10",Ie="base16",We="base64pad",Et="base64url",ts="utf8",Ec=0,yt=1,is=2,Vd=0,ao=1,Mi=12,cn=32;function Hd(){const i=Nr.utils.randomPrivateKey(),e=Nr.getPublicKey(i);return{privateKey:ke(i,Ie),publicKey:ke(e,Ie)}}function Rr(){const i=$i(cn);return ke(i,Ie)}function Kd(i,e){const t=Nr.getSharedSecret(Me(i,Ie),Me(e,Ie)),s=Qp(Xi,t,void 0,void 0,cn);return ke(s,Ie)}function bs(i){const e=Xi(Me(i,Ie));return ke(e,Ie)}function st(i){const e=Xi(Me(i,ts));return ke(e,Ie)}function _c(i){return Me(`${i}`,Dc)}function zt(i){return Number(ke(i,Dc))}function Ic(i){return i.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Pc(i){const e=i.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function Gd(i){const e=_c(typeof i.type<"u"?i.type:Ec);if(zt(e)===yt&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof i.senderPublicKey<"u"?Me(i.senderPublicKey,Ie):void 0,s=typeof i.iv<"u"?Me(i.iv,Ie):$i(Mi),r=Me(i.symKey,Ie),n=cc(r,s).encrypt(Me(i.message,ts)),o=$c({type:e,sealed:n,iv:s,senderPublicKey:t});return i.encoding===Et?Ic(o):o}function Wd(i){const e=Me(i.symKey,Ie),{sealed:t,iv:s}=Ji({encoded:i.encoded,encoding:i.encoding}),r=cc(e,s).decrypt(t);if(r===null)throw new Error("Failed to decrypt");return ke(r,ts)}function Jd(i,e){const t=_c(is),s=$i(Mi),r=Me(i,ts),n=$c({type:t,sealed:r,iv:s});return e===Et?Ic(n):n}function Qd(i,e){const{sealed:t}=Ji({encoded:i,encoding:e});return ke(t,ts)}function $c(i){if(zt(i.type)===is)return ke(Bi([i.type,i.sealed]),We);if(zt(i.type)===yt){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ke(Bi([i.type,i.senderPublicKey,i.iv,i.sealed]),We)}return ke(Bi([i.type,i.iv,i.sealed]),We)}function Ji(i){const e=(i.encoding||We)===Et?Pc(i.encoded):i.encoded,t=Me(e,We),s=t.slice(Vd,ao),r=ao;if(zt(s)===yt){const c=r+cn,l=c+Mi,h=t.slice(r,c),p=t.slice(c,l),d=t.slice(l);return{type:s,sealed:d,iv:p,senderPublicKey:h}}if(zt(s)===is){const c=t.slice(r),l=$i(Mi);return{type:s,sealed:c,iv:l}}const n=r+Mi,o=t.slice(r,n),a=t.slice(n);return{type:s,sealed:a,iv:o}}function Yd(i,e){const t=Ji({encoded:i,encoding:e==null?void 0:e.encoding});return Sc({type:zt(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ke(t.senderPublicKey,Ie):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Sc(i){const e=(i==null?void 0:i.type)||Ec;if(e===yt){if(typeof(i==null?void 0:i.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(i==null?void 0:i.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i==null?void 0:i.senderPublicKey,receiverPublicKey:i==null?void 0:i.receiverPublicKey}}function co(i){return i.type===yt&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}function lo(i){return i.type===is}function Zd(i){const e=Buffer.from(i.x,"base64"),t=Buffer.from(i.y,"base64");return Bi([new Uint8Array([4]),e,t])}function Xd(i,e){const[t,s,r]=i.split("."),n=Buffer.from(Pc(r),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${s}`,l=Xi(c),h=Zd(e);if(!Fd.verify(Bi([o,a]),l,h))throw new Error("Invalid signature");return br(i).payload}const ef="irn";function Ps(i){return(i==null?void 0:i.relay)||{protocol:ef}}function Li(i){const e=gl[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}function tf(i,e="-"){const t={},s="relay"+e;return Object.keys(i).forEach(r=>{if(r.startsWith(s)){const n=r.replace(s,""),o=i[r];t[n]=o}}),t}function ho(i){if(!i.includes("wc:")){const l=Ja(i);l!=null&&l.includes("wc:")&&(i=l)}i=i.includes("wc://")?i.replace("wc://",""):i,i=i.includes("wc:")?i.replace("wc:",""):i;const e=i.indexOf(":"),t=i.indexOf("?")!==-1?i.indexOf("?"):void 0,s=i.substring(0,e),r=i.substring(e+1,t).split("@"),n=typeof t<"u"?i.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((l,h)=>{a[h]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:s,topic:sf(r[0]),version:parseInt(r[1],10),symKey:a.symKey,relay:tf(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function sf(i){return i.startsWith("//")?i.substring(2):i}function rf(i,e="-"){const t="relay",s={};return Object.keys(i).forEach(r=>{const n=r,o=t+e+n;i[n]&&(s[o]=i[n])}),s}function uo(i){const e=new URLSearchParams,t=rf(i.relay);Object.keys(t).sort().forEach(r=>{e.set(r,t[r])}),e.set("symKey",i.symKey),i.expiryTimestamp&&e.set("expiryTimestamp",i.expiryTimestamp.toString()),i.methods&&e.set("methods",i.methods.join(","));const s=e.toString();return`${i.protocol}:${i.topic}@${i.version}?${s}`}function us(i,e,t){return`${i}?wc_ev=${t}&topic=${e}`}var nf=Object.defineProperty,of=Object.defineProperties,af=Object.getOwnPropertyDescriptors,po=Object.getOwnPropertySymbols,cf=Object.prototype.hasOwnProperty,lf=Object.prototype.propertyIsEnumerable,fo=(i,e,t)=>e in i?nf(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,hf=(i,e)=>{for(var t in e||(e={}))cf.call(e,t)&&fo(i,t,e[t]);if(po)for(var t of po(e))lf.call(e,t)&&fo(i,t,e[t]);return i},uf=(i,e)=>of(i,af(e));function Ci(i){const e=[];return i.forEach(t=>{const[s,r]=t.split(":");e.push(`${s}:${r}`)}),e}function pf(i){const e=[];return Object.values(i).forEach(t=>{e.push(...Ci(t.accounts))}),e}function df(i,e){const t=[];return Object.values(i).forEach(s=>{Ci(s.accounts).includes(e)&&t.push(...s.methods)}),t}function ff(i,e){const t=[];return Object.values(i).forEach(s=>{Ci(s.accounts).includes(e)&&t.push(...s.events)}),t}function Bs(i){return i.includes(":")}function ui(i){return Bs(i)?i.split(":")[0]:i}function go(i){var e,t,s;const r={};if(!Pt(i))return r;for(const[n,o]of Object.entries(i)){const a=Bs(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],h=ui(n);r[h]=uf(hf({},r[h]),{chains:rt(a,(e=r[h])==null?void 0:e.chains),methods:rt(c,(t=r[h])==null?void 0:t.methods),events:rt(l,(s=r[h])==null?void 0:s.events)})}return r}function gf(i){const e={};return i==null||i.forEach(t=>{var s;const[r,n]=t.split(":");e[r]||(e[r]={accounts:[],chains:[],events:[],methods:[]}),e[r].accounts.push(t),(s=e[r].chains)==null||s.push(`${r}:${n}`)}),e}function yo(i,e){e=e.map(s=>s.replace("did:pkh:",""));const t=gf(e);for(const[s,r]of Object.entries(t))r.methods?r.methods=rt(r.methods,i):r.methods=i,r.events=["chainChanged","accountsChanged"];return t}function yf(i,e){var t,s,r,n,o,a;const c=go(i),l=go(e),h={},p=Object.keys(c).concat(Object.keys(l));for(const d of p)h[d]={chains:rt((t=c[d])==null?void 0:t.chains,(s=l[d])==null?void 0:s.chains),methods:rt((r=c[d])==null?void 0:r.methods,(n=l[d])==null?void 0:n.methods),events:rt((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return h}const mf={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},wf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function j(i,e){const{message:t,code:s}=wf[i];return{message:e?`${t} ${e}`:t,code:s}}function Y(i,e){const{message:t,code:s}=mf[i];return{message:e?`${t} ${e}`:t,code:s}}function Je(i,e){return!!Array.isArray(i)}function Pt(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function me(i){return typeof i>"u"}function ne(i,e){return e&&me(i)?!0:typeof i=="string"&&!!i.trim().length}function ln(i,e){return e&&me(i)?!0:typeof i=="number"&&!isNaN(i)}function bf(i,e){const{requiredNamespaces:t}=e,s=Object.keys(i.namespaces),r=Object.keys(t);let n=!0;return qt(r,s)?(s.forEach(o=>{const{accounts:a,methods:c,events:l}=i.namespaces[o],h=Ci(a),p=t[o];(!qt(Va(o,p),h)||!qt(p.methods,c)||!qt(p.events,l))&&(n=!1)}),n):!1}function $s(i){return ne(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function vf(i){if(ne(i,!1)&&i.includes(":")){const e=i.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&$s(t)}}return!1}function Df(i){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(ne(i,!1)){if(e(i))return!0;const t=Ja(i);return e(t)}}catch{}return!1}function Ef(i){var e;return(e=i==null?void 0:i.proposer)==null?void 0:e.publicKey}function _f(i){return i==null?void 0:i.topic}function If(i,e){let t=null;return ne(i==null?void 0:i.publicKey,!1)||(t=j("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function mo(i){let e=!0;return Je(i)?i.length&&(e=i.every(t=>ne(t,!1))):e=!1,e}function Pf(i,e,t){let s=null;return Je(e)&&e.length?e.forEach(r=>{s||$s(r)||(s=Y("UNSUPPORTED_CHAINS",`${t}, chain ${r} should be a string and conform to "namespace:chainId" format`))}):$s(i)||(s=Y("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function $f(i,e,t){let s=null;return Object.entries(i).forEach(([r,n])=>{if(s)return;const o=Pf(r,Va(r,n),`${e} ${t}`);o&&(s=o)}),s}function Sf(i,e){let t=null;return Je(i)?i.forEach(s=>{t||vf(s)||(t=Y("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):t=Y("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Cf(i,e){let t=null;return Object.values(i).forEach(s=>{if(t)return;const r=Sf(s==null?void 0:s.accounts,`${e} namespace`);r&&(t=r)}),t}function Of(i,e){let t=null;return mo(i==null?void 0:i.methods)?mo(i==null?void 0:i.events)||(t=Y("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Y("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function Cc(i,e){let t=null;return Object.values(i).forEach(s=>{if(t)return;const r=Of(s,`${e}, namespace`);r&&(t=r)}),t}function Af(i,e,t){let s=null;if(i&&Pt(i)){const r=Cc(i,e);r&&(s=r);const n=$f(i,e,t);n&&(s=n)}else s=j("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return s}function rr(i,e){let t=null;if(i&&Pt(i)){const s=Cc(i,e);s&&(t=s);const r=Cf(i,e);r&&(t=r)}else t=j("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Oc(i){return ne(i.protocol,!0)}function xf(i,e){let t=!1;return i?i&&Je(i)&&i.length&&i.forEach(s=>{t=Oc(s)}):t=!0,t}function Tf(i){return typeof i=="number"}function Se(i){return typeof i<"u"&&typeof i!==null}function Nf(i){return!(!i||typeof i!="object"||!i.code||!ln(i.code,!1)||!i.message||!ne(i.message,!1))}function Rf(i){return!(me(i)||!ne(i.method,!1))}function jf(i){return!(me(i)||me(i.result)&&me(i.error)||!ln(i.id,!1)||!ne(i.jsonrpc,!1))}function kf(i){return!(me(i)||!ne(i.name,!1))}function wo(i,e){return!(!$s(e)||!pf(i).includes(e))}function qf(i,e,t){return ne(t,!1)?df(i,e).includes(t):!1}function Lf(i,e,t){return ne(t,!1)?ff(i,e).includes(t):!1}function bo(i,e,t){let s=null;const r=Uf(i),n=Bf(e),o=Object.keys(r),a=Object.keys(n),c=vo(Object.keys(i)),l=vo(Object.keys(e)),h=c.filter(p=>!l.includes(p));return h.length&&(s=j("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),qt(o,a)||(s=j("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(p=>{if(!p.includes(":")||s)return;const d=Ci(e[p].accounts);d.includes(p)||(s=j("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${p}
        Required: ${p}
        Approved: ${d.toString()}`))}),o.forEach(p=>{s||(qt(r[p].methods,n[p].methods)?qt(r[p].events,n[p].events)||(s=j("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${p}`)):s=j("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${p}`))}),s}function Uf(i){const e={};return Object.keys(i).forEach(t=>{var s;t.includes(":")?e[t]=i[t]:(s=i[t].chains)==null||s.forEach(r=>{e[r]={methods:i[t].methods,events:i[t].events}})}),e}function vo(i){return[...new Set(i.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Bf(i){const e={};return Object.keys(i).forEach(t=>{if(t.includes(":"))e[t]=i[t];else{const s=Ci(i[t].accounts);s==null||s.forEach(r=>{e[r]={accounts:i[t].accounts.filter(n=>n.includes(`${r}:`)),methods:i[t].methods,events:i[t].events}})}}),e}function Mf(i,e){return ln(i,!1)&&i<=e.max&&i>=e.min}function Do(){const i=Yi();return new Promise(e=>{switch(i){case je.browser:e(zf());break;case je.reactNative:e(Ff());break;case je.node:e(Vf());break;default:e(!0)}})}function zf(){return Pi()&&(navigator==null?void 0:navigator.onLine)}async function Ff(){if(St()&&typeof global<"u"&&global!=null&&global.NetInfo){const i=await(global==null?void 0:global.NetInfo.fetch());return i==null?void 0:i.isConnected}return!0}function Vf(){return!0}function Hf(i){switch(Yi()){case je.browser:Kf(i);break;case je.reactNative:Gf(i);break}}function Kf(i){!St()&&Pi()&&(window.addEventListener("online",()=>i(!0)),window.addEventListener("offline",()=>i(!1)))}function Gf(i){St()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>i(e==null?void 0:e.isConnected)))}function Wf(){var i;return Pi()&&mt.getDocument()?((i=mt.getDocument())==null?void 0:i.visibilityState)==="visible":!0}const nr={};class Ti{static get(e){return nr[e]}static set(e,t){nr[e]=t}static delete(e){delete nr[e]}}var or,Eo;function Jf(){if(Eo)return or;Eo=1;const i=Ia();or=r;const e=O().console||{},t={mapHttpRequest:f,mapHttpResponse:f,wrapRequestSerializer:m,wrapResponseSerializer:m,wrapErrorSerializer:m,req:f,res:f,err:d};function s(u,g){return Array.isArray(u)?u.filter(function(_){return _!=="!stdSerializers.err"}):u===!0?Object.keys(g):!1}function r(u){u=u||{},u.browser=u.browser||{};const g=u.browser.transmit;if(g&&typeof g.send!="function")throw Error("pino: transmit option must have a send function");const D=u.browser.write||e;u.browser.write&&(u.browser.asObject=!0);const _=u.serializers||{},I=s(u.browser.serialize,_);let S=u.browser.serialize;Array.isArray(u.browser.serialize)&&u.browser.serialize.indexOf("!stdSerializers.err")>-1&&(S=!1);const N=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),u.enabled===!1&&(u.level="silent");const L=u.level||"info",v=Object.create(D);v.log||(v.log=y),Object.defineProperty(v,"levelVal",{get:x}),Object.defineProperty(v,"level",{get:q,set:U});const C={transmit:g,serialize:I,asObject:u.browser.asObject,levels:N,timestamp:b(u)};v.levels=r.levels,v.level=L,v.setMaxListeners=v.getMaxListeners=v.emit=v.addListener=v.on=v.prependListener=v.once=v.prependOnceListener=v.removeListener=v.removeAllListeners=v.listeners=v.listenerCount=v.eventNames=v.write=v.flush=y,v.serializers=_,v._serialize=I,v._stdErrSerialize=S,v.child=T,g&&(v._logEvent=p());function x(){return this.level==="silent"?1/0:this.levels.values[this.level]}function q(){return this._level}function U(R){if(R!=="silent"&&!this.levels.values[R])throw Error("unknown level "+R);this._level=R,n(C,v,"error","log"),n(C,v,"fatal","error"),n(C,v,"warn","error"),n(C,v,"info","log"),n(C,v,"debug","log"),n(C,v,"trace","log")}function T(R,B){if(!R)throw new Error("missing bindings for child Pino");B=B||{},I&&R.serializers&&(B.serializers=R.serializers);const M=B.serializers;if(I&&M){var z=Object.assign({},_,M),F=u.browser.serialize===!0?Object.keys(z):I;delete R.serializers,c([R],F,z,this._stdErrSerialize)}function ee(V){this._childLevel=(V._childLevel|0)+1,this.error=l(V,R,"error"),this.fatal=l(V,R,"fatal"),this.warn=l(V,R,"warn"),this.info=l(V,R,"info"),this.debug=l(V,R,"debug"),this.trace=l(V,R,"trace"),z&&(this.serializers=z,this._serialize=F),g&&(this._logEvent=p([].concat(V._logEvent.bindings,R)))}return ee.prototype=this,new ee(this)}return v}r.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},r.stdSerializers=t,r.stdTimeFunctions=Object.assign({},{nullTime:E,epochTime:w,unixTime:P,isoTime:$});function n(u,g,D,_){const I=Object.getPrototypeOf(g);g[D]=g.levelVal>g.levels.values[D]?y:I[D]?I[D]:e[D]||e[_]||y,o(u,g,D)}function o(u,g,D){!u.transmit&&g[D]===y||(g[D]=(function(_){return function(){const S=u.timestamp(),N=new Array(arguments.length),L=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var v=0;v<N.length;v++)N[v]=arguments[v];if(u.serialize&&!u.asObject&&c(N,this._serialize,this.serializers,this._stdErrSerialize),u.asObject?_.call(L,a(this,D,N,S)):_.apply(L,N),u.transmit){const C=u.transmit.level||g.level,x=r.levels.values[C],q=r.levels.values[D];if(q<x)return;h(this,{ts:S,methodLevel:D,methodValue:q,transmitValue:r.levels.values[u.transmit.level||g.level],send:u.transmit.send,val:g.levelVal},N)}}})(g[D]))}function a(u,g,D,_){u._serialize&&c(D,u._serialize,u.serializers,u._stdErrSerialize);const I=D.slice();let S=I[0];const N={};_&&(N.time=_),N.level=r.levels.values[g];let L=(u._childLevel|0)+1;if(L<1&&(L=1),S!==null&&typeof S=="object"){for(;L--&&typeof I[0]=="object";)Object.assign(N,I.shift());S=I.length?i(I.shift(),I):void 0}else typeof S=="string"&&(S=i(I.shift(),I));return S!==void 0&&(N.msg=S),N}function c(u,g,D,_){for(const I in u)if(_&&u[I]instanceof Error)u[I]=r.stdSerializers.err(u[I]);else if(typeof u[I]=="object"&&!Array.isArray(u[I]))for(const S in u[I])g&&g.indexOf(S)>-1&&S in D&&(u[I][S]=D[S](u[I][S]))}function l(u,g,D){return function(){const _=new Array(1+arguments.length);_[0]=g;for(var I=1;I<_.length;I++)_[I]=arguments[I-1];return u[D].apply(this,_)}}function h(u,g,D){const _=g.send,I=g.ts,S=g.methodLevel,N=g.methodValue,L=g.val,v=u._logEvent.bindings;c(D,u._serialize||Object.keys(u.serializers),u.serializers,u._stdErrSerialize===void 0?!0:u._stdErrSerialize),u._logEvent.ts=I,u._logEvent.messages=D.filter(function(C){return v.indexOf(C)===-1}),u._logEvent.level.label=S,u._logEvent.level.value=N,_(S,u._logEvent,L),u._logEvent=p(v)}function p(u){return{ts:0,messages:[],bindings:u||[],level:{label:"",value:0}}}function d(u){const g={type:u.constructor.name,msg:u.message,stack:u.stack};for(const D in u)g[D]===void 0&&(g[D]=u[D]);return g}function b(u){return typeof u.timestamp=="function"?u.timestamp:u.timestamp===!1?E:w}function f(){return{}}function m(u){return u}function y(){}function E(){return!1}function w(){return Date.now()}function P(){return Math.round(Date.now()/1e3)}function $(){return new Date(Date.now()).toISOString()}function O(){function u(g){return typeof g<"u"&&g}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return u(self)||u(window)||u(this)||{}}}return or}var ai=Jf();const Ms=$a(ai),Qf={level:"info"},ss="custom_context",hn=1e3*1024;let Yf=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},_o=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new Yf(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},Ac=class{constructor(e,t=hn){this.level=e??"error",this.levelValue=ai.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new _o(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===ai.levels.values.error?console.error(e):t===ai.levels.values.warn?console.warn(e):t===ai.levels.values.debug?console.debug(e):t===ai.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(vr({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new _o(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(vr({extraMetadata:e})),new Blob(t,{type:"application/json"})}},Zf=class{constructor(e,t=hn){this.baseChunkLogger=new Ac(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),s=document.createElement("a");s.href=t,s.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}},Xf=class{constructor(e,t=hn){this.baseChunkLogger=new Ac(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var eg=Object.defineProperty,tg=Object.defineProperties,ig=Object.getOwnPropertyDescriptors,Io=Object.getOwnPropertySymbols,sg=Object.prototype.hasOwnProperty,rg=Object.prototype.propertyIsEnumerable,Po=(i,e,t)=>e in i?eg(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ss=(i,e)=>{for(var t in e||(e={}))sg.call(e,t)&&Po(i,t,e[t]);if(Io)for(var t of Io(e))rg.call(e,t)&&Po(i,t,e[t]);return i},Cs=(i,e)=>tg(i,ig(e));function un(i){return Cs(Ss({},i),{level:(i==null?void 0:i.level)||Qf.level})}function ng(i,e=ss){return i[e]||""}function og(i,e,t=ss){return i[t]=e,i}function Oe(i,e=ss){let t="";return typeof i.bindings>"u"?t=ng(i,e):t=i.bindings().context||"",t}function ag(i,e,t=ss){const s=Oe(i,t);return s.trim()?`${s}/${e}`:e}function Pe(i,e,t=ss){const s=ag(i,e,t),r=i.child({context:s});return og(r,s,t)}function cg(i){var e,t;const s=new Zf((e=i.opts)==null?void 0:e.level,i.maxSizeInBytes);return{logger:Ms(Cs(Ss({},i.opts),{level:"trace",browser:Cs(Ss({},(t=i.opts)==null?void 0:t.browser),{write:r=>s.write(r)})})),chunkLoggerController:s}}function lg(i){var e;const t=new Xf((e=i.opts)==null?void 0:e.level,i.maxSizeInBytes);return{logger:Ms(Cs(Ss({},i.opts),{level:"trace"}),t),chunkLoggerController:t}}function hg(i){return typeof i.loggerOverride<"u"&&typeof i.loggerOverride!="string"?{logger:i.loggerOverride,chunkLoggerController:null}:typeof window<"u"?cg(i):lg(i)}var ug=Object.defineProperty,pg=(i,e,t)=>e in i?ug(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$o=(i,e,t)=>pg(i,typeof e!="symbol"?e+"":e,t);let dg=class extends Di{constructor(e){super(),this.opts=e,$o(this,"protocol","wc"),$o(this,"version",2)}};var fg=Object.defineProperty,gg=(i,e,t)=>e in i?fg(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,yg=(i,e,t)=>gg(i,e+"",t);let mg=class extends Di{constructor(e,t){super(),this.core=e,this.logger=t,yg(this,"records",new Map)}},wg=class{constructor(e,t){this.logger=e,this.core=t}};class bg extends Di{constructor(e,t){super(),this.relayer=e,this.logger=t}}let vg=class extends Di{constructor(e){super()}},Dg=class{constructor(e,t,s,r){this.core=e,this.logger=t,this.name=s}},Eg=class extends Di{constructor(e,t){super(),this.relayer=e,this.logger=t}},_g=class extends Di{constructor(e,t){super(),this.core=e,this.logger=t}},Ig=class{constructor(e,t,s){this.core=e,this.logger=t,this.store=s}},Pg=class{constructor(e,t){this.projectId=e,this.logger=t}},$g=class{constructor(e,t,s){this.core=e,this.logger=t,this.telemetryEnabled=s}};var Sg=Object.defineProperty,Cg=(i,e,t)=>e in i?Sg(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,So=(i,e,t)=>Cg(i,typeof e!="symbol"?e+"":e,t);let Og=class{constructor(e){this.opts=e,So(this,"protocol","wc"),So(this,"version",2)}},Ag=class{constructor(e){this.client=e}};function xg(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function Tg(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var r=0;r<i.length;r++){var n=i.charAt(r),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=r}var a=i.length,c=i.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function p(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var m=0,y=0,E=0,w=f.length;E!==w&&f[E]===0;)E++,m++;for(var P=(w-E)*h+1>>>0,$=new Uint8Array(P);E!==w;){for(var O=f[E],u=0,g=P-1;(O!==0||u<y)&&g!==-1;g--,u++)O+=256*$[g]>>>0,$[g]=O%a>>>0,O=O/a>>>0;if(O!==0)throw new Error("Non-zero carry");y=u,E++}for(var D=P-y;D!==P&&$[D]===0;)D++;for(var _=c.repeat(m);D<P;++D)_+=i.charAt($[D]);return _}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var m=0;if(f[m]!==" "){for(var y=0,E=0;f[m]===c;)y++,m++;for(var w=(f.length-m)*l+1>>>0,P=new Uint8Array(w);f[m];){var $=t[f.charCodeAt(m)];if($===255)return;for(var O=0,u=w-1;($!==0||O<E)&&u!==-1;u--,O++)$+=a*P[u]>>>0,P[u]=$%256>>>0,$=$/256>>>0;if($!==0)throw new Error("Non-zero carry");E=O,m++}if(f[m]!==" "){for(var g=w-E;g!==w&&P[g]===0;)g++;for(var D=new Uint8Array(y+(w-g)),_=y;g!==w;)D[_++]=P[g++];return D}}}function b(f){var m=d(f);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:d,decode:b}}var Ng=Tg,Rg=Ng;const jg=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},kg=i=>new TextEncoder().encode(i),qg=i=>new TextDecoder().decode(i);class Lg{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ug{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xc(this,e)}}class Bg{constructor(e){this.decoders=e}or(e){return xc(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const xc=(i,e)=>new Bg({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class Mg{constructor(e,t,s,r){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=r,this.encoder=new Lg(e,t,s),this.decoder=new Ug(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const zs=({name:i,prefix:e,encode:t,decode:s})=>new Mg(i,e,t,s),rs=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:r}=Rg(t,e);return zs({prefix:i,name:e,encode:s,decode:n=>jg(r(n))})},zg=(i,e,t,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=i.length;for(;i[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,l=0;for(let h=0;h<n;++h){const p=r[i[h]];if(p===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|p,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Fg=(i,e,t)=>{const s=e[e.length-1]==="=",r=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>t;)o-=t,n+=e[r&a>>o];if(o&&(n+=e[r&a<<t-o]),s)for(;n.length*t&7;)n+="=";return n},be=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>zs({prefix:e,name:i,encode(r){return Fg(r,s,t)},decode(r){return zg(r,s,t,i)}}),Vg=zs({prefix:"\0",name:"identity",encode:i=>qg(i),decode:i=>kg(i)}),Hg=Object.freeze(Object.defineProperty({__proto__:null,identity:Vg},Symbol.toStringTag,{value:"Module"})),Kg=be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Gg=Object.freeze(Object.defineProperty({__proto__:null,base2:Kg},Symbol.toStringTag,{value:"Module"})),Wg=be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Jg=Object.freeze(Object.defineProperty({__proto__:null,base8:Wg},Symbol.toStringTag,{value:"Module"})),Qg=rs({prefix:"9",name:"base10",alphabet:"0123456789"}),Yg=Object.freeze(Object.defineProperty({__proto__:null,base10:Qg},Symbol.toStringTag,{value:"Module"})),Zg=be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Xg=be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ey=Object.freeze(Object.defineProperty({__proto__:null,base16:Zg,base16upper:Xg},Symbol.toStringTag,{value:"Module"})),ty=be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),iy=be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sy=be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ry=be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ny=be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oy=be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ay=be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cy=be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ly=be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),hy=Object.freeze(Object.defineProperty({__proto__:null,base32:ty,base32hex:ny,base32hexpad:ay,base32hexpadupper:cy,base32hexupper:oy,base32pad:sy,base32padupper:ry,base32upper:iy,base32z:ly},Symbol.toStringTag,{value:"Module"})),uy=rs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),py=rs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),dy=Object.freeze(Object.defineProperty({__proto__:null,base36:uy,base36upper:py},Symbol.toStringTag,{value:"Module"})),fy=rs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gy=rs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),yy=Object.freeze(Object.defineProperty({__proto__:null,base58btc:fy,base58flickr:gy},Symbol.toStringTag,{value:"Module"})),my=be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),wy=be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),by=be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vy=be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Dy=Object.freeze(Object.defineProperty({__proto__:null,base64:my,base64pad:wy,base64url:by,base64urlpad:vy},Symbol.toStringTag,{value:"Module"})),Tc=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),Ey=Tc.reduce((i,e,t)=>(i[t]=e,i),[]),_y=Tc.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function Iy(i){return i.reduce((e,t)=>(e+=Ey[t],e),"")}function Py(i){const e=[];for(const t of i){const s=_y[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const $y=zs({prefix:"ðŸš€",name:"base256emoji",encode:Iy,decode:Py}),Sy=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:$y},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Co={...Hg,...Gg,...Jg,...Yg,...ey,...hy,...dy,...yy,...Dy,...Sy};function Nc(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const Oo=Nc("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),ar=Nc("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=xg(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Cy={utf8:Oo,"utf-8":Oo,hex:Co.base16,latin1:ar,ascii:ar,binary:ar,...Co};function Oy(i,e="utf8"){const t=Cy[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}var Ay={};const Rc="wc",jc=2,jr="core",nt=`${Rc}@2:${jr}:`,xy={logger:"error"},Ty={database:":memory:"},Ny="crypto",Ao="client_ed25519_seed",Ry=k.ONE_DAY,jy="keychain",ky="0.3",qy="messages",Ly="0.3",xo=k.SIX_HOURS,Uy="publisher",kc="irn",By="error",qc="wss://relay.walletconnect.org",My="relayer",pe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},zy="_subscription",Le={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Fy=.1,kr="2.21.1",ie={link_mode:"link_mode",relay:"relay"},vs={inbound:"inbound",outbound:"outbound"},Vy="0.3",Hy="WALLETCONNECT_CLIENT_ID",To="WALLETCONNECT_LINK_MODE_APPS",Te={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Ky="subscription",Gy="0.3",Wy="pairing",Jy="0.3",Ni={wc_pairingDelete:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:k.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:k.ONE_DAY,prompt:!1,tag:0},res:{ttl:k.ONE_DAY,prompt:!1,tag:0}}},Rt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ve={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Qy="history",Yy="0.3",Zy="expirer",Be={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Xy="0.3",em="verify-api",tm="https://verify.walletconnect.com",Lc="https://verify.walletconnect.org",zi=Lc,im=`${zi}/v3`,sm=[tm,Lc],rm="echo",nm="https://echo.walletconnect.com",tt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},pt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},He={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ot={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},At={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ri={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},om=.1,am="event-client",cm=86400,lm="https://pulse.walletconnect.org/batch";function hm(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var r=0;r<i.length;r++){var n=i.charAt(r),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=r}var a=i.length,c=i.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function p(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var m=0,y=0,E=0,w=f.length;E!==w&&f[E]===0;)E++,m++;for(var P=(w-E)*h+1>>>0,$=new Uint8Array(P);E!==w;){for(var O=f[E],u=0,g=P-1;(O!==0||u<y)&&g!==-1;g--,u++)O+=256*$[g]>>>0,$[g]=O%a>>>0,O=O/a>>>0;if(O!==0)throw new Error("Non-zero carry");y=u,E++}for(var D=P-y;D!==P&&$[D]===0;)D++;for(var _=c.repeat(m);D<P;++D)_+=i.charAt($[D]);return _}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var m=0;if(f[m]!==" "){for(var y=0,E=0;f[m]===c;)y++,m++;for(var w=(f.length-m)*l+1>>>0,P=new Uint8Array(w);f[m];){var $=t[f.charCodeAt(m)];if($===255)return;for(var O=0,u=w-1;($!==0||O<E)&&u!==-1;u--,O++)$+=a*P[u]>>>0,P[u]=$%256>>>0,$=$/256>>>0;if($!==0)throw new Error("Non-zero carry");E=O,m++}if(f[m]!==" "){for(var g=w-E;g!==w&&P[g]===0;)g++;for(var D=new Uint8Array(y+(w-g)),_=y;g!==w;)D[_++]=P[g++];return D}}}function b(f){var m=d(f);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:d,decode:b}}var um=hm,pm=um;const Uc=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},dm=i=>new TextEncoder().encode(i),fm=i=>new TextDecoder().decode(i);class gm{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ym{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Bc(this,e)}}class mm{constructor(e){this.decoders=e}or(e){return Bc(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Bc=(i,e)=>new mm({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class wm{constructor(e,t,s,r){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=r,this.encoder=new gm(e,t,s),this.decoder=new ym(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Fs=({name:i,prefix:e,encode:t,decode:s})=>new wm(i,e,t,s),ns=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:r}=pm(t,e);return Fs({prefix:i,name:e,encode:s,decode:n=>Uc(r(n))})},bm=(i,e,t,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=i.length;for(;i[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,l=0;for(let h=0;h<n;++h){const p=r[i[h]];if(p===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|p,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},vm=(i,e,t)=>{const s=e[e.length-1]==="=",r=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<i.length;++c)for(a=a<<8|i[c],o+=8;o>t;)o-=t,n+=e[r&a>>o];if(o&&(n+=e[r&a<<t-o]),s)for(;n.length*t&7;)n+="=";return n},ve=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>Fs({prefix:e,name:i,encode(r){return vm(r,s,t)},decode(r){return bm(r,s,t,i)}}),Dm=Fs({prefix:"\0",name:"identity",encode:i=>fm(i),decode:i=>dm(i)});var Em=Object.freeze({__proto__:null,identity:Dm});const _m=ve({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Im=Object.freeze({__proto__:null,base2:_m});const Pm=ve({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var $m=Object.freeze({__proto__:null,base8:Pm});const Sm=ns({prefix:"9",name:"base10",alphabet:"0123456789"});var Cm=Object.freeze({__proto__:null,base10:Sm});const Om=ve({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Am=ve({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var xm=Object.freeze({__proto__:null,base16:Om,base16upper:Am});const Tm=ve({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Nm=ve({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Rm=ve({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),jm=ve({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),km=ve({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qm=ve({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Lm=ve({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Um=ve({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bm=ve({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Mm=Object.freeze({__proto__:null,base32:Tm,base32upper:Nm,base32pad:Rm,base32padupper:jm,base32hex:km,base32hexupper:qm,base32hexpad:Lm,base32hexpadupper:Um,base32z:Bm});const zm=ns({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Fm=ns({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Vm=Object.freeze({__proto__:null,base36:zm,base36upper:Fm});const Hm=ns({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Km=ns({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Gm=Object.freeze({__proto__:null,base58btc:Hm,base58flickr:Km});const Wm=ve({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Jm=ve({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Qm=ve({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ym=ve({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Zm=Object.freeze({__proto__:null,base64:Wm,base64pad:Jm,base64url:Qm,base64urlpad:Ym});const Mc=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),Xm=Mc.reduce((i,e,t)=>(i[t]=e,i),[]),ew=Mc.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function tw(i){return i.reduce((e,t)=>(e+=Xm[t],e),"")}function iw(i){const e=[];for(const t of i){const s=ew[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const sw=Fs({prefix:"ðŸš€",name:"base256emoji",encode:tw,decode:iw});var rw=Object.freeze({__proto__:null,base256emoji:sw}),nw=zc,No=128,ow=-128,aw=Math.pow(2,31);function zc(i,e,t){e=e||[],t=t||0;for(var s=t;i>=aw;)e[t++]=i&255|No,i/=128;for(;i&ow;)e[t++]=i&255|No,i>>>=7;return e[t]=i|0,zc.bytes=t-s+1,e}var cw=qr,lw=128,Ro=127;function qr(i,s){var t=0,s=s||0,r=0,n=s,o,a=i.length;do{if(n>=a)throw qr.bytes=0,new RangeError("Could not decode varint");o=i[n++],t+=r<28?(o&Ro)<<r:(o&Ro)*Math.pow(2,r),r+=7}while(o>=lw);return qr.bytes=n-s,t}var hw=Math.pow(2,7),uw=Math.pow(2,14),pw=Math.pow(2,21),dw=Math.pow(2,28),fw=Math.pow(2,35),gw=Math.pow(2,42),yw=Math.pow(2,49),mw=Math.pow(2,56),ww=Math.pow(2,63),bw=function(i){return i<hw?1:i<uw?2:i<pw?3:i<dw?4:i<fw?5:i<gw?6:i<yw?7:i<mw?8:i<ww?9:10},vw={encode:nw,decode:cw,encodingLength:bw},Fc=vw;const jo=(i,e,t=0)=>(Fc.encode(i,e,t),e),ko=i=>Fc.encodingLength(i),Lr=(i,e)=>{const t=e.byteLength,s=ko(i),r=s+ko(t),n=new Uint8Array(r+t);return jo(i,n,0),jo(t,n,s),n.set(e,r),new Dw(i,t,e,n)};class Dw{constructor(e,t,s,r){this.code=e,this.size=t,this.digest=s,this.bytes=r}}const Vc=({name:i,code:e,encode:t})=>new Ew(i,e,t);class Ew{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Lr(this.code,t):t.then(s=>Lr(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Hc=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),_w=Vc({name:"sha2-256",code:18,encode:Hc("SHA-256")}),Iw=Vc({name:"sha2-512",code:19,encode:Hc("SHA-512")});var Pw=Object.freeze({__proto__:null,sha256:_w,sha512:Iw});const Kc=0,$w="identity",Gc=Uc,Sw=i=>Lr(Kc,Gc(i)),Cw={code:Kc,name:$w,encode:Gc,digest:Sw};var Ow=Object.freeze({__proto__:null,identity:Cw});new TextEncoder,new TextDecoder;const qo={...Em,...Im,...$m,...Cm,...xm,...Mm,...Vm,...Gm,...Zm,...rw};({...Pw,...Ow});function Aw(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function Wc(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const Lo=Wc("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),cr=Wc("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Aw(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),xw={utf8:Lo,"utf-8":Lo,hex:qo.base16,latin1:cr,ascii:cr,binary:cr,...qo};function Tw(i,e="utf8"){const t=xw[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}var Nw=Object.defineProperty,Rw=(i,e,t)=>e in i?Nw(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Xe=(i,e,t)=>Rw(i,typeof e!="symbol"?e+"":e,t);class jw{constructor(e,t){this.core=e,this.logger=t,Xe(this,"keychain",new Map),Xe(this,"name",jy),Xe(this,"version",ky),Xe(this,"initialized",!1),Xe(this,"storagePrefix",nt),Xe(this,"init",async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}}),Xe(this,"has",s=>(this.isInitialized(),this.keychain.has(s))),Xe(this,"set",async(s,r)=>{this.isInitialized(),this.keychain.set(s,r),await this.persist()}),Xe(this,"get",s=>{this.isInitialized();const r=this.keychain.get(s);if(typeof r>"u"){const{message:n}=j("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(n)}return r}),Xe(this,"del",async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()}),this.core=e,this.logger=Pe(t,this.name)}get context(){return Oe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,_r(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ir(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var kw=Object.defineProperty,qw=(i,e,t)=>e in i?kw(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ge=(i,e,t)=>qw(i,typeof e!="symbol"?e+"":e,t);class Lw{constructor(e,t,s){this.core=e,this.logger=t,ge(this,"name",Ny),ge(this,"keychain"),ge(this,"randomSessionIdentifier",Rr()),ge(this,"initialized",!1),ge(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ge(this,"hasKeys",r=>(this.isInitialized(),this.keychain.has(r))),ge(this,"getClientId",async()=>{this.isInitialized();const r=await this.getClientSeed(),n=gn(r);return Dl(n.publicKey)}),ge(this,"generateKeyPair",()=>{this.isInitialized();const r=Hd();return this.setPrivateKey(r.publicKey,r.privateKey)}),ge(this,"signJWT",async r=>{this.isInitialized();const n=await this.getClientSeed(),o=gn(n),a=this.randomSessionIdentifier;return await El(a,r,Ry,o)}),ge(this,"generateSharedKey",(r,n,o)=>{this.isInitialized();const a=this.getPrivateKey(r),c=Kd(a,n);return this.setSymKey(c,o)}),ge(this,"setSymKey",async(r,n)=>{this.isInitialized();const o=n||bs(r);return await this.keychain.set(o,r),o}),ge(this,"deleteKeyPair",async r=>{this.isInitialized(),await this.keychain.del(r)}),ge(this,"deleteSymKey",async r=>{this.isInitialized(),await this.keychain.del(r)}),ge(this,"encode",async(r,n,o)=>{this.isInitialized();const a=Sc(o),c=vr(n);if(lo(a))return Jd(c,o==null?void 0:o.encoding);if(co(a)){const d=a.senderPublicKey,b=a.receiverPublicKey;r=await this.generateSharedKey(d,b)}const l=this.getSymKey(r),{type:h,senderPublicKey:p}=a;return Gd({type:h,symKey:l,message:c,senderPublicKey:p,encoding:o==null?void 0:o.encoding})}),ge(this,"decode",async(r,n,o)=>{this.isInitialized();const a=Yd(n,o);if(lo(a)){const c=Qd(n,o==null?void 0:o.encoding);return yn(c)}if(co(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;r=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(r),l=Wd({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return yn(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${r}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),ge(this,"getPayloadType",(r,n=We)=>{const o=Ji({encoded:r,encoding:n});return zt(o.type)}),ge(this,"getPayloadSenderPublicKey",(r,n=We)=>{const o=Ji({encoded:r,encoding:n});return o.senderPublicKey?Oy(o.senderPublicKey,Ie):void 0}),this.core=e,this.logger=Pe(t,this.name),this.keychain=s||new jw(this.core,this.logger)}get context(){return Oe(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ao)}catch{e=Rr(),await this.keychain.set(Ao,e)}return Tw(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Uw=Object.defineProperty,Bw=Object.defineProperties,Mw=Object.getOwnPropertyDescriptors,Uo=Object.getOwnPropertySymbols,zw=Object.prototype.hasOwnProperty,Fw=Object.prototype.propertyIsEnumerable,Ur=(i,e,t)=>e in i?Uw(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Vw=(i,e)=>{for(var t in e||(e={}))zw.call(e,t)&&Ur(i,t,e[t]);if(Uo)for(var t of Uo(e))Fw.call(e,t)&&Ur(i,t,e[t]);return i},Hw=(i,e)=>Bw(i,Mw(e)),Ae=(i,e,t)=>Ur(i,typeof e!="symbol"?e+"":e,t);class Kw extends wg{constructor(e,t){super(e,t),this.logger=e,this.core=t,Ae(this,"messages",new Map),Ae(this,"messagesWithoutClientAck",new Map),Ae(this,"name",qy),Ae(this,"version",Ly),Ae(this,"initialized",!1),Ae(this,"storagePrefix",nt),Ae(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s);const r=await this.getRelayerMessagesWithoutClientAck();typeof r<"u"&&(this.messagesWithoutClientAck=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}}),Ae(this,"set",async(s,r,n)=>{this.isInitialized();const o=st(r);let a=this.messages.get(s);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=r,this.messages.set(s,a),n===vs.inbound){const c=this.messagesWithoutClientAck.get(s)||{};this.messagesWithoutClientAck.set(s,Hw(Vw({},c),{[o]:r}))}return await this.persist(),o}),Ae(this,"get",s=>{this.isInitialized();let r=this.messages.get(s);return typeof r>"u"&&(r={}),r}),Ae(this,"getWithoutAck",s=>{this.isInitialized();const r={};for(const n of s){const o=this.messagesWithoutClientAck.get(n)||{};r[n]=Object.values(o)}return r}),Ae(this,"has",(s,r)=>{this.isInitialized();const n=this.get(s),o=st(r);return typeof n[o]<"u"}),Ae(this,"ack",async(s,r)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(s);if(typeof n>"u")return;const o=st(r);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(s):this.messagesWithoutClientAck.set(s,n),await this.persist()}),Ae(this,"del",async s=>{this.isInitialized(),this.messages.delete(s),this.messagesWithoutClientAck.delete(s),await this.persist()}),this.logger=Pe(e,this.name),this.core=t}get context(){return Oe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,_r(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,_r(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ir(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ir(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Gw=Object.defineProperty,Ww=Object.defineProperties,Jw=Object.getOwnPropertyDescriptors,Bo=Object.getOwnPropertySymbols,Qw=Object.prototype.hasOwnProperty,Yw=Object.prototype.propertyIsEnumerable,Br=(i,e,t)=>e in i?Gw(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ps=(i,e)=>{for(var t in e||(e={}))Qw.call(e,t)&&Br(i,t,e[t]);if(Bo)for(var t of Bo(e))Yw.call(e,t)&&Br(i,t,e[t]);return i},lr=(i,e)=>Ww(i,Jw(e)),Ke=(i,e,t)=>Br(i,typeof e!="symbol"?e+"":e,t);class Zw extends bg{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Ke(this,"events",new $t.EventEmitter),Ke(this,"name",Uy),Ke(this,"queue",new Map),Ke(this,"publishTimeout",k.toMiliseconds(k.ONE_MINUTE)),Ke(this,"initialPublishTimeout",k.toMiliseconds(k.ONE_SECOND*15)),Ke(this,"needsTransportRestart",!1),Ke(this,"publish",async(s,r,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:n}});const a=(n==null?void 0:n.ttl)||xo,c=Ps(n),l=(n==null?void 0:n.prompt)||!1,h=(n==null?void 0:n.tag)||0,p=(n==null?void 0:n.id)||li().toString(),d={topic:s,message:r,opts:{ttl:a,relay:c,prompt:l,tag:h,id:p,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},b=`Failed to publish payload, please try again. id:${p} tag:${h}`;try{const f=new Promise(async m=>{const y=({id:w})=>{d.opts.id===w&&(this.removeRequestFromQueue(w),this.relayer.events.removeListener(pe.publish,y),m(d))};this.relayer.events.on(pe.publish,y);const E=_t(new Promise((w,P)=>{this.rpcPublish({topic:s,message:r,ttl:a,prompt:l,tag:h,id:p,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(w).catch($=>{this.logger.warn($,$==null?void 0:$.message),P($)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${h}`);try{await E,this.events.removeListener(pe.publish,y)}catch(w){this.queue.set(p,lr(ps({},d),{attempt:1})),this.logger.warn(w,w==null?void 0:w.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:s,message:r,opts:n}}),await _t(f,this.publishTimeout,b)}catch(f){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(f),(o=n==null?void 0:n.internal)!=null&&o.throwOnFailedPublish)throw f}finally{this.queue.delete(p)}}),Ke(this,"on",(s,r)=>{this.events.on(s,r)}),Ke(this,"once",(s,r)=>{this.events.once(s,r)}),Ke(this,"off",(s,r)=>{this.events.off(s,r)}),Ke(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),this.relayer=e,this.logger=Pe(t,this.name),this.registerEventListeners()}get context(){return Oe(this.logger)}async rpcPublish(e){var t,s,r,n;const{topic:o,message:a,ttl:c=xo,prompt:l,tag:h,id:p,attestation:d,tvf:b}=e,f={method:Li(Ps().protocol).publish,params:ps({topic:o,message:a,ttl:c,prompt:l,tag:h,attestation:d},b),id:p};me((t=f.params)==null?void 0:t.prompt)&&((s=f.params)==null||delete s.prompt),me((r=f.params)==null?void 0:r.tag)&&((n=f.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:f});const m=await this.relayer.request(f);return this.relayer.events.emit(pe.publish,e),this.logger.debug("Successfully Published Payload"),m}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const s=e.attempt+1;this.queue.set(t,lr(ps({},e),{attempt:s}));const{topic:r,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${s}`),await this.rpcPublish(lr(ps({},e),{topic:r,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ei.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(pe.connection_stalled);return}this.checkQueue()}),this.relayer.on(pe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Xw=Object.defineProperty,eb=(i,e,t)=>e in i?Xw(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Wt=(i,e,t)=>eb(i,typeof e!="symbol"?e+"":e,t);class tb{constructor(){Wt(this,"map",new Map),Wt(this,"set",(e,t)=>{const s=this.get(e);this.exists(e,t)||this.map.set(e,[...s,t])}),Wt(this,"get",e=>this.map.get(e)||[]),Wt(this,"exists",(e,t)=>this.get(e).includes(t)),Wt(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,t))return;const r=s.filter(n=>n!==t);if(!r.length){this.map.delete(e);return}this.map.set(e,r)}),Wt(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var ib=Object.defineProperty,sb=Object.defineProperties,rb=Object.getOwnPropertyDescriptors,Mo=Object.getOwnPropertySymbols,nb=Object.prototype.hasOwnProperty,ob=Object.prototype.propertyIsEnumerable,Mr=(i,e,t)=>e in i?ib(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ji=(i,e)=>{for(var t in e||(e={}))nb.call(e,t)&&Mr(i,t,e[t]);if(Mo)for(var t of Mo(e))ob.call(e,t)&&Mr(i,t,e[t]);return i},hr=(i,e)=>sb(i,rb(e)),Z=(i,e,t)=>Mr(i,typeof e!="symbol"?e+"":e,t);class ab extends Eg{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Z(this,"subscriptions",new Map),Z(this,"topicMap",new tb),Z(this,"events",new $t.EventEmitter),Z(this,"name",Ky),Z(this,"version",Gy),Z(this,"pending",new Map),Z(this,"cached",[]),Z(this,"initialized",!1),Z(this,"storagePrefix",nt),Z(this,"subscribeTimeout",k.toMiliseconds(k.ONE_MINUTE)),Z(this,"initialSubscribeTimeout",k.toMiliseconds(k.ONE_SECOND*15)),Z(this,"clientId"),Z(this,"batchSubscribeTopicsLimit",500),Z(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Z(this,"subscribe",async(s,r)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}});try{const n=Ps(r),o={topic:s,relay:n,transportType:r==null?void 0:r.transportType};this.pending.set(s,o);const a=await this.rpcSubscribe(s,n,r);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),Z(this,"unsubscribe",async(s,r)=>{this.isInitialized(),typeof(r==null?void 0:r.id)<"u"?await this.unsubscribeById(s,r.id,r):await this.unsubscribeByTopic(s,r)}),Z(this,"isSubscribed",s=>new Promise(r=>{r(this.topicMap.topics.includes(s))})),Z(this,"isKnownTopic",s=>new Promise(r=>{r(this.topicMap.topics.includes(s)||this.pending.has(s)||this.cached.some(n=>n.topic===s))})),Z(this,"on",(s,r)=>{this.events.on(s,r)}),Z(this,"once",(s,r)=>{this.events.once(s,r)}),Z(this,"off",(s,r)=>{this.events.off(s,r)}),Z(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),Z(this,"start",async()=>{await this.onConnect()}),Z(this,"stop",async()=>{await this.onDisconnect()}),Z(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Z(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const s=[];this.pending.forEach(r=>{s.push(r)}),await this.batchSubscribe(s)}),Z(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Ei.pulse,async()=>{await this.checkPending()}),this.events.on(Te.created,async s=>{const r=Te.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()}),this.events.on(Te.deleted,async s=>{const r=Te.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()})}),this.relayer=e,this.logger=Pe(t,this.name),this.clientId=""}get context(){return Oe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let s=!1;try{s=this.getSubscription(e).topic===t}catch{}return s}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const s=this.topicMap.get(e);await Promise.all(s.map(async r=>await this.unsubscribeById(e,r,t)))}async unsubscribeById(e,t,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}});try{const r=Ps(s);await this.restartToComplete({topic:e,id:t,relay:r}),await this.rpcUnsubscribe(e,t,r);const n=Y("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,t,s){var r;(!s||(s==null?void 0:s.transportType)===ie.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:Li(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(r=s==null?void 0:s.internal)==null?void 0:r.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((s==null?void 0:s.transportType)===ie.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(h=>this.logger.warn(h))},k.toMiliseconds(k.ONE_SECOND)),a;const c=new Promise(async h=>{const p=d=>{d.topic===e&&(this.events.removeListener(Te.created,p),h(d.id))};this.events.on(Te.created,p);try{const d=await _t(new Promise((b,f)=>{this.relayer.request(n).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),f(m)}).then(b)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Te.created,p),h(d)}catch{}}),l=await _t(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(pe.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,s={method:Li(t.protocol).batchSubscribe,params:{topics:e.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await _t(new Promise(r=>{this.relayer.request(s).catch(n=>this.logger.warn(n)).then(r)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(pe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,s={method:Li(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});let r;try{r=await await _t(new Promise((n,o)=>{this.relayer.request(s).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(pe.connection_stalled)}return r}rpcUnsubscribe(e,t,s){const r={method:Li(s.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(e,t){this.setSubscription(e,hr(ji({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,ji({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,s){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,ji({},t)),this.topicMap.set(t.topic,e),this.events.emit(Te.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(Te.deleted,hr(ji({},s),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Te.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<t;s++){const r=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}}this.events.emit(Te.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>hr(ji({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await Tu(k.toMiliseconds(k.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return st(e+await this.getClientId())}}var cb=Object.defineProperty,zo=Object.getOwnPropertySymbols,lb=Object.prototype.hasOwnProperty,hb=Object.prototype.propertyIsEnumerable,zr=(i,e,t)=>e in i?cb(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Fo=(i,e)=>{for(var t in e||(e={}))lb.call(e,t)&&zr(i,t,e[t]);if(zo)for(var t of zo(e))hb.call(e,t)&&zr(i,t,e[t]);return i},W=(i,e,t)=>zr(i,typeof e!="symbol"?e+"":e,t);class ub extends vg{constructor(e){super(e),W(this,"protocol","wc"),W(this,"version",2),W(this,"core"),W(this,"logger"),W(this,"events",new $t.EventEmitter),W(this,"provider"),W(this,"messages"),W(this,"subscriber"),W(this,"publisher"),W(this,"name",My),W(this,"transportExplicitlyClosed",!1),W(this,"initialized",!1),W(this,"connectionAttemptInProgress",!1),W(this,"relayUrl"),W(this,"projectId"),W(this,"packageName"),W(this,"bundleId"),W(this,"hasExperiencedNetworkDisruption",!1),W(this,"pingTimeout"),W(this,"heartBeatTimeout",k.toMiliseconds(k.THIRTY_SECONDS+k.FIVE_SECONDS)),W(this,"reconnectTimeout"),W(this,"connectPromise"),W(this,"reconnectInProgress",!1),W(this,"requestsInFlight",[]),W(this,"connectTimeout",k.toMiliseconds(k.ONE_SECOND*15)),W(this,"request",async t=>{var s,r;this.logger.debug("Publishing Request Payload");const n=t.id||li().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(s=t.params)==null?void 0:s.topic},"relayer.request - publishing...");const o=`${n}:${((r=t.params)==null?void 0:r.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),W(this,"resetPingTimeout",()=>{_s()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,s,r,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(r=(s=(t=this.provider)==null?void 0:t.connection)==null?void 0:s.socket)==null?void 0:r.terminate)==null||n.call(r)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),W(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),W(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected ðŸ›œ"),this.startPingTimeout(),this.events.emit(pe.connect)}),W(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected ðŸ›‘"),this.requestsInFlight=[],this.onProviderDisconnect()}),W(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(pe.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),W(this,"registerProviderListeners",()=>{this.provider.on(Le.payload,this.onPayloadHandler),this.provider.on(Le.connect,this.onConnectHandler),this.provider.on(Le.disconnect,this.onDisconnectHandler),this.provider.on(Le.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Pe(e.logger,this.name):Ms(un({level:e.logger||By})),this.messages=new Kw(this.logger,e.core),this.subscriber=new ab(this,this.logger),this.publisher=new Zw(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||qc,this.projectId=e.projectId,yu()?this.packageName=Tn():mu()&&(this.bundleId=Tn()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return Oe(this.logger)}get connected(){var e,t,s;return((s=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:s.readyState)===1||!1}get connecting(){var e,t,s;return((s=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:s.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,s){this.isInitialized(),await this.publisher.publish(e,t,s),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ie.relay},vs.outbound)}async subscribe(e,t){var s,r,n;this.isInitialized(),(!(t!=null&&t.transportType)||(t==null?void 0:t.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((s=t==null?void 0:t.internal)==null?void 0:s.throwOnFailedPublish)>"u"?!0:(r=t==null?void 0:t.internal)==null?void 0:r.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=h=>{h.topic===e&&(this.subscriber.off(Te.created,l),c())};return await Promise.all([new Promise(h=>{c=h,this.subscriber.on(Te.created,l)}),new Promise(async(h,p)=>{a=await this.subscriber.subscribe(e,Fo({internal:{throwOnFailedPublish:o}},t)).catch(d=>{o&&p(d)})||a,h()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await _t(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,s)=>{await this.connect(e).then(t).catch(s).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Do())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((s,r)=>s.publishedAt-r.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const s of t)try{await this.onMessageEvent(s)}catch(r){this.logger.warn(r,"Error while processing batch message event: "+(r==null?void 0:r.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:s}=e;if(!t.sessionExists){const r=ce(k.FIVE_MINUTES),n={topic:s,expiry:r,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(s,n)}this.events.emit(pe.message,e),await this.recordMessageEvent(e,vs.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(s,r)=>{const n=()=>{r(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Le.disconnect,n),await _t(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{r(o)}).finally(()=>{this.provider.off(Le.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Le.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Le.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,s()})}catch(s){await this.subscriber.stop();const r=s;this.logger.warn({},r.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(s=>setTimeout(s,k.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,s,r,n;if(_s())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ze(new vl(Eu({sdkVersion:kr,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:s,message:r}=e;await this.messages.set(s,r,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:s}=e;if(!s||s.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const r=this.messages.has(t,s);return r&&this.logger.warn(`Ignoring duplicate message: ${s}`),r}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Yr(e)){if(!e.method.endsWith(zy))return;const t=e.params,{topic:s,message:r,publishedAt:n,attestation:o}=t.data,a={topic:s,message:r,publishedAt:n,transportType:ie.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Fo({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Zr(e)&&this.events.emit(pe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,vs.inbound),this.events.emit(pe.message,e))}async acknowledgePayload(e){const t=Ts(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Le.payload,this.onPayloadHandler),this.provider.off(Le.connect,this.onConnectHandler),this.provider.off(Le.disconnect,this.onDisconnectHandler),this.provider.off(Le.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Do();Hf(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(s=>this.logger.error(s,s==null?void 0:s.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Ei.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Wf())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t==null?void 0:t.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(pe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},k.toMiliseconds(Fy)))))}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function pb(){}function Vo(i){if(!i||typeof i!="object")return!1;const e=Object.getPrototypeOf(i);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(i)==="[object Object]":!1}function Ho(i){return Object.getOwnPropertySymbols(i).filter(e=>Object.prototype.propertyIsEnumerable.call(i,e))}function Ko(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}const db="[object RegExp]",fb="[object String]",gb="[object Number]",yb="[object Boolean]",Go="[object Arguments]",mb="[object Symbol]",wb="[object Date]",bb="[object Map]",vb="[object Set]",Db="[object Array]",Eb="[object Function]",_b="[object ArrayBuffer]",ur="[object Object]",Ib="[object Error]",Pb="[object DataView]",$b="[object Uint8Array]",Sb="[object Uint8ClampedArray]",Cb="[object Uint16Array]",Ob="[object Uint32Array]",Ab="[object BigUint64Array]",xb="[object Int8Array]",Tb="[object Int16Array]",Nb="[object Int32Array]",Rb="[object BigInt64Array]",jb="[object Float32Array]",kb="[object Float64Array]";function qb(i,e){return i===e||Number.isNaN(i)&&Number.isNaN(e)}function Lb(i,e,t){return Ui(i,e,void 0,void 0,void 0,void 0,t)}function Ui(i,e,t,s,r,n,o){const a=o(i,e,t,s,r,n);if(a!==void 0)return a;if(typeof i==typeof e)switch(typeof i){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return i===e;case"number":return i===e||Object.is(i,e);case"function":return i===e;case"object":return Fi(i,e,n,o)}return Fi(i,e,n,o)}function Fi(i,e,t,s){if(Object.is(i,e))return!0;let r=Ko(i),n=Ko(e);if(r===Go&&(r=ur),n===Go&&(n=ur),r!==n)return!1;switch(r){case fb:return i.toString()===e.toString();case gb:{const c=i.valueOf(),l=e.valueOf();return qb(c,l)}case yb:case wb:case mb:return Object.is(i.valueOf(),e.valueOf());case db:return i.source===e.source&&i.flags===e.flags;case Eb:return i===e}t=t??new Map;const o=t.get(i),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(i,e),t.set(e,i);try{switch(r){case bb:{if(i.size!==e.size)return!1;for(const[c,l]of i.entries())if(!e.has(c)||!Ui(l,e.get(c),c,i,e,t,s))return!1;return!0}case vb:{if(i.size!==e.size)return!1;const c=Array.from(i.values()),l=Array.from(e.values());for(let h=0;h<c.length;h++){const p=c[h],d=l.findIndex(b=>Ui(p,b,void 0,i,e,t,s));if(d===-1)return!1;l.splice(d,1)}return!0}case Db:case $b:case Sb:case Cb:case Ob:case Ab:case xb:case Tb:case Nb:case Rb:case jb:case kb:{if(typeof Buffer<"u"&&Buffer.isBuffer(i)!==Buffer.isBuffer(e)||i.length!==e.length)return!1;for(let c=0;c<i.length;c++)if(!Ui(i[c],e[c],c,i,e,t,s))return!1;return!0}case _b:return i.byteLength!==e.byteLength?!1:Fi(new Uint8Array(i),new Uint8Array(e),t,s);case Pb:return i.byteLength!==e.byteLength||i.byteOffset!==e.byteOffset?!1:Fi(new Uint8Array(i),new Uint8Array(e),t,s);case Ib:return i.name===e.name&&i.message===e.message;case ur:{if(!(Fi(i.constructor,e.constructor,t,s)||Vo(i)&&Vo(e)))return!1;const c=[...Object.keys(i),...Ho(i)],l=[...Object.keys(e),...Ho(e)];if(c.length!==l.length)return!1;for(let h=0;h<c.length;h++){const p=c[h],d=i[p];if(!Object.hasOwn(e,p))return!1;const b=e[p];if(!Ui(d,b,p,i,e,t,s))return!1}return!0}default:return!1}}finally{t.delete(i),t.delete(e)}}function Ub(i,e){return Lb(i,e,pb)}var Bb=Object.defineProperty,Wo=Object.getOwnPropertySymbols,Mb=Object.prototype.hasOwnProperty,zb=Object.prototype.propertyIsEnumerable,Fr=(i,e,t)=>e in i?Bb(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Jo=(i,e)=>{for(var t in e||(e={}))Mb.call(e,t)&&Fr(i,t,e[t]);if(Wo)for(var t of Wo(e))zb.call(e,t)&&Fr(i,t,e[t]);return i},$e=(i,e,t)=>Fr(i,typeof e!="symbol"?e+"":e,t);class Ft extends Dg{constructor(e,t,s,r=nt,n=void 0){super(e,t,s,r),this.core=e,this.logger=t,this.name=s,$e(this,"map",new Map),$e(this,"version",Vy),$e(this,"cached",[]),$e(this,"initialized",!1),$e(this,"getKey"),$e(this,"storagePrefix",nt),$e(this,"recentlyDeleted",[]),$e(this,"recentlyDeletedLimit",200),$e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!me(o)?this.map.set(this.getKey(o),o):Ef(o)?this.map.set(o.id,o):_f(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),$e(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),$e(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),$e(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>Ub(a[c],o[c]))):this.values)),$e(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Jo(Jo({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),$e(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Pe(t,this.name),this.storagePrefix=r,this.getKey=n}get context(){return Oe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:r}=j("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Fb=Object.defineProperty,Vb=(i,e,t)=>e in i?Fb(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,H=(i,e,t)=>Vb(i,typeof e!="symbol"?e+"":e,t);class Hb{constructor(e,t){this.core=e,this.logger=t,H(this,"name",Wy),H(this,"version",Jy),H(this,"events",new Xr),H(this,"pairings"),H(this,"initialized",!1),H(this,"storagePrefix",nt),H(this,"ignoredPayloadTypes",[yt]),H(this,"registeredMethods",[]),H(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),H(this,"register",({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]}),H(this,"create",async s=>{this.isInitialized();const r=Rr(),n=await this.core.crypto.setSymKey(r),o=ce(k.FIVE_MINUTES),a={protocol:kc},c={topic:n,expiry:o,relay:a,active:!1,methods:s==null?void 0:s.methods},l=uo({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:r,relay:a,expiryTimestamp:o,methods:s==null?void 0:s.methods});return this.events.emit(Rt.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:s==null?void 0:s.transportType}),{topic:n,uri:l}}),H(this,"pair",async s=>{this.isInitialized();const r=this.core.eventClient.createEvent({properties:{topic:s==null?void 0:s.uri,trace:[tt.pairing_started]}});this.isValidPair(s,r);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=ho(s.uri);r.props.properties.topic=n,r.addTrace(tt.pairing_uri_validation_success),r.addTrace(tt.pairing_uri_not_expired);let h;if(this.pairings.keys.includes(n)){if(h=this.pairings.get(n),r.addTrace(tt.existing_pairing),h.active)throw r.setError(pt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);r.addTrace(tt.pairing_not_expired)}const p=c||ce(k.FIVE_MINUTES),d={topic:n,relay:a,expiry:p,active:!1,methods:l};this.core.expirer.set(n,p),await this.pairings.set(n,d),r.addTrace(tt.store_new_pairing),s.activatePairing&&await this.activate({topic:n}),this.events.emit(Rt.create,d),r.addTrace(tt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),r.addTrace(tt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError(pt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(b){throw r.setError(pt.subscribe_pairing_topic_failure),b}return r.addTrace(tt.subscribe_pairing_topic_success),d}),H(this,"activate",async({topic:s})=>{this.isInitialized();const r=ce(k.FIVE_MINUTES);this.core.expirer.set(s,r),await this.pairings.update(s,{active:!0,expiry:r})}),H(this,"ping",async s=>{this.isInitialized(),await this.isValidPing(s),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:r}=s;if(this.pairings.keys.includes(r)){const n=await this.sendRequest(r,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=xt();this.events.once(Q("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),H(this,"updateExpiry",async({topic:s,expiry:r})=>{this.isInitialized(),await this.pairings.update(s,{expiry:r})}),H(this,"updateMetadata",async({topic:s,metadata:r})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:r})}),H(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),H(this,"disconnect",async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:r}=s;this.pairings.keys.includes(r)&&(await this.sendRequest(r,"wc_pairingDelete",Y("USER_DISCONNECTED")),await this.deletePairing(r))}),H(this,"formatUriFromPairing",s=>{this.isInitialized();const{topic:r,relay:n,expiry:o,methods:a}=s,c=this.core.crypto.keychain.get(r);return uo({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),H(this,"sendRequest",async(s,r,n)=>{const o=kt(r,n),a=await this.core.crypto.encode(s,o),c=Ni[r].req;return this.core.history.set(s,o),this.core.relayer.publish(s,a,c),o.id}),H(this,"sendResult",async(s,r,n)=>{const o=Ts(s,n),a=await this.core.crypto.encode(r,o),c=(await this.core.history.get(r,s)).request.method,l=Ni[c].res;await this.core.relayer.publish(r,a,l),await this.core.history.resolve(o)}),H(this,"sendError",async(s,r,n)=>{const o=Pa(s,n),a=await this.core.crypto.encode(r,o),c=(await this.core.history.get(r,s)).request.method,l=Ni[c]?Ni[c].res:Ni.unregistered_method.res;await this.core.relayer.publish(r,a,l),await this.core.history.resolve(o)}),H(this,"deletePairing",async(s,r)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Y("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),r?Promise.resolve():this.core.expirer.del(s)])}),H(this,"cleanup",async()=>{const s=this.pairings.getAll().filter(r=>Dt(r.expiry));await Promise.all(s.map(r=>this.deletePairing(r.topic)))}),H(this,"onRelayEventRequest",async s=>{const{topic:r,payload:n}=s;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(r,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(r,n);default:return await this.onUnknownRpcMethodRequest(r,n)}}),H(this,"onRelayEventResponse",async s=>{const{topic:r,payload:n}=s,o=(await this.core.history.get(r,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(r,n);default:return this.onUnknownRpcMethodResponse(o)}}),H(this,"onPairingPingRequest",async(s,r)=>{const{id:n}=r;try{this.isValidPing({topic:s}),await this.sendResult(n,s,!0),this.events.emit(Rt.ping,{id:n,topic:s})}catch(o){await this.sendError(n,s,o),this.logger.error(o)}}),H(this,"onPairingPingResponse",(s,r)=>{const{id:n}=r;setTimeout(()=>{ut(r)?this.events.emit(Q("pairing_ping",n),{}):it(r)&&this.events.emit(Q("pairing_ping",n),{error:r.error})},500)}),H(this,"onPairingDeleteRequest",async(s,r)=>{const{id:n}=r;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Rt.delete,{id:n,topic:s})}catch(o){await this.sendError(n,s,o),this.logger.error(o)}}),H(this,"onUnknownRpcMethodRequest",async(s,r)=>{const{id:n,method:o}=r;try{if(this.registeredMethods.includes(o))return;const a=Y("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,s,a),this.logger.error(a)}catch(a){await this.sendError(n,s,a),this.logger.error(a)}}),H(this,"onUnknownRpcMethodResponse",s=>{this.registeredMethods.includes(s)||this.logger.error(Y("WC_METHOD_UNSUPPORTED",s))}),H(this,"isValidPair",(s,r)=>{var n;if(!Se(s)){const{message:a}=j("MISSING_OR_INVALID",`pair() params: ${s}`);throw r.setError(pt.malformed_pairing_uri),new Error(a)}if(!Df(s.uri)){const{message:a}=j("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw r.setError(pt.malformed_pairing_uri),new Error(a)}const o=ho(s==null?void 0:s.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=j("MISSING_OR_INVALID","pair() uri#relay-protocol");throw r.setError(pt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=j("MISSING_OR_INVALID","pair() uri#symKey");throw r.setError(pt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&k.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){r.setError(pt.pairing_expired);const{message:a}=j("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),H(this,"isValidPing",async s=>{if(!Se(s)){const{message:n}=j("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(n)}const{topic:r}=s;await this.isValidPairingTopic(r)}),H(this,"isValidDisconnect",async s=>{if(!Se(s)){const{message:n}=j("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(n)}const{topic:r}=s;await this.isValidPairingTopic(r)}),H(this,"isValidPairingTopic",async s=>{if(!ne(s,!1)){const{message:r}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.pairings.keys.includes(s)){const{message:r}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(Dt(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:r}=j("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}}),this.core=e,this.logger=Pe(t,this.name),this.pairings=new Ft(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Oe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(pe.message,async e=>{const{topic:t,message:s,transportType:r}=e;if(this.pairings.keys.includes(t)&&r!==ie.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))try{const n=await this.core.crypto.decode(t,s);Yr(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):Zr(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,s)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(Be.expired,async e=>{const{topic:t}=Wa(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Rt.expire,{topic:t}))})}}var Kb=Object.defineProperty,Gb=(i,e,t)=>e in i?Kb(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ye=(i,e,t)=>Gb(i,typeof e!="symbol"?e+"":e,t);class Wb extends mg{constructor(e,t){super(e,t),this.core=e,this.logger=t,ye(this,"records",new Map),ye(this,"events",new $t.EventEmitter),ye(this,"name",Qy),ye(this,"version",Yy),ye(this,"cached",[]),ye(this,"initialized",!1),ye(this,"storagePrefix",nt),ye(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ye(this,"set",(s,r,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:r,chainId:n}),this.records.has(r.id))return;const o={id:r.id,topic:s,request:{method:r.method,params:r.params||null},chainId:n,expiry:ce(k.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Ve.created,o)}),ye(this,"resolve",async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const r=await this.getRecord(s.id);typeof r.response>"u"&&(r.response=it(s)?{error:s.error}:{result:s.result},this.records.set(r.id,r),this.persist(),this.events.emit(Ve.updated,r))}),ye(this,"get",async(s,r)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:r}),await this.getRecord(r))),ye(this,"delete",(s,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(n=>{if(n.topic===s){if(typeof r<"u"&&n.id!==r)return;this.records.delete(n.id),this.events.emit(Ve.deleted,n)}}),this.persist()}),ye(this,"exists",async(s,r)=>(this.isInitialized(),this.records.has(r)?(await this.getRecord(r)).topic===s:!1)),ye(this,"on",(s,r)=>{this.events.on(s,r)}),ye(this,"once",(s,r)=>{this.events.once(s,r)}),ye(this,"off",(s,r)=>{this.events.off(s,r)}),ye(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),this.logger=Pe(t,this.name)}get context(){return Oe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const s={topic:t.topic,request:kt(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ve.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ve.created,e=>{const t=Ve.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Ve.updated,e=>{const t=Ve.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Ve.deleted,e=>{const t=Ve.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Ei.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{k.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Ve.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Jb=Object.defineProperty,Qb=(i,e,t)=>e in i?Jb(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ee=(i,e,t)=>Qb(i,typeof e!="symbol"?e+"":e,t);class Yb extends _g{constructor(e,t){super(e,t),this.core=e,this.logger=t,Ee(this,"expirations",new Map),Ee(this,"events",new $t.EventEmitter),Ee(this,"name",Zy),Ee(this,"version",Xy),Ee(this,"cached",[]),Ee(this,"initialized",!1),Ee(this,"storagePrefix",nt),Ee(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ee(this,"has",s=>{try{const r=this.formatTarget(s);return typeof this.getExpiration(r)<"u"}catch{return!1}}),Ee(this,"set",(s,r)=>{this.isInitialized();const n=this.formatTarget(s),o={target:n,expiry:r};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(Be.created,{target:n,expiration:o})}),Ee(this,"get",s=>{this.isInitialized();const r=this.formatTarget(s);return this.getExpiration(r)}),Ee(this,"del",s=>{if(this.isInitialized(),this.has(s)){const r=this.formatTarget(s),n=this.getExpiration(r);this.expirations.delete(r),this.events.emit(Be.deleted,{target:r,expiration:n})}}),Ee(this,"on",(s,r)=>{this.events.on(s,r)}),Ee(this,"once",(s,r)=>{this.events.once(s,r)}),Ee(this,"off",(s,r)=>{this.events.off(s,r)}),Ee(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),this.logger=Pe(t,this.name)}get context(){return Oe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return _u(e);if(typeof e=="number")return Iu(e);const{message:t}=j("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Be.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:s}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(s),new Error(s)}return t}checkExpiry(e,t){const{expiry:s}=t;k.toMiliseconds(s)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Be.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Ei.pulse,()=>this.checkExpirations()),this.events.on(Be.created,e=>{const t=Be.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Be.expired,e=>{const t=Be.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Be.deleted,e=>{const t=Be.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Zb=Object.defineProperty,Xb=(i,e,t)=>e in i?Zb(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,re=(i,e,t)=>Xb(i,typeof e!="symbol"?e+"":e,t);class ev extends Ig{constructor(e,t,s){super(e,t,s),this.core=e,this.logger=t,this.store=s,re(this,"name",em),re(this,"abortController"),re(this,"isDevEnv"),re(this,"verifyUrlV3",im),re(this,"storagePrefix",nt),re(this,"version",jc),re(this,"publicKey"),re(this,"fetchPromise"),re(this,"init",async()=>{var r;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&k.toMiliseconds((r=this.publicKey)==null?void 0:r.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),re(this,"register",async r=>{if(!Pi()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=r,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=mt.getDocument(),h=this.startAbortTimer(k.ONE_SECOND*5),p=await new Promise((d,b)=>{const f=()=>{window.removeEventListener("message",y),l.body.removeChild(m),b("attestation aborted")};this.abortController.signal.addEventListener("abort",f);const m=l.createElement("iframe");m.src=c,m.style.display="none",m.addEventListener("error",f,{signal:this.abortController.signal});const y=E=>{if(E.data&&typeof E.data=="string")try{const w=JSON.parse(E.data);if(w.type==="verify_attestation"){if(br(w.attestation).payload.id!==o)return;clearInterval(h),l.body.removeChild(m),this.abortController.signal.removeEventListener("abort",f),window.removeEventListener("message",y),d(w.attestation===null?"":w.attestation)}}catch(w){this.logger.warn(w)}};l.body.appendChild(m),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",p),p}catch(l){this.logger.warn(l)}return""}),re(this,"resolve",async r=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=r;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(br(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(r==null?void 0:r.verifyUrl);return this.fetchAttestation(o,c)}),re(this,"fetchAttestation",async(r,n)=>{this.logger.debug(`resolving attestation: ${r} from url: ${n}`);const o=this.startAbortTimer(k.ONE_SECOND*5),a=await fetch(`${n}/attestation/${r}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),re(this,"getVerifyUrl",r=>{let n=r||zi;return sm.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${zi}`),n=zi),n}),re(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const r=this.startAbortTimer(k.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(r),await n.json()}catch(r){this.logger.warn(r)}}),re(this,"persistPublicKey",async r=>{this.logger.debug("persisting public key to local storage",r),await this.store.setItem(this.storeKey,r),this.publicKey=r}),re(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),re(this,"isValidJwtAttestation",async r=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(r,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(r,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),re(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),re(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const r=await this.fetchPromise;return this.fetchPromise=void 0,r}),re(this,"validateAttestation",(r,n)=>{const o=Xd(r,n.publicKey),a={hasExpired:k.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Pe(t,this.name),this.abortController=new AbortController,this.isDevEnv=tn(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Oe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),k.toMiliseconds(e))}}var tv=Object.defineProperty,iv=(i,e,t)=>e in i?tv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Qo=(i,e,t)=>iv(i,typeof e!="symbol"?e+"":e,t);class sv extends Pg{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Qo(this,"context",rm),Qo(this,"registerDeviceToken",async s=>{const{clientId:r,token:n,notificationType:o,enableEncrypted:a=!1}=s,c=`${nm}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:r,type:o,token:n,always_raw:a})})}),this.logger=Pe(t,this.context)}}var rv=Object.defineProperty,Yo=Object.getOwnPropertySymbols,nv=Object.prototype.hasOwnProperty,ov=Object.prototype.propertyIsEnumerable,Vr=(i,e,t)=>e in i?rv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ki=(i,e)=>{for(var t in e||(e={}))nv.call(e,t)&&Vr(i,t,e[t]);if(Yo)for(var t of Yo(e))ov.call(e,t)&&Vr(i,t,e[t]);return i},le=(i,e,t)=>Vr(i,typeof e!="symbol"?e+"":e,t);class av extends $g{constructor(e,t,s=!0){super(e,t,s),this.core=e,this.logger=t,le(this,"context",am),le(this,"storagePrefix",nt),le(this,"storageVersion",om),le(this,"events",new Map),le(this,"shouldPersist",!1),le(this,"init",async()=>{if(!tn())try{const r={eventId:Rn(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Ka(this.core.relayer.protocol,this.core.relayer.version,kr)}}};await this.sendEvent([r])}catch(r){this.logger.warn(r)}}),le(this,"createEvent",r=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=r,l=Rn(),h=this.core.projectId||"",p=Date.now(),d=ki({eventId:l,timestamp:p,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:h,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),le(this,"getEvent",r=>{const{eventId:n,topic:o}=r;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return ki(ki({},a),this.setMethods(a.eventId))}),le(this,"deleteEvent",r=>{const{eventId:n}=r;this.events.delete(n),this.shouldPersist=!0}),le(this,"setEventListeners",()=>{this.core.heartbeat.on(Ei.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(r=>{k.fromMiliseconds(Date.now())-k.fromMiliseconds(r.timestamp)>cm&&(this.events.delete(r.eventId),this.shouldPersist=!0)})})}),le(this,"setMethods",r=>({addTrace:n=>this.addTrace(r,n),setError:n=>this.setError(r,n)})),le(this,"addTrace",(r,n)=>{const o=this.events.get(r);o&&(o.props.properties.trace.push(n),this.events.set(r,o),this.shouldPersist=!0)}),le(this,"setError",(r,n)=>{const o=this.events.get(r);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(r,o),this.shouldPersist=!0)}),le(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),le(this,"restore",async()=>{try{const r=await this.core.storage.getItem(this.storageKey)||[];if(!r.length)return;r.forEach(n=>{this.events.set(n.eventId,ki(ki({},n),this.setMethods(n.eventId)))})}catch(r){this.logger.warn(r)}}),le(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const r=[];for(const[n,o]of this.events)o.props.type&&r.push(o);if(r.length!==0)try{if((await this.sendEvent(r)).ok)for(const n of r)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),le(this,"sendEvent",async r=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${lm}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${kr}${n}`,{method:"POST",body:JSON.stringify(r)})}),le(this,"getAppDomain",()=>Ha().url),this.logger=Pe(t,this.context),this.telemetryEnabled=s,s?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var cv=Object.defineProperty,Zo=Object.getOwnPropertySymbols,lv=Object.prototype.hasOwnProperty,hv=Object.prototype.propertyIsEnumerable,Hr=(i,e,t)=>e in i?cv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Xo=(i,e)=>{for(var t in e||(e={}))lv.call(e,t)&&Hr(i,t,e[t]);if(Zo)for(var t of Zo(e))hv.call(e,t)&&Hr(i,t,e[t]);return i},te=(i,e,t)=>Hr(i,typeof e!="symbol"?e+"":e,t);let uv=class Jc extends dg{constructor(e){var t;super(e),te(this,"protocol",Rc),te(this,"version",jc),te(this,"name",jr),te(this,"relayUrl"),te(this,"projectId"),te(this,"customStoragePrefix"),te(this,"events",new $t.EventEmitter),te(this,"logger"),te(this,"heartbeat"),te(this,"relayer"),te(this,"crypto"),te(this,"storage"),te(this,"history"),te(this,"expirer"),te(this,"pairing"),te(this,"verify"),te(this,"echoClient"),te(this,"linkModeSupportedApps"),te(this,"eventClient"),te(this,"initialized",!1),te(this,"logChunkController"),te(this,"on",(a,c)=>this.events.on(a,c)),te(this,"once",(a,c)=>this.events.once(a,c)),te(this,"off",(a,c)=>this.events.off(a,c)),te(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),te(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const h={topic:a,message:c,publishedAt:Date.now(),transportType:ie.link_mode};this.relayer.onLinkMessageEvent(h,{sessionExists:l})});const s=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(s)try{return this.customStoragePrefix=s.customStoragePrefix,this.logger=s.logger,this.heartbeat=s.heartbeat,this.crypto=s.crypto,this.history=s.history,this.expirer=s.expirer,this.storage=s.storage,this.relayer=s.relayer,this.pairing=s.pairing,this.verify=s.verify,this.echoClient=s.echoClient,this.linkModeSupportedApps=s.linkModeSupportedApps,this.eventClient=s.eventClient,this.initialized=s.initialized,this.logChunkController=s.logChunkController,s}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||qc,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=un({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:xy.logger,name:jr}),{logger:n,chunkLoggerController:o}=hg({opts:r,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Pe(n,this.name),this.heartbeat=new wl,this.crypto=new Lw(this,this.logger,e==null?void 0:e.keychain),this.history=new Wb(this,this.logger),this.expirer=new Yb(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new bl(Xo(Xo({},Ty),e==null?void 0:e.storageOptions)),this.relayer=new ub({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Hb(this,this.logger),this.verify=new ev(this,this.logger,this.storage),this.echoClient=new sv(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new av(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new Jc(e);await t.initialize();const s=await t.crypto.getClientId();return await t.storage.setItem(Hy,s),t}get context(){return Oe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(To,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(To)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,s=`${t}_count`;return globalThis[s]=(globalThis[s]||0)+1,globalThis[s]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[s]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const s=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[s]=e}catch(s){console.warn("Failed to set global WalletConnect core",s)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&Ay.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const pv=uv,Qc="wc",Yc=2,Zc="client",pn=`${Qc}@${Yc}:${Zc}:`,pr={name:Zc,logger:"error"},ea="WALLETCONNECT_DEEPLINK_CHOICE",dv="proposal",ta="Proposal expired",fv="session",Jt=k.SEVEN_DAYS,gv="engine",he={wc_sessionPropose:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1104},res:{ttl:k.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1106},res:{ttl:k.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1112},res:{ttl:k.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1114},res:{ttl:k.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:k.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:k.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1119}}},dr={min:k.FIVE_MINUTES,max:k.SEVEN_DAYS},et={idle:"IDLE",active:"ACTIVE"},ia={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},yv="request",mv=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],wv="wc",bv="auth",vv="authKeys",Dv="pairingTopics",Ev="requests",Vs=`${wv}@${1.5}:${bv}:`,Ds=`${Vs}:PUB_KEY`;var _v=Object.defineProperty,Iv=Object.defineProperties,Pv=Object.getOwnPropertyDescriptors,sa=Object.getOwnPropertySymbols,$v=Object.prototype.hasOwnProperty,Sv=Object.prototype.propertyIsEnumerable,Kr=(i,e,t)=>e in i?_v(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,X=(i,e)=>{for(var t in e||(e={}))$v.call(e,t)&&Kr(i,t,e[t]);if(sa)for(var t of sa(e))Sv.call(e,t)&&Kr(i,t,e[t]);return i},_e=(i,e)=>Iv(i,Pv(e)),A=(i,e,t)=>Kr(i,typeof e!="symbol"?e+"":e,t);class Cv extends Ag{constructor(e){super(e),A(this,"name",gv),A(this,"events",new Xr),A(this,"initialized",!1),A(this,"requestQueue",{state:et.idle,queue:[]}),A(this,"sessionRequestQueue",{state:et.idle,queue:[]}),A(this,"requestQueueDelay",k.ONE_SECOND),A(this,"expectedPairingMethodMap",new Map),A(this,"recentlyDeletedMap",new Map),A(this,"recentlyDeletedLimit",200),A(this,"relayMessageCache",[]),A(this,"pendingSessions",new Map),A(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(he)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},k.toMiliseconds(this.requestQueueDelay)))}),A(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const s=_e(X({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(s),s.optionalNamespaces=yf(s.requiredNamespaces,s.optionalNamespaces),s.requiredNamespaces={};const{pairingTopic:r,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=s;let h=r,p,d=!1;try{if(h){const u=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=u.active}}catch(u){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),u}if(!h||!d){const{topic:u,uri:g}=await this.client.core.pairing.create();h=u,p=g}if(!h){const{message:u}=j("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(u)}const b=await this.client.core.crypto.generateKeyPair(),f=he.wc_sessionPropose.req.ttl||k.FIVE_MINUTES,m=ce(f),y=_e(X(X({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:kc}],proposer:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:h},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:wt()}),E=Q("session_connect",y.id),{reject:w,resolve:P,done:$}=xt(f,ta),O=({id:u})=>{u===y.id&&(this.client.events.off("proposal_expire",O),this.pendingSessions.delete(y.id),this.events.emit(E,{error:{message:ta,code:0}}))};return this.client.events.on("proposal_expire",O),this.events.once(E,({error:u,session:g})=>{this.client.events.off("proposal_expire",O),u?w(u):g&&P(g)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:y,throwOnFailedPublish:!0,clientRpcId:y.id}),await this.setProposal(y.id,y),{uri:p,approval:$}}),A(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(s){throw this.client.logger.error("pair() failed"),s}}),A(this,"approve",async t=>{var s,r,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(s=t==null?void 0:t.id)==null?void 0:s.toString(),trace:[He.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(_){throw o.setError(Ot.no_internet_connection),_}try{await this.isValidProposalId(t==null?void 0:t.id)}catch(_){throw this.client.logger.error(`approve() -> proposal.get(${t==null?void 0:t.id}) failed`),o.setError(Ot.proposal_not_found),_}try{await this.isValidApprove(t)}catch(_){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ot.session_approve_namespace_validation_failure),_}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:h,scopedProperties:p,sessionConfig:d}=t,b=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:f,proposer:m,requiredNamespaces:y,optionalNamespaces:E}=b;let w=(r=this.client.core.eventClient)==null?void 0:r.getEvent({topic:f});w||(w=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:He.session_approve_started,properties:{topic:f,trace:[He.session_approve_started,He.session_namespaces_validation_success]}}));const P=await this.client.core.crypto.generateKeyPair(),$=m.publicKey,O=await this.client.core.crypto.generateSharedKey(P,$),u=X(X(X({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:P,metadata:this.client.metadata},expiry:ce(Jt)},h&&{sessionProperties:h}),p&&{scopedProperties:p}),d&&{sessionConfig:d}),g=ie.relay;w.addTrace(He.subscribing_session_topic);try{await this.client.core.relayer.subscribe(O,{transportType:g})}catch(_){throw w.setError(Ot.subscribe_session_topic_failure),_}w.addTrace(He.subscribe_session_topic_success);const D=_e(X({},u),{topic:O,requiredNamespaces:y,optionalNamespaces:E,pairingTopic:f,acknowledged:!1,self:u.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:P,transportType:ie.relay});await this.client.session.set(O,D),w.addTrace(He.store_session);try{w.addTrace(He.publishing_session_settle),await this.sendRequest({topic:O,method:"wc_sessionSettle",params:u,throwOnFailedPublish:!0}).catch(_=>{throw w==null||w.setError(Ot.session_settle_publish_failure),_}),w.addTrace(He.session_settle_publish_success),w.addTrace(He.publishing_session_approve),await this.sendResult({id:a,topic:f,result:{relay:{protocol:c??"irn"},responderPublicKey:P},throwOnFailedPublish:!0}).catch(_=>{throw w==null||w.setError(Ot.session_approve_publish_failure),_}),w.addTrace(He.session_approve_publish_success)}catch(_){throw this.client.logger.error(_),this.client.session.delete(O,Y("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(O),_}return this.client.core.eventClient.deleteEvent({eventId:w.eventId}),await this.client.core.pairing.updateMetadata({topic:f,metadata:m.metadata}),await this.client.proposal.delete(a,Y("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:f}),await this.setExpiry(O,ce(Jt)),{topic:O,acknowledged:()=>Promise.resolve(this.client.session.get(O))}}),A(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:s,reason:r}=t;let n;try{n=this.client.proposal.get(s).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${s}) failed`),o}n&&(await this.sendError({id:s,topic:n,error:r,rpcOpts:he.wc_sessionPropose.reject}),await this.client.proposal.delete(s,Y("USER_DISCONNECTED")))}),A(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(p){throw this.client.logger.error("update() -> isValidUpdate() failed"),p}const{topic:s,namespaces:r}=t,{done:n,resolve:o,reject:a}=xt(),c=wt(),l=li().toString(),h=this.client.session.get(s).namespaces;return this.events.once(Q("session_update",c),({error:p})=>{p?a(p):o()}),await this.client.session.update(s,{namespaces:r}),await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(p=>{this.client.logger.error(p),this.client.session.update(s,{namespaces:h}),a(p)}),{acknowledged:n}}),A(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:s}=t,r=wt(),{done:n,resolve:o,reject:a}=xt();return this.events.once(Q("session_extend",r),({error:c})=>{c?a(c):o()}),await this.setExpiry(s,ce(Jt)),this.sendRequest({topic:s,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),A(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(E){throw this.client.logger.error("request() -> isValidRequest() failed"),E}const{chainId:s,request:r,topic:n,expiry:o=he.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);(a==null?void 0:a.transportType)===ie.relay&&await this.confirmOnlineStateOrThrow();const c=wt(),l=li().toString(),{done:h,resolve:p,reject:d}=xt(o,"Request expired. Please try again.");this.events.once(Q("session_request",c),({error:E,result:w})=>{E?d(E):p(w)});const b="wc_sessionRequest",f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(f)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:b,params:{request:_e(X({},r),{expiryTimestamp:ce(o)}),chainId:s},expiry:o,throwOnFailedPublish:!0,appLink:f}).catch(E=>d(E)),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:s,id:c}),await h();const m={request:_e(X({},r),{expiryTimestamp:ce(o)}),chainId:s},y=this.shouldSetTVF(b,m);return await Promise.all([new Promise(async E=>{await this.sendRequest(X({clientRpcId:c,relayRpcId:l,topic:n,method:b,params:m,expiry:o,throwOnFailedPublish:!0},y&&{tvf:this.getTVFParams(c,m)})).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:s,id:c}),E()}),new Promise(async E=>{var w;if(!((w=a.sessionConfig)!=null&&w.disableDeepLink)){const P=await Cu(this.client.core.storage,ea);await Pu({id:c,topic:n,wcDeepLink:P})}E()}),h()]).then(E=>E[2])}),A(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:s,response:r}=t,{id:n}=r,o=this.client.session.get(s);o.transportType===ie.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);ut(r)?await this.sendResult({id:n,topic:s,result:r.result,throwOnFailedPublish:!0,appLink:a}):it(r)&&await this.sendError({id:n,topic:s,error:r.error,appLink:a}),this.cleanupAfterResponse(t)}),A(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(r){throw this.client.logger.error("ping() -> isValidPing() failed"),r}const{topic:s}=t;if(this.client.session.keys.includes(s)){const r=wt(),n=li().toString(),{done:o,resolve:a,reject:c}=xt();this.events.once(Q("session_ping",r),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:s,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:r,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(s)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:s}))}),A(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:s,event:r,chainId:n}=t,o=li().toString(),a=wt();await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:r,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),A(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:s}=t;if(this.client.session.keys.includes(s))await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Y("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:s,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(s))await this.client.core.pairing.disconnect({topic:s});else{const{message:r}=j("MISMATCHED_TOPIC",`Session or pairing topic not found: ${s}`);throw new Error(r)}}),A(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(s=>bf(s,t)))),A(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),A(this,"authenticate",async(t,s)=>{var r;this.isInitialized(),this.isValidAuthenticate(t);const n=s&&this.client.core.linkModeSupportedApps.includes(s)&&((r=this.client.metadata.redirect)==null?void 0:r.linkMode),o=n?ie.link_mode:ie.relay;o===ie.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:h,nonce:p,type:d,exp:b,nbf:f,methods:m=[],expiry:y}=t,E=[...t.resources||[]],{topic:w,uri:P}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:P}});const $=await this.client.core.crypto.generateKeyPair(),O=bs($);if(await Promise.all([this.client.auth.authKeys.set(Ds,{responseTopic:O,publicKey:$}),this.client.auth.pairingTopics.set(O,{topic:O,pairingTopic:w})]),await this.client.core.relayer.subscribe(O,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${w}`),m.length>0){const{namespace:T}=di(a[0]);let R=vp(T,"request",m);ws(E)&&(R=Ep(R,E.pop())),E.push(R)}const u=y&&y>he.wc_sessionAuthenticate.req.ttl?y:he.wc_sessionAuthenticate.req.ttl,g={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:h,version:"1",nonce:p,iat:new Date().toISOString(),exp:b,nbf:f,resources:E},requester:{publicKey:$,metadata:this.client.metadata},expiryTimestamp:ce(u)},D={eip155:{chains:a,methods:[...new Set(["personal_sign",...m])],events:["chainChanged","accountsChanged"]}},_={requiredNamespaces:{},optionalNamespaces:D,relays:[{protocol:"irn"}],pairingTopic:w,proposer:{publicKey:$,metadata:this.client.metadata},expiryTimestamp:ce(he.wc_sessionPropose.req.ttl),id:wt()},{done:I,resolve:S,reject:N}=xt(u,"Request expired"),L=wt(),v=Q("session_connect",_.id),C=Q("session_request",L),x=async({error:T,session:R})=>{this.events.off(C,q),T?N(T):R&&S({session:R})},q=async T=>{var R,B,M;if(await this.deletePendingAuthRequest(L,{message:"fulfilled",code:0}),T.error){const ae=Y("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return T.error.code===ae.code?void 0:(this.events.off(v,x),N(T.error.message))}await this.deleteProposal(_.id),this.events.off(v,x);const{cacaos:z,responder:F}=T.result,ee=[],V=[];for(const ae of z){await zn({cacao:ae,projectId:this.client.core.projectId})||(this.client.logger.error(ae,"Signature verification failed"),N(Y("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Ct}=ae,ot=ws(Ct.resources),Ye=[Pr(Ct.iss)],at=Is(Ct.iss);if(ot){const ct=Fn(ot),os=Vn(ot);ee.push(...ct),Ye.push(...os)}for(const ct of Ye)V.push(`${ct}:${at}`)}const De=await this.client.core.crypto.generateSharedKey($,F.publicKey);let oe;ee.length>0&&(oe={topic:De,acknowledged:!0,self:{publicKey:$,metadata:this.client.metadata},peer:F,controller:F.publicKey,expiry:ce(Jt),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:w,namespaces:yo([...new Set(ee)],[...new Set(V)]),transportType:o},await this.client.core.relayer.subscribe(De,{transportType:o}),await this.client.session.set(De,oe),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:F.metadata}),oe=this.client.session.get(De)),(R=this.client.metadata.redirect)!=null&&R.linkMode&&(B=F.metadata.redirect)!=null&&B.linkMode&&(M=F.metadata.redirect)!=null&&M.universal&&s&&(this.client.core.addLinkModeSupportedApp(F.metadata.redirect.universal),this.client.session.update(De,{transportType:ie.link_mode})),S({auths:z,session:oe})};this.events.once(v,x),this.events.once(C,q);let U;try{if(n){const T=kt("wc_sessionAuthenticate",g,L);this.client.core.history.set(w,T);const R=await this.client.core.crypto.encode("",T,{type:is,encoding:Et});U=us(s,w,R)}else await Promise.all([this.sendRequest({topic:w,method:"wc_sessionAuthenticate",params:g,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:L}),this.sendRequest({topic:w,method:"wc_sessionPropose",params:_,expiry:he.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:_.id})])}catch(T){throw this.events.off(v,x),this.events.off(C,q),T}return await this.setProposal(_.id,_),await this.setAuthRequest(L,{request:_e(X({},g),{verifyContext:{}}),pairingTopic:w,transportType:o}),{uri:U??P,response:I}}),A(this,"approveSessionAuthenticate",async t=>{const{id:s,auths:r}=t,n=this.client.core.eventClient.createEvent({properties:{topic:s.toString(),trace:[At.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw n.setError(Ri.no_internet_connection),y}const o=this.getPendingAuthRequest(s);if(!o)throw n.setError(Ri.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${s}`);const a=o.transportType||ie.relay;a===ie.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),h=bs(c),p={type:yt,receiverPublicKey:c,senderPublicKey:l},d=[],b=[];for(const y of r){if(!await zn({cacao:y,projectId:this.client.core.projectId})){n.setError(Ri.invalid_cacao);const O=Y("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:s,topic:h,error:O,encodeOpts:p}),new Error(O.message)}n.addTrace(At.cacaos_verified);const{p:E}=y,w=ws(E.resources),P=[Pr(E.iss)],$=Is(E.iss);if(w){const O=Fn(w),u=Vn(w);d.push(...O),P.push(...u)}for(const O of P)b.push(`${O}:${$}`)}const f=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(At.create_authenticated_session_topic);let m;if((d==null?void 0:d.length)>0){m={topic:f,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:ce(Jt),authentication:r,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:yo([...new Set(d)],[...new Set(b)]),transportType:a},n.addTrace(At.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(f,{transportType:a})}catch(y){throw n.setError(Ri.subscribe_authenticated_session_topic_failure),y}n.addTrace(At.subscribe_authenticated_session_topic_success),await this.client.session.set(f,m),n.addTrace(At.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(At.publishing_authenticated_session_approve);try{await this.sendResult({topic:h,id:s,result:{cacaos:r,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:p,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw n.setError(Ri.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(s,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:m}}),A(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:s,reason:r}=t,n=this.getPendingAuthRequest(s);if(!n)throw new Error(`Could not find pending auth request with id ${s}`);n.transportType===ie.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=bs(o),l={type:yt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:s,topic:c,error:r,encodeOpts:l,rpcOpts:he.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(s,{message:"rejected",code:0}),await this.client.proposal.delete(s,Y("USER_DISCONNECTED"))}),A(this,"formatAuthMessage",t=>{this.isInitialized();const{request:s,iss:r}=t;return sc(s,r)}),A(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),A(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const s=this.client.core.pairing.pairings.get(t.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==s.topic});if(r.length===0)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}}),A(this,"deleteSession",async t=>{var s;const{topic:r,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,Y("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(ea).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===r&&this.deletePendingSessionRequest(l.id,Y("USER_DISCONNECTED"))}),r===((s=this.sessionRequestQueue.queue[0])==null?void 0:s.topic)&&(this.sessionRequestQueue.state=et.idle),o&&this.client.events.emit("session_delete",{id:a,topic:r})}),A(this,"deleteProposal",async(t,s)=>{if(s)try{const r=this.client.proposal.get(t),n=this.client.core.eventClient.getEvent({topic:r.pairingTopic});n==null||n.setError(Ot.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,Y("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),A(this,"deletePendingSessionRequest",async(t,s,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,s),r?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),r&&(this.sessionRequestQueue.state=et.idle,this.client.events.emit("session_request_expire",{id:t}))}),A(this,"deletePendingAuthRequest",async(t,s,r=!1)=>{await Promise.all([this.client.auth.requests.delete(t,s),r?Promise.resolve():this.client.core.expirer.del(t)])}),A(this,"setExpiry",async(t,s)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,s),await this.client.session.update(t,{expiry:s}))}),A(this,"setProposal",async(t,s)=>{this.client.core.expirer.set(t,ce(he.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,s)}),A(this,"setAuthRequest",async(t,s)=>{const{request:r,pairingTopic:n,transportType:o=ie.relay}=s;this.client.core.expirer.set(t,r.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:t,pairingTopic:n,verifyContext:r.verifyContext,transportType:o})}),A(this,"setPendingSessionRequest",async t=>{const{id:s,topic:r,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||ce(he.wc_sessionRequest.req.ttl);this.client.core.expirer.set(s,a),await this.client.pendingRequest.set(s,{id:s,topic:r,params:n,verifyContext:o})}),A(this,"sendRequest",async t=>{const{topic:s,method:r,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:h,tvf:p}=t,d=kt(r,n,c);let b;const f=!!h;try{const E=f?Et:We;b=await this.client.core.crypto.encode(s,d,{encoding:E})}catch(E){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${s} failed`),E}let m;if(mv.includes(r)){const E=st(JSON.stringify(d)),w=st(b);m=await this.client.core.verify.register({id:w,decryptedId:E})}const y=he[r].req;if(y.attestation=m,o&&(y.ttl=o),a&&(y.id=a),this.client.core.history.set(s,d),f){const E=us(h,s,b);await global.Linking.openURL(E,this.client.name)}else{const E=he[r].req;o&&(E.ttl=o),a&&(E.id=a),E.tvf=_e(X({},p),{correlationId:d.id}),l?(E.internal=_e(X({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,b,E)):this.client.core.relayer.publish(s,b,E).catch(w=>this.client.logger.error(w))}return d.id}),A(this,"sendResult",async t=>{const{id:s,topic:r,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,l=Ts(s,n);let h;const p=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=p?Et:We;h=await this.client.core.crypto.encode(r,l,_e(X({},a||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${r} failed`),f}let d,b;try{d=await this.client.core.history.get(r,s);const f=d.request;try{this.shouldSetTVF(f.method,f.params)&&(b=this.getTVFParams(s,f.params,n))}catch(m){this.client.logger.warn("sendResult() -> getTVFParams() failed",m)}}catch(f){throw this.client.logger.error(`sendResult() -> history.get(${r}, ${s}) failed`),f}if(p){const f=us(c,r,h);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,m=he[f].res;m.tvf=_e(X({},b),{correlationId:s}),o?(m.internal=_e(X({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,h,m)):this.client.core.relayer.publish(r,h,m).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(l)}),A(this,"sendError",async t=>{const{id:s,topic:r,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,l=Pa(s,n);let h;const p=c&&typeof(global==null?void 0:global.Linking)<"u";try{const b=p?Et:We;h=await this.client.core.crypto.encode(r,l,_e(X({},o||{}),{encoding:b}))}catch(b){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${r} failed`),b}let d;try{d=await this.client.core.history.get(r,s)}catch(b){throw this.client.logger.error(`sendError() -> history.get(${r}, ${s}) failed`),b}if(p){const b=us(c,r,h);await global.Linking.openURL(b,this.client.name)}else{const b=d.request.method,f=a||he[b].res;this.client.core.relayer.publish(r,h,f)}await this.client.core.history.resolve(l)}),A(this,"cleanup",async()=>{const t=[],s=[];this.client.session.getAll().forEach(r=>{let n=!1;Dt(r.expiry)&&(n=!0),this.client.core.crypto.keychain.has(r.topic)||(n=!0),n&&t.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{Dt(r.expiryTimestamp)&&s.push(r.id)}),await Promise.all([...t.map(r=>this.deleteSession({topic:r})),...s.map(r=>this.deleteProposal(r))])}),A(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),A(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),A(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===et.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=et.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=et.idle}),A(this,"processRequest",async t=>{const{topic:s,payload:r,attestation:n,transportType:o,encryptedId:a}=t,c=r.method;if(!this.shouldIgnorePairingRequest({topic:s,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:s,payload:r,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(s,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(s,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(s,r);case"wc_sessionPing":return await this.onSessionPingRequest(s,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(s,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:s,payload:r,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(s,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:s,payload:r,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),A(this,"onRelayEventResponse",async t=>{const{topic:s,payload:r,transportType:n}=t,o=(await this.client.core.history.get(s,r.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(s,r,n);case"wc_sessionSettle":return this.onSessionSettleResponse(s,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,r);case"wc_sessionExtend":return this.onSessionExtendResponse(s,r);case"wc_sessionPing":return this.onSessionPingResponse(s,r);case"wc_sessionRequest":return this.onSessionRequestResponse(s,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(s,r);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),A(this,"onRelayEventUnknownPayload",t=>{const{topic:s}=t,{message:r}=j("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)}),A(this,"shouldIgnorePairingRequest",t=>{const{topic:s,requestMethod:r}=t,n=this.expectedPairingMethodMap.get(s);return!n||n.includes(r)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),A(this,"onSessionProposeRequest",async t=>{const{topic:s,payload:r,attestation:n,encryptedId:o}=t,{params:a,id:c}=r;try{const l=this.client.core.eventClient.getEvent({topic:s});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(pt.proposal_listener_not_found)),this.isValidConnect(X({},r.params));const h=a.expiryTimestamp||ce(he.wc_sessionPropose.req.ttl),p=X({id:c,pairingTopic:s,expiryTimestamp:h},a);await this.setProposal(c,p);const d=await this.getVerifyContext({attestationId:n,hash:st(JSON.stringify(r)),encryptedId:o,metadata:p.proposer.metadata});l==null||l.addTrace(tt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:p,verifyContext:d})}catch(l){await this.sendError({id:c,topic:s,error:l,rpcOpts:he.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),A(this,"onSessionProposeResponse",async(t,s,r)=>{const{id:n}=s;if(ut(s)){const{result:o}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const h=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:h,pairingTopic:t,proposalId:n,publicKey:c});const p=await this.client.core.relayer.subscribe(h,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:p}),await this.client.core.pairing.activate({topic:t})}else if(it(s)){await this.client.proposal.delete(n,Y("USER_DISCONNECTED"));const o=Q("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:s.error})}}),A(this,"onSessionSettleRequest",async(t,s)=>{const{id:r,params:n}=s;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:h,scopedProperties:p,sessionConfig:d}=s.params,b=[...this.pendingSessions.values()].find(y=>y.sessionTopic===t);if(!b)return this.client.logger.error(`Pending session not found for topic ${t}`);const f=this.client.proposal.get(b.proposalId),m=_e(X(X(X({topic:t,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:b.pairingTopic,requiredNamespaces:f.requiredNamespaces,optionalNamespaces:f.optionalNamespaces,controller:a.publicKey,self:{publicKey:b.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},h&&{sessionProperties:h}),p&&{scopedProperties:p}),d&&{sessionConfig:d}),{transportType:ie.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:b.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(Q("session_connect",b.proposalId),{session:m}),this.pendingSessions.delete(b.proposalId),this.deleteProposal(b.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:s.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:r,topic:t,error:o}),this.client.logger.error(o)}}),A(this,"onSessionSettleResponse",async(t,s)=>{const{id:r}=s;ut(s)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Q("session_approve",r),{})):it(s)&&(await this.client.session.delete(t,Y("USER_DISCONNECTED")),this.events.emit(Q("session_approve",r),{error:s.error}))}),A(this,"onSessionUpdateRequest",async(t,s)=>{const{params:r,id:n}=s;try{const o=`${t}_session_update`,a=Ti.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:Y("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(X({topic:t},r));try{Ti.set(o,n),await this.client.session.update(t,{namespaces:r.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(c){throw Ti.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:r})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),A(this,"isRequestOutOfSync",(t,s)=>s.toString().slice(0,-3)<t.toString().slice(0,-3)),A(this,"onSessionUpdateResponse",(t,s)=>{const{id:r}=s,n=Q("session_update",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ut(s)?this.events.emit(Q("session_update",r),{}):it(s)&&this.events.emit(Q("session_update",r),{error:s.error})}),A(this,"onSessionExtendRequest",async(t,s)=>{const{id:r}=s;try{this.isValidExtend({topic:t}),await this.setExpiry(t,ce(Jt)),await this.sendResult({id:r,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:r,topic:t})}catch(n){await this.sendError({id:r,topic:t,error:n}),this.client.logger.error(n)}}),A(this,"onSessionExtendResponse",(t,s)=>{const{id:r}=s,n=Q("session_extend",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ut(s)?this.events.emit(Q("session_extend",r),{}):it(s)&&this.events.emit(Q("session_extend",r),{error:s.error})}),A(this,"onSessionPingRequest",async(t,s)=>{const{id:r}=s;try{this.isValidPing({topic:t}),await this.sendResult({id:r,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:t})}catch(n){await this.sendError({id:r,topic:t,error:n}),this.client.logger.error(n)}}),A(this,"onSessionPingResponse",(t,s)=>{const{id:r}=s,n=Q("session_ping",r);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);ut(s)?this.events.emit(Q("session_ping",r),{}):it(s)&&this.events.emit(Q("session_ping",r),{error:s.error})},500)}),A(this,"onSessionDeleteRequest",async(t,s)=>{const{id:r}=s;try{this.isValidDisconnect({topic:t,reason:s.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(pe.publish,async()=>{n(await this.deleteSession({topic:t,id:r}))})}),this.sendResult({id:r,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:Y("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),A(this,"onSessionRequest",async t=>{var s,r,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:h}=t,{id:p,params:d}=a;try{await this.isValidRequest(X({topic:o},d));const b=this.client.session.get(o),f=await this.getVerifyContext({attestationId:c,hash:st(JSON.stringify(kt("wc_sessionRequest",d,p))),encryptedId:l,metadata:b.peer.metadata,transportType:h}),m={id:p,topic:o,params:d,verifyContext:f};await this.setPendingSessionRequest(m),h===ie.link_mode&&(s=b.peer.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp((r=b.peer.metadata.redirect)==null?void 0:r.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(m):(this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue())}catch(b){await this.sendError({id:p,topic:o,error:b}),this.client.logger.error(b)}}),A(this,"onSessionRequestResponse",(t,s)=>{const{id:r}=s,n=Q("session_request",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ut(s)?this.events.emit(Q("session_request",r),{result:s.result}):it(s)&&this.events.emit(Q("session_request",r),{error:s.error})}),A(this,"onSessionEventRequest",async(t,s)=>{const{id:r,params:n}=s;try{const o=`${t}_session_event_${n.event.name}`,a=Ti.get(o);if(a&&this.isRequestOutOfSync(a,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit(X({topic:t},n)),this.client.events.emit("session_event",{id:r,topic:t,params:n}),Ti.set(o,r)}catch(o){await this.sendError({id:r,topic:t,error:o}),this.client.logger.error(o)}}),A(this,"onSessionAuthenticateResponse",(t,s)=>{const{id:r}=s;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:s}),ut(s)?this.events.emit(Q("session_request",r),{result:s.result}):it(s)&&this.events.emit(Q("session_request",r),{error:s.error})}),A(this,"onSessionAuthenticateRequest",async t=>{var s;const{topic:r,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:l,authPayload:h,expiryTimestamp:p}=n.params,d=await this.getVerifyContext({attestationId:o,hash:st(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),b={requester:l,pairingTopic:r,id:n.id,authPayload:h,verifyContext:d,expiryTimestamp:p};await this.setAuthRequest(n.id,{request:b,pairingTopic:r,transportType:c}),c===ie.link_mode&&(s=l.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:n.params,id:n.id,verifyContext:d})}catch(l){this.client.logger.error(l);const h=n.params.requester.publicKey,p=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,c),b={type:yt,receiverPublicKey:h,senderPublicKey:p};await this.sendError({id:n.id,topic:r,error:l,encodeOpts:b,rpcOpts:he.wc_sessionAuthenticate.autoReject,appLink:d})}}),A(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),A(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=et.idle,this.processSessionRequestQueue()},k.toMiliseconds(this.requestQueueDelay))}),A(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:s})=>{const r=this.client.core.history.pending;r.length>0&&r.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=Q("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(Q("session_request",n.request.id),{error:s})})}),A(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===et.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=et.active,this.emitSessionRequest(t)}catch(s){this.client.logger.error(s)}}),A(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),A(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const s=this.client.proposal.getAll().find(r=>r.pairingTopic===t.topic);s&&this.onSessionProposeRequest({topic:t.topic,payload:kt("wc_sessionPropose",_e(X({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties,scopedProperties:s.scopedProperties}),s.id)})}),A(this,"isValidConnect",async t=>{if(!Se(t)){const{message:l}=j("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:s,requiredNamespaces:r,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(me(s)||await this.isValidPairingTopic(s),!xf(c)){const{message:l}=j("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!me(r)&&Pt(r)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(r,"requiredNamespaces")}if(!me(n)&&Pt(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),me(o)||this.validateSessionProps(o,"sessionProperties"),!me(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(r||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(h=>l.includes(h)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),A(this,"validateNamespaces",(t,s)=>{const r=Af(t,"connect()",s);if(r)throw new Error(r.message)}),A(this,"isValidApprove",async t=>{if(!Se(t))throw new Error(j("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:s,namespaces:r,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(s),await this.isValidProposalId(s);const c=this.client.proposal.get(s),l=rr(r,"approve()");if(l)throw new Error(l.message);const h=bo(c.requiredNamespaces,r,"approve()");if(h)throw new Error(h.message);if(!ne(n,!0)){const{message:p}=j("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(p)}if(me(o)||this.validateSessionProps(o,"sessionProperties"),!me(a)){this.validateSessionProps(a,"scopedProperties");const p=new Set(Object.keys(r));if(!Object.keys(a).every(d=>p.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(p).join(", ")}`)}}),A(this,"isValidReject",async t=>{if(!Se(t)){const{message:n}=j("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:s,reason:r}=t;if(this.checkRecentlyDeleted(s),await this.isValidProposalId(s),!Nf(r)){const{message:n}=j("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(n)}}),A(this,"isValidSessionSettleRequest",t=>{if(!Se(t)){const{message:l}=j("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:s,controller:r,namespaces:n,expiry:o}=t;if(!Oc(s)){const{message:l}=j("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=If(r,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=rr(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Dt(o)){const{message:l}=j("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),A(this,"isValidUpdate",async t=>{if(!Se(t)){const{message:c}=j("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:s,namespaces:r}=t;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);const n=this.client.session.get(s),o=rr(r,"update()");if(o)throw new Error(o.message);const a=bo(n.requiredNamespaces,r,"update()");if(a)throw new Error(a.message)}),A(this,"isValidExtend",async t=>{if(!Se(t)){const{message:r}=j("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(r)}const{topic:s}=t;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s)}),A(this,"isValidRequest",async t=>{if(!Se(t)){const{message:c}=j("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:s,request:r,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);const{namespaces:a}=this.client.session.get(s);if(!wo(a,n)){const{message:c}=j("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!Rf(r)){const{message:c}=j("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(c)}if(!qf(a,n,r.method)){const{message:c}=j("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(c)}if(o&&!Mf(o,dr)){const{message:c}=j("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${dr.min} and ${dr.max}`);throw new Error(c)}}),A(this,"isValidRespond",async t=>{var s;if(!Se(t)){const{message:o}=j("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:r,response:n}=t;try{await this.isValidSessionTopic(r)}catch(o){throw(s=t==null?void 0:t.response)!=null&&s.id&&this.cleanupAfterResponse(t),o}if(!jf(n)){const{message:o}=j("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),A(this,"isValidPing",async t=>{if(!Se(t)){const{message:r}=j("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(r)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)}),A(this,"isValidEmit",async t=>{if(!Se(t)){const{message:a}=j("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:s,event:r,chainId:n}=t;await this.isValidSessionTopic(s);const{namespaces:o}=this.client.session.get(s);if(!wo(o,n)){const{message:a}=j("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!kf(r)){const{message:a}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}if(!Lf(o,n,r.name)){const{message:a}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}}),A(this,"isValidDisconnect",async t=>{if(!Se(t)){const{message:r}=j("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(r)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)}),A(this,"isValidAuthenticate",t=>{const{chains:s,uri:r,domain:n,nonce:o}=t;if(!Array.isArray(s)||s.length===0)throw new Error("chains is required and must be a non-empty array");if(!ne(r,!1))throw new Error("uri is required parameter");if(!ne(n,!1))throw new Error("domain is required parameter");if(!ne(o,!1))throw new Error("nonce is required parameter");if([...new Set(s.map(c=>di(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=di(s[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),A(this,"getVerifyContext",async t=>{const{attestationId:s,hash:r,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||zi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ie.link_mode){const h=this.getAppLinkIfEnabled(o,a);return c.verified.validation=h&&new URL(h).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:s,hash:r,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),A(this,"validateSessionProps",(t,s)=>{Object.values(t).forEach((r,n)=>{if(r==null){const{message:o}=j("MISSING_OR_INVALID",`${s} must contain an existing value for each key. Received: ${r} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),A(this,"getPendingAuthRequest",t=>{const s=this.client.auth.requests.get(t);return typeof s=="object"?s:void 0}),A(this,"addToRecentlyDeleted",(t,s)=>{if(this.recentlyDeletedMap.set(t,s),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let r=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(r++>=n)break;this.recentlyDeletedMap.delete(o)}}}),A(this,"checkRecentlyDeleted",t=>{const s=this.recentlyDeletedMap.get(t);if(s){const{message:r}=j("MISSING_OR_INVALID",`Record was recently deleted - ${s}: ${t}`);throw new Error(r)}}),A(this,"isLinkModeEnabled",(t,s)=>{var r,n,o,a,c,l,h,p,d;return!t||s!==ie.link_mode?!1:((n=(r=this.client.metadata)==null?void 0:r.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((h=t==null?void 0:t.redirect)==null?void 0:h.universal)!==void 0&&((p=t==null?void 0:t.redirect)==null?void 0:p.universal)!==""&&((d=t==null?void 0:t.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),A(this,"getAppLinkIfEnabled",(t,s)=>{var r;return this.isLinkModeEnabled(t,s)?(r=t==null?void 0:t.redirect)==null?void 0:r.universal:void 0}),A(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const s=Nn(t,"topic")||"",r=decodeURIComponent(Nn(t,"wc_ev")||""),n=this.client.session.keys.includes(s);n&&this.client.session.update(s,{transportType:ie.link_mode}),this.client.core.dispatchEnvelope({topic:s,message:r,sessionExists:n})}),A(this,"registerLinkModeListeners",async()=>{var t;if(tn()||St()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const s=global==null?void 0:global.Linking;if(typeof s<"u"){s.addEventListener("url",this.handleLinkModeMessage,this.client.name);const r=await s.getInitialURL();r&&setTimeout(()=>{this.handleLinkModeMessage({url:r})},50)}}}),A(this,"shouldSetTVF",(t,s)=>{if(!s||t!=="wc_sessionRequest")return!1;const{request:r}=s;return Object.keys(ia).includes(r.method)}),A(this,"getTVFParams",(t,s,r)=>{var n,o;try{const a=s.request.method,c=this.extractTxHashesFromResult(a,r);return _e(X({correlationId:t,rpcMethods:[a],chainId:s.chainId},this.isValidContractData(s.request.params)&&{contractAddresses:[(o=(n=s.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),A(this,"isValidContractData",t=>{var s;if(!t)return!1;try{const r=(t==null?void 0:t.data)||((s=t==null?void 0:t[0])==null?void 0:s.data);if(!r.startsWith("0x"))return!1;const n=r.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),A(this,"extractTxHashesFromResult",(t,s)=>{try{const r=ia[t];if(typeof s=="string")return[s];const n=s[r.key];if(Je(n))return t==="solana_signAllTransactions"?n.map(o=>op(o)):n;if(typeof n=="string")return[n]}catch(r){this.client.logger.warn("Error extracting tx hashes from result",r)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[s,r]of Object.entries(t))for(const n of r)try{await this.onProviderMessageEvent({topic:s,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${s}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(pe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:s,attestation:r,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ds)?this.client.auth.authKeys.get(Ds):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,s,{receiverPublicKey:o,encoding:n===ie.link_mode?Et:We});Yr(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:r,transportType:n,encryptedId:st(s)})):Zr(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(t,s)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Be.expired,async e=>{const{topic:t,id:s}=Wa(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,j("EXPIRED"),!0);if(s&&this.client.auth.requests.keys.includes(s))return await this.deletePendingAuthRequest(s,j("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Rt.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Rt.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ne(e,!1)){const{message:t}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Dt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=j("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!ne(e,!1)){const{message:t}=j("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=j("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Dt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=j("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=j("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ne(e,!1)){const{message:t}=j("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=j("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Tf(e)){const{message:t}=j("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=j("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Dt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=j("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class Ov extends Ft{constructor(e,t){super(e,t,dv,pn),this.core=e,this.logger=t}}let Av=class extends Ft{constructor(e,t){super(e,t,fv,pn),this.core=e,this.logger=t}};class xv extends Ft{constructor(e,t){super(e,t,yv,pn,s=>s.id),this.core=e,this.logger=t}}class Tv extends Ft{constructor(e,t){super(e,t,vv,Vs,()=>Ds),this.core=e,this.logger=t}}class Nv extends Ft{constructor(e,t){super(e,t,Dv,Vs),this.core=e,this.logger=t}}class Rv extends Ft{constructor(e,t){super(e,t,Ev,Vs,s=>s.id),this.core=e,this.logger=t}}var jv=Object.defineProperty,kv=(i,e,t)=>e in i?jv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,fr=(i,e,t)=>kv(i,typeof e!="symbol"?e+"":e,t);class qv{constructor(e,t){this.core=e,this.logger=t,fr(this,"authKeys"),fr(this,"pairingTopics"),fr(this,"requests"),this.authKeys=new Tv(this.core,this.logger),this.pairingTopics=new Nv(this.core,this.logger),this.requests=new Rv(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var Lv=Object.defineProperty,Uv=(i,e,t)=>e in i?Lv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,K=(i,e,t)=>Uv(i,typeof e!="symbol"?e+"":e,t);let Bv=class Xc extends Og{constructor(e){super(e),K(this,"protocol",Qc),K(this,"version",Yc),K(this,"name",pr.name),K(this,"metadata"),K(this,"core"),K(this,"logger"),K(this,"events",new $t.EventEmitter),K(this,"engine"),K(this,"session"),K(this,"proposal"),K(this,"pendingRequest"),K(this,"auth"),K(this,"signConfig"),K(this,"on",(s,r)=>this.events.on(s,r)),K(this,"once",(s,r)=>this.events.once(s,r)),K(this,"off",(s,r)=>this.events.off(s,r)),K(this,"removeListener",(s,r)=>this.events.removeListener(s,r)),K(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),K(this,"connect",async s=>{try{return await this.engine.connect(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"pair",async s=>{try{return await this.engine.pair(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"approve",async s=>{try{return await this.engine.approve(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"reject",async s=>{try{return await this.engine.reject(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"update",async s=>{try{return await this.engine.update(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"extend",async s=>{try{return await this.engine.extend(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"request",async s=>{try{return await this.engine.request(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"respond",async s=>{try{return await this.engine.respond(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"ping",async s=>{try{return await this.engine.ping(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"emit",async s=>{try{return await this.engine.emit(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"disconnect",async s=>{try{return await this.engine.disconnect(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"find",s=>{try{return this.engine.find(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),K(this,"authenticate",async(s,r)=>{try{return await this.engine.authenticate(s,r)}catch(n){throw this.logger.error(n.message),n}}),K(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"approveSessionAuthenticate",async s=>{try{return await this.engine.approveSessionAuthenticate(s)}catch(r){throw this.logger.error(r.message),r}}),K(this,"rejectSessionAuthenticate",async s=>{try{return await this.engine.rejectSessionAuthenticate(s)}catch(r){throw this.logger.error(r.message),r}}),this.name=(e==null?void 0:e.name)||pr.name,this.metadata=bu(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ms(un({level:(e==null?void 0:e.logger)||pr.logger}));this.core=(e==null?void 0:e.core)||new pv(e),this.logger=Pe(t,this.name),this.session=new Av(this.core,this.logger),this.proposal=new Ov(this.core,this.logger),this.pendingRequest=new xv(this.core,this.logger),this.engine=new Cv(this),this.auth=new qv(this.core,this.logger)}static async init(e){const t=new Xc(e);return await t.initialize(),t}get context(){return Oe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},k.toMiliseconds(k.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var gr,ra;function Mv(){if(ra)return gr;ra=1;const i=Ia();gr=r;const e=O().console||{},t={mapHttpRequest:f,mapHttpResponse:f,wrapRequestSerializer:m,wrapResponseSerializer:m,wrapErrorSerializer:m,req:f,res:f,err:d};function s(u,g){return Array.isArray(u)?u.filter(function(_){return _!=="!stdSerializers.err"}):u===!0?Object.keys(g):!1}function r(u){u=u||{},u.browser=u.browser||{};const g=u.browser.transmit;if(g&&typeof g.send!="function")throw Error("pino: transmit option must have a send function");const D=u.browser.write||e;u.browser.write&&(u.browser.asObject=!0);const _=u.serializers||{},I=s(u.browser.serialize,_);let S=u.browser.serialize;Array.isArray(u.browser.serialize)&&u.browser.serialize.indexOf("!stdSerializers.err")>-1&&(S=!1);const N=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),u.enabled===!1&&(u.level="silent");const L=u.level||"info",v=Object.create(D);v.log||(v.log=y),Object.defineProperty(v,"levelVal",{get:x}),Object.defineProperty(v,"level",{get:q,set:U});const C={transmit:g,serialize:I,asObject:u.browser.asObject,levels:N,timestamp:b(u)};v.levels=r.levels,v.level=L,v.setMaxListeners=v.getMaxListeners=v.emit=v.addListener=v.on=v.prependListener=v.once=v.prependOnceListener=v.removeListener=v.removeAllListeners=v.listeners=v.listenerCount=v.eventNames=v.write=v.flush=y,v.serializers=_,v._serialize=I,v._stdErrSerialize=S,v.child=T,g&&(v._logEvent=p());function x(){return this.level==="silent"?1/0:this.levels.values[this.level]}function q(){return this._level}function U(R){if(R!=="silent"&&!this.levels.values[R])throw Error("unknown level "+R);this._level=R,n(C,v,"error","log"),n(C,v,"fatal","error"),n(C,v,"warn","error"),n(C,v,"info","log"),n(C,v,"debug","log"),n(C,v,"trace","log")}function T(R,B){if(!R)throw new Error("missing bindings for child Pino");B=B||{},I&&R.serializers&&(B.serializers=R.serializers);const M=B.serializers;if(I&&M){var z=Object.assign({},_,M),F=u.browser.serialize===!0?Object.keys(z):I;delete R.serializers,c([R],F,z,this._stdErrSerialize)}function ee(V){this._childLevel=(V._childLevel|0)+1,this.error=l(V,R,"error"),this.fatal=l(V,R,"fatal"),this.warn=l(V,R,"warn"),this.info=l(V,R,"info"),this.debug=l(V,R,"debug"),this.trace=l(V,R,"trace"),z&&(this.serializers=z,this._serialize=F),g&&(this._logEvent=p([].concat(V._logEvent.bindings,R)))}return ee.prototype=this,new ee(this)}return v}r.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},r.stdSerializers=t,r.stdTimeFunctions=Object.assign({},{nullTime:E,epochTime:w,unixTime:P,isoTime:$});function n(u,g,D,_){const I=Object.getPrototypeOf(g);g[D]=g.levelVal>g.levels.values[D]?y:I[D]?I[D]:e[D]||e[_]||y,o(u,g,D)}function o(u,g,D){!u.transmit&&g[D]===y||(g[D]=(function(_){return function(){const S=u.timestamp(),N=new Array(arguments.length),L=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var v=0;v<N.length;v++)N[v]=arguments[v];if(u.serialize&&!u.asObject&&c(N,this._serialize,this.serializers,this._stdErrSerialize),u.asObject?_.call(L,a(this,D,N,S)):_.apply(L,N),u.transmit){const C=u.transmit.level||g.level,x=r.levels.values[C],q=r.levels.values[D];if(q<x)return;h(this,{ts:S,methodLevel:D,methodValue:q,transmitValue:r.levels.values[u.transmit.level||g.level],send:u.transmit.send,val:g.levelVal},N)}}})(g[D]))}function a(u,g,D,_){u._serialize&&c(D,u._serialize,u.serializers,u._stdErrSerialize);const I=D.slice();let S=I[0];const N={};_&&(N.time=_),N.level=r.levels.values[g];let L=(u._childLevel|0)+1;if(L<1&&(L=1),S!==null&&typeof S=="object"){for(;L--&&typeof I[0]=="object";)Object.assign(N,I.shift());S=I.length?i(I.shift(),I):void 0}else typeof S=="string"&&(S=i(I.shift(),I));return S!==void 0&&(N.msg=S),N}function c(u,g,D,_){for(const I in u)if(_&&u[I]instanceof Error)u[I]=r.stdSerializers.err(u[I]);else if(typeof u[I]=="object"&&!Array.isArray(u[I]))for(const S in u[I])g&&g.indexOf(S)>-1&&S in D&&(u[I][S]=D[S](u[I][S]))}function l(u,g,D){return function(){const _=new Array(1+arguments.length);_[0]=g;for(var I=1;I<_.length;I++)_[I]=arguments[I-1];return u[D].apply(this,_)}}function h(u,g,D){const _=g.send,I=g.ts,S=g.methodLevel,N=g.methodValue,L=g.val,v=u._logEvent.bindings;c(D,u._serialize||Object.keys(u.serializers),u.serializers,u._stdErrSerialize===void 0?!0:u._stdErrSerialize),u._logEvent.ts=I,u._logEvent.messages=D.filter(function(C){return v.indexOf(C)===-1}),u._logEvent.level.label=S,u._logEvent.level.value=N,_(S,u._logEvent,L),u._logEvent=p(v)}function p(u){return{ts:0,messages:[],bindings:u||[],level:{label:"",value:0}}}function d(u){const g={type:u.constructor.name,msg:u.message,stack:u.stack};for(const D in u)g[D]===void 0&&(g[D]=u[D]);return g}function b(u){return typeof u.timestamp=="function"?u.timestamp:u.timestamp===!1?E:w}function f(){return{}}function m(u){return u}function y(){}function E(){return!1}function w(){return Date.now()}function P(){return Math.round(Date.now()/1e3)}function $(){return new Date(Date.now()).toISOString()}function O(){function u(g){return typeof g<"u"&&g}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return u(self)||u(window)||u(this)||{}}}return gr}var zv=Mv();const Fv=$a(zv),Vv={level:"info"};var Hv=Object.defineProperty,Kv=Object.defineProperties,Gv=Object.getOwnPropertyDescriptors,na=Object.getOwnPropertySymbols,Wv=Object.prototype.hasOwnProperty,Jv=Object.prototype.propertyIsEnumerable,oa=(i,e,t)=>e in i?Hv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Qv=(i,e)=>{for(var t in e||(e={}))Wv.call(e,t)&&oa(i,t,e[t]);if(na)for(var t of na(e))Jv.call(e,t)&&oa(i,t,e[t]);return i},Yv=(i,e)=>Kv(i,Gv(e));function Zv(i){return Yv(Qv({},i),{level:(i==null?void 0:i.level)||Vv.level})}const aa="error",Xv="wss://relay.walletconnect.org",eD="wc",tD="universal_provider",ds=`${eD}@2:${tD}:`,el="https://rpc.walletconnect.org/v1/",ci="generic",iD=`${el}bundler`,Fe={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function sD(){}function dn(i){return i==null||typeof i!="object"&&typeof i!="function"}function fn(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function rD(i){if(dn(i))return i;if(Array.isArray(i)||fn(i)||i instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&i instanceof SharedArrayBuffer)return i.slice(0);const e=Object.getPrototypeOf(i),t=e.constructor;if(i instanceof Date||i instanceof Map||i instanceof Set)return new t(i);if(i instanceof RegExp){const s=new t(i);return s.lastIndex=i.lastIndex,s}if(i instanceof DataView)return new t(i.buffer.slice(0));if(i instanceof Error){const s=new t(i.message);return s.stack=i.stack,s.name=i.name,s.cause=i.cause,s}if(typeof File<"u"&&i instanceof File)return new t([i],i.name,{type:i.type,lastModified:i.lastModified});if(typeof i=="object"){const s=Object.create(e);return Object.assign(s,i)}return i}function ca(i){return typeof i=="object"&&i!==null}function tl(i){return Object.getOwnPropertySymbols(i).filter(e=>Object.prototype.propertyIsEnumerable.call(i,e))}function il(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}const nD="[object RegExp]",sl="[object String]",rl="[object Number]",nl="[object Boolean]",ol="[object Arguments]",oD="[object Symbol]",aD="[object Date]",cD="[object Map]",lD="[object Set]",hD="[object Array]",uD="[object ArrayBuffer]",pD="[object Object]",dD="[object DataView]",fD="[object Uint8Array]",gD="[object Uint8ClampedArray]",yD="[object Uint16Array]",mD="[object Uint32Array]",wD="[object Int8Array]",bD="[object Int16Array]",vD="[object Int32Array]",DD="[object Float32Array]",ED="[object Float64Array]";function _D(i,e){return pi(i,void 0,i,new Map,e)}function pi(i,e,t,s=new Map,r=void 0){const n=r==null?void 0:r(i,e,t,s);if(n!=null)return n;if(dn(i))return i;if(s.has(i))return s.get(i);if(Array.isArray(i)){const o=new Array(i.length);s.set(i,o);for(let a=0;a<i.length;a++)o[a]=pi(i[a],a,t,s,r);return Object.hasOwn(i,"index")&&(o.index=i.index),Object.hasOwn(i,"input")&&(o.input=i.input),o}if(i instanceof Date)return new Date(i.getTime());if(i instanceof RegExp){const o=new RegExp(i.source,i.flags);return o.lastIndex=i.lastIndex,o}if(i instanceof Map){const o=new Map;s.set(i,o);for(const[a,c]of i)o.set(a,pi(c,a,t,s,r));return o}if(i instanceof Set){const o=new Set;s.set(i,o);for(const a of i)o.add(pi(a,void 0,t,s,r));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(i))return i.subarray();if(fn(i)){const o=new(Object.getPrototypeOf(i)).constructor(i.length);s.set(i,o);for(let a=0;a<i.length;a++)o[a]=pi(i[a],a,t,s,r);return o}if(i instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&i instanceof SharedArrayBuffer)return i.slice(0);if(i instanceof DataView){const o=new DataView(i.buffer.slice(0),i.byteOffset,i.byteLength);return s.set(i,o),jt(o,i,t,s,r),o}if(typeof File<"u"&&i instanceof File){const o=new File([i],i.name,{type:i.type});return s.set(i,o),jt(o,i,t,s,r),o}if(i instanceof Blob){const o=new Blob([i],{type:i.type});return s.set(i,o),jt(o,i,t,s,r),o}if(i instanceof Error){const o=new i.constructor;return s.set(i,o),o.message=i.message,o.name=i.name,o.stack=i.stack,o.cause=i.cause,jt(o,i,t,s,r),o}if(typeof i=="object"&&ID(i)){const o=Object.create(Object.getPrototypeOf(i));return s.set(i,o),jt(o,i,t,s,r),o}return i}function jt(i,e,t=i,s,r){const n=[...Object.keys(e),...tl(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(i,a);(c==null||c.writable)&&(i[a]=pi(e[a],a,t,s,r))}}function ID(i){switch(il(i)){case ol:case hD:case uD:case dD:case nl:case aD:case DD:case ED:case wD:case bD:case vD:case cD:case rl:case pD:case nD:case lD:case sl:case oD:case fD:case gD:case yD:case mD:return!0;default:return!1}}function PD(i,e){return _D(i,(t,s,r,n)=>{if(typeof i=="object")switch(Object.prototype.toString.call(i)){case rl:case sl:case nl:{const o=new i.constructor(i==null?void 0:i.valueOf());return jt(o,i),o}case ol:{const o={};return jt(o,i),o.length=i.length,o[Symbol.iterator]=i[Symbol.iterator],o}default:return}})}function la(i){return PD(i)}function ha(i){return i!==null&&typeof i=="object"&&il(i)==="[object Arguments]"}function $D(i){return fn(i)}function SD(i){var t;if(typeof i!="object"||i==null)return!1;if(Object.getPrototypeOf(i)===null)return!0;if(Object.prototype.toString.call(i)!=="[object Object]"){const s=i[Symbol.toStringTag];return s==null||!((t=Object.getOwnPropertyDescriptor(i,Symbol.toStringTag))!=null&&t.writable)?!1:i.toString()===`[object ${s}]`}let e=i;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e}function CD(i,...e){const t=e.slice(0,-1),s=e[e.length-1];let r=i;for(let n=0;n<t.length;n++){const o=t[n];r=Gr(r,o,s,new Map)}return r}function Gr(i,e,t,s){if(dn(i)&&(i=Object(i)),e==null||typeof e!="object")return i;if(s.has(e))return rD(s.get(e));if(s.set(e,i),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const r=[...Object.keys(e),...tl(e)];for(let n=0;n<r.length;n++){const o=r[n];let a=e[o],c=i[o];if(ha(a)&&(a={...a}),ha(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=la(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const h=[],p=Reflect.ownKeys(c);for(let d=0;d<p.length;d++){const b=p[d];h[b]=c[b]}c=h}else c=[];const l=t(c,a,o,i,e,s);l!=null?i[o]=l:Array.isArray(a)||ca(c)&&ca(a)?i[o]=Gr(c,a,t,s):c==null&&SD(a)?i[o]=Gr({},a,t,s):c==null&&$D(a)?i[o]=la(a):(c===void 0||a!==void 0)&&(i[o]=a)}return i}function OD(i,...e){return CD(i,...e,sD)}var AD=Object.defineProperty,xD=Object.defineProperties,TD=Object.getOwnPropertyDescriptors,ua=Object.getOwnPropertySymbols,ND=Object.prototype.hasOwnProperty,RD=Object.prototype.propertyIsEnumerable,pa=(i,e,t)=>e in i?AD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,fs=(i,e)=>{for(var t in e||(e={}))ND.call(e,t)&&pa(i,t,e[t]);if(ua)for(var t of ua(e))RD.call(e,t)&&pa(i,t,e[t]);return i},jD=(i,e)=>xD(i,TD(e));function qe(i,e,t){var s;const r=di(i);return((s=e.rpcMap)==null?void 0:s[r.reference])||`${el}?chainId=${r.namespace}:${r.reference}&projectId=${t}`}function Vt(i){return i.includes(":")?i.split(":")[1]:i}function al(i){return i.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function kD(i,e){const t=Object.keys(e.namespaces).filter(r=>r.includes(i));if(!t.length)return[];const s=[];return t.forEach(r=>{const n=e.namespaces[r].accounts;s.push(...n)}),s}function gs(i={},e={}){const t=da(i),s=da(e);return OD(t,s)}function da(i){var e,t,s,r,n;const o={};if(!Pt(i))return o;for(const[a,c]of Object.entries(i)){const l=Bs(a)?[a]:c.chains,h=c.methods||[],p=c.events||[],d=c.rpcMap||{},b=ui(a);o[b]=jD(fs(fs({},o[b]),c),{chains:rt(l,(e=o[b])==null?void 0:e.chains),methods:rt(h,(t=o[b])==null?void 0:t.methods),events:rt(p,(s=o[b])==null?void 0:s.events)}),(Pt(d)||Pt(((r=o[b])==null?void 0:r.rpcMap)||{}))&&(o[b].rpcMap=fs(fs({},d),(n=o[b])==null?void 0:n.rpcMap))}return o}function fa(i){return i.includes(":")?i.split(":")[2]:i}function ga(i){const e={};for(const[t,s]of Object.entries(i)){const r=s.methods||[],n=s.events||[],o=s.accounts||[],a=Bs(t)?[t]:s.chains?s.chains:al(s.accounts);e[t]={chains:a,methods:r,events:n,accounts:o}}return e}function yr(i){return typeof i=="number"?i:i.includes("0x")?parseInt(i,16):(i=i.includes(":")?i.split(":")[1]:i,isNaN(Number(i))?i:Number(i))}const cl={},J=i=>cl[i],mr=(i,e)=>{cl[i]=e};var qD=Object.defineProperty,LD=(i,e,t)=>e in i?qD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Qt=(i,e,t)=>LD(i,typeof e!="symbol"?e+"":e,t);class UD{constructor(e){Qt(this,"name","polkadot"),Qt(this,"client"),Qt(this,"httpProviders"),Qt(this,"events"),Qt(this,"namespace"),Qt(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const r=Vt(t);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}}var BD=Object.defineProperty,MD=Object.defineProperties,zD=Object.getOwnPropertyDescriptors,ya=Object.getOwnPropertySymbols,FD=Object.prototype.hasOwnProperty,VD=Object.prototype.propertyIsEnumerable,Wr=(i,e,t)=>e in i?BD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ma=(i,e)=>{for(var t in e||(e={}))FD.call(e,t)&&Wr(i,t,e[t]);if(ya)for(var t of ya(e))VD.call(e,t)&&Wr(i,t,e[t]);return i},wa=(i,e)=>MD(i,zD(e)),Yt=(i,e,t)=>Wr(i,typeof e!="symbol"?e+"":e,t);class HD{constructor(e){Yt(this,"name","eip155"),Yt(this,"client"),Yt(this,"chainId"),Yt(this,"namespace"),Yt(this,"httpProviders"),Yt(this,"events"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const s=t||qe(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const r=parseInt(Vt(t));e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,s;let r=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";r=r.startsWith("0x")?r:`0x${r}`;const n=parseInt(r,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:r}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,s,r,n,o;const a=(s=(t=e.request)==null?void 0:t.params)==null?void 0:s[0],c=((n=(r=e.request)==null?void 0:r.params)==null?void 0:n[1])||[],l=`${a}${c.join(",")}`;if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const h=this.client.session.get(e.topic),p=((o=h==null?void 0:h.sessionProperties)==null?void 0:o.capabilities)||{};if(p!=null&&p[l])return p==null?void 0:p[l];const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:wa(ma({},h.sessionProperties||{}),{capabilities:wa(ma({},p||{}),{[l]:d})})})}catch(b){console.warn("Failed to update session with capabilities",b)}return d}async getCallStatus(e){var t,s;const r=this.client.session.get(e.topic),n=(t=r.sessionProperties)==null?void 0:t.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(s=r.sessionProperties)==null?void 0:s.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var s;const r=new URL(e),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(kt("eth_getUserOperationReceipt",[(s=t.request.params)==null?void 0:s[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${iD}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var KD=Object.defineProperty,GD=(i,e,t)=>e in i?KD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Zt=(i,e,t)=>GD(i,typeof e!="symbol"?e+"":e,t);class WD{constructor(e){Zt(this,"name","solana"),Zt(this,"client"),Zt(this,"httpProviders"),Zt(this,"events"),Zt(this,"namespace"),Zt(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const r=Vt(t);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}}var JD=Object.defineProperty,QD=(i,e,t)=>e in i?JD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Xt=(i,e,t)=>QD(i,typeof e!="symbol"?e+"":e,t);class YD{constructor(e){Xt(this,"name","cosmos"),Xt(this,"client"),Xt(this,"httpProviders"),Xt(this,"events"),Xt(this,"namespace"),Xt(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const r=Vt(t);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}}var ZD=Object.defineProperty,XD=(i,e,t)=>e in i?ZD(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ei=(i,e,t)=>XD(i,typeof e!="symbol"?e+"":e,t);class eE{constructor(e){ei(this,"name","algorand"),ei(this,"client"),ei(this,"httpProviders"),ei(this,"events"),ei(this,"namespace"),ei(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const s=t||qe(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new ze(new Qe(s,J("disableProviderPing")))}}var tE=Object.defineProperty,iE=(i,e,t)=>e in i?tE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ti=(i,e,t)=>iE(i,typeof e!="symbol"?e+"":e,t);class sE{constructor(e){ti(this,"name","cip34"),ti(this,"client"),ti(this,"httpProviders"),ti(this,"events"),ti(this,"namespace"),ti(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const s=this.getCardanoRPCUrl(t),r=Vt(t);e[r]=this.createHttpProvider(r,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}}var rE=Object.defineProperty,nE=(i,e,t)=>e in i?rE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ii=(i,e,t)=>nE(i,typeof e!="symbol"?e+"":e,t);class oE{constructor(e){ii(this,"name","elrond"),ii(this,"client"),ii(this,"httpProviders"),ii(this,"events"),ii(this,"namespace"),ii(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const r=Vt(t);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}}var aE=Object.defineProperty,cE=(i,e,t)=>e in i?aE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,si=(i,e,t)=>cE(i,typeof e!="symbol"?e+"":e,t);class lE{constructor(e){si(this,"name","multiversx"),si(this,"client"),si(this,"httpProviders"),si(this,"events"),si(this,"namespace"),si(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const r=Vt(t);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}}var hE=Object.defineProperty,uE=(i,e,t)=>e in i?hE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ri=(i,e,t)=>uE(i,typeof e!="symbol"?e+"":e,t);class pE{constructor(e){ri(this,"name","near"),ri(this,"client"),ri(this,"httpProviders"),ri(this,"events"),ri(this,"namespace"),ri(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const s=t||qe(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace);return typeof s>"u"?void 0:new ze(new Qe(s,J("disableProviderPing")))}}var dE=Object.defineProperty,fE=(i,e,t)=>e in i?dE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ni=(i,e,t)=>fE(i,typeof e!="symbol"?e+"":e,t);class gE{constructor(e){ni(this,"name","tezos"),ni(this,"client"),ni(this,"httpProviders"),ni(this,"events"),ni(this,"namespace"),ni(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const s=t||qe(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace);return typeof s>"u"?void 0:new ze(new Qe(s))}}var yE=Object.defineProperty,mE=(i,e,t)=>e in i?yE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,oi=(i,e,t)=>mE(i,typeof e!="symbol"?e+"":e,t);class wE{constructor(e){oi(this,"name",ci),oi(this,"client"),oi(this,"httpProviders"),oi(this,"events"),oi(this,"namespace"),oi(this,"chainId"),this.namespace=e.namespace,this.events=J("events"),this.client=J("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Fe.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const s={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(r=>{const n=di(r);s[`${n.namespace}:${n.reference}`]=this.createHttpProvider(r)}),s}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||qe(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ze(new Qe(s,J("disableProviderPing")))}}var bE=Object.defineProperty,vE=Object.defineProperties,DE=Object.getOwnPropertyDescriptors,ba=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,_E=Object.prototype.propertyIsEnumerable,Jr=(i,e,t)=>e in i?bE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ys=(i,e)=>{for(var t in e||(e={}))EE.call(e,t)&&Jr(i,t,e[t]);if(ba)for(var t of ba(e))_E.call(e,t)&&Jr(i,t,e[t]);return i},wr=(i,e)=>vE(i,DE(e)),Ue=(i,e,t)=>Jr(i,typeof e!="symbol"?e+"":e,t);let IE=class ll{constructor(e){Ue(this,"client"),Ue(this,"namespaces"),Ue(this,"optionalNamespaces"),Ue(this,"sessionProperties"),Ue(this,"scopedProperties"),Ue(this,"events",new Xr),Ue(this,"rpcProviders",{}),Ue(this,"session"),Ue(this,"providerOpts"),Ue(this,"logger"),Ue(this,"uri"),Ue(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Fv(Zv({level:(e==null?void 0:e.logger)||aa})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new ll(e);return await t.initialize(),t}async request(e,t,s){const[r,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:ys({},e),chainId:`${r}:${n}`,topic:this.session.topic,expiry:s})}sendAsync(e,t,s,r){const n=new Date().getTime();this.request(e,s,r).then(o=>t(null,Ts(n,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Y("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:s,response:r}=await this.client.authenticate(e,t);s&&(this.uri=s,this.events.emit("display_uri",s));const n=await r();if(this.session=n.session,this.session){const o=ga(this.session.namespaces);this.namespaces=gs(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const r=await s();this.session=r;const n=ga(r.namespaces);return this.namespaces=gs(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[s,r]=this.validateChain(e),n=this.getProvider(s);n.name===ci?n.setDefaultChain(`${s}:${r}`,t):n.setDefaultChain(r,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Je(t)){for(const s of t)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await Bv.init({core:this.providerOpts.core,logger:this.providerOpts.logger||aa,relayUrl:this.providerOpts.relayUrl||Xv,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(s){throw this.logger.error("Failed to get session",s),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const s=this.client.session.getAll();this.session=s[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>ui(t)))];mr("client",this.client),mr("events",this.events),mr("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const s=kD(t,this.session),r=al(s),n=gs(this.namespaces,this.optionalNamespaces),o=wr(ys({},n[t]),{accounts:s,chains:r});switch(t){case"eip155":this.rpcProviders[t]=new HD({namespace:o});break;case"algorand":this.rpcProviders[t]=new eE({namespace:o});break;case"solana":this.rpcProviders[t]=new WD({namespace:o});break;case"cosmos":this.rpcProviders[t]=new YD({namespace:o});break;case"polkadot":this.rpcProviders[t]=new UD({namespace:o});break;case"cip34":this.rpcProviders[t]=new sE({namespace:o});break;case"elrond":this.rpcProviders[t]=new oE({namespace:o});break;case"multiversx":this.rpcProviders[t]=new lE({namespace:o});break;case"near":this.rpcProviders[t]=new pE({namespace:o});break;case"tezos":this.rpcProviders[t]=new gE({namespace:o});break;default:this.rpcProviders[ci]?this.rpcProviders[ci].updateNamespace(o):this.rpcProviders[ci]=new wE({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:s}=e;s===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:s,topic:r}=e;if(r!==((t=this.session)==null?void 0:t.topic))return;const{event:n}=s;if(n.name==="accountsChanged"){const o=n.data;o&&Je(o)&&this.events.emit("accountsChanged",o.map(fa))}else if(n.name==="chainChanged"){const o=s.chainId,a=s.event.data,c=ui(o),l=yr(o)!==yr(a)?`${c}:${yr(a)}`:o;this.onChainChanged(l)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var s,r;if(e!==((s=this.session)==null?void 0:s.topic))return;const{namespaces:n}=t,o=(r=this.client)==null?void 0:r.session.get(e);this.session=wr(ys({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",wr(ys({},Y("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Fe.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[ci]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:s={},sessionProperties:r,scopedProperties:n}=e;this.optionalNamespaces=gs(t,s),this.sessionProperties=r,this.scopedProperties=n}validateChain(e){const[t,s]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,s];if(t&&!Object.keys(this.namespaces||{}).map(o=>ui(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&s)return[t,s];const r=ui(Object.keys(this.namespaces)[0]),n=this.rpcProviders[r].getDefaultChain();return[r,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[s,r]=this.validateChain(e);if(!r)return;this.updateNamespaceChain(s,r),this.events.emit("chainChanged",r);const n=this.getProvider(s).getDefaultChain();t||this.getProvider(s).setDefaultChain(r),this.emitAccountsChangedOnChainChange({namespace:s,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:s}){var r,n;try{if(t===s)return;const o=(n=(r=this.session)==null?void 0:r.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${s}:`)).map(fa);if(!Je(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const s=this.namespaces[e]?e:`${e}:${t}`,r={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[s]?this.namespaces[s]&&(this.namespaces[s].defaultChain=t):this.namespaces[s]=r}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var s;const r=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.setItem(`${ds}/${e}${r}`,t)}async getFromStore(e){var t;const s=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${ds}/${e}${s}`)}async deleteFromStore(e){var t;const s=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${ds}/${e}${s}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const s of t)s.startsWith(ds)&&await this.client.core.storage.removeItem(s)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}};const PE=IE,$E="wc",SE="ethereum_provider",CE=`${$E}@2:${SE}:`,OE="https://rpc.walletconnect.org/v1/",Os=["eth_sendTransaction","personal_sign"],hl=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],As=["chainChanged","accountsChanged"],ul=["chainChanged","accountsChanged","message","disconnect","connect"],AE=async()=>{const{createAppKit:i}=await _a(()=>import("./core-CNuiOGJ9.js").then(e=>e.J),__vite__mapDeps([4,1,2,3]));return i};var xE=Object.defineProperty,TE=Object.defineProperties,NE=Object.getOwnPropertyDescriptors,va=Object.getOwnPropertySymbols,RE=Object.prototype.hasOwnProperty,jE=Object.prototype.propertyIsEnumerable,Qr=(i,e,t)=>e in i?xE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Tt=(i,e)=>{for(var t in e||(e={}))RE.call(e,t)&&Qr(i,t,e[t]);if(va)for(var t of va(e))jE.call(e,t)&&Qr(i,t,e[t]);return i},qi=(i,e)=>TE(i,NE(e)),xe=(i,e,t)=>Qr(i,typeof e!="symbol"?e+"":e,t);function xs(i){return Number(i[0].split(":")[1])}function ms(i){return`0x${i.toString(16)}`}function kE(i){const{chains:e,optionalChains:t,methods:s,optionalMethods:r,events:n,optionalEvents:o,rpcMap:a}=i;if(!Je(e))throw new Error("Invalid chains");const c={chains:e,methods:s||Os,events:n||As,rpcMap:Tt({},e.length?{[xs(e)]:a[xs(e)]}:{})},l=n==null?void 0:n.filter(b=>!As.includes(b)),h=s==null?void 0:s.filter(b=>!Os.includes(b));if(!t&&!o&&!r&&!(l!=null&&l.length)&&!(h!=null&&h.length))return{required:e.length?c:void 0};const p=(l==null?void 0:l.length)&&(h==null?void 0:h.length)||!t,d={chains:[...new Set(p?c.chains.concat(t||[]):t)],methods:[...new Set(c.methods.concat(r!=null&&r.length?r:hl))],events:[...new Set(c.events.concat(o!=null&&o.length?o:ul))],rpcMap:a};return{required:e.length?c:void 0,optional:t.length?d:void 0}}class Hs{constructor(){xe(this,"events",new $t.EventEmitter),xe(this,"namespace","eip155"),xe(this,"accounts",[]),xe(this,"signer"),xe(this,"chainId",1),xe(this,"modal"),xe(this,"rpc"),xe(this,"STORAGE_KEY",CE),xe(this,"on",(e,t)=>(this.events.on(e,t),this)),xe(this,"once",(e,t)=>(this.events.once(e,t),this)),xe(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),xe(this,"off",(e,t)=>(this.events.off(e,t),this)),xe(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new Hs;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,s){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),s)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:s,optional:r}=kE(this.rpc);try{const n=await new Promise(async(a,c)=>{var l,h;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(h=this.modal)==null||h.subscribeState(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const p=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(qi(Tt({namespaces:Tt({},s&&{[this.namespace]:s})},r&&{optionalNamespaces:{[this.namespace]:r}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:p})).then(d=>{a(d)}).catch(d=>{var b;(b=this.modal)==null||b.showErrorMessage("Unable to connect"),c(new Error(d.message))})});if(!n)return;const o=Cn(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:ms(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{(t=this.modal)==null||t.close()}}async authenticate(e,t){var s;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const r=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(qi(Tt({},e),{chains:this.rpc.chains}),t).then(h=>{o(h)}).catch(h=>{var p;(p=this.modal)==null||p.showErrorMessage("Unable to connect"),a(new Error(h.message))})}),n=r.session;if(n){const o=Cn(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:ms(this.chainId)})}return r}catch(r){throw this.signer.logger.error(r),r}finally{(s=this.modal)==null||s.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:s}=t;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",ms(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",qi(Tt({},Y("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",ms(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,s,r]=e.split(":");return{chainId:`${t}:${s}`,address:r}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,s;const r=(t=e==null?void 0:e.chains)!=null?t:[],n=(s=e==null?void 0:e.optionalChains)!=null?s:[],o=r.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=r.length?(e==null?void 0:e.methods)||Os:[],c=r.length?(e==null?void 0:e.events)||As:[],l=(e==null?void 0:e.optionalMethods)||[],h=(e==null?void 0:e.optionalEvents)||[],p=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),d=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:r==null?void 0:r.map(b=>this.formatChainId(b)),optionalChains:n.map(b=>this.formatChainId(b)),methods:a,events:c,optionalMethods:l,optionalEvents:h,rpcMap:p,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:d,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const s={};return e.forEach(r=>{s[r]=this.getRpcUrl(r,t)}),s}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?xs(this.rpc.chains):xs(this.rpc.optionalChains),this.signer=await PE.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const s=await AE(),{convertWCMToAppKitOptions:r}=await Promise.resolve().then(function(){return GE}),n=r(qi(Tt({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!n.networks.length)throw new Error("No networks found for WalletConnectÂ·");t=s(qi(Tt({},n),{universalProvider:this.signer,manualWCControl:!0}))}catch(s){throw console.warn(s),new Error("To use QR modal, please install @reown/appkit package")}if(t)try{this.modal=t}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:s,rpcMap:r}=e;t&&Je(t)&&(this.rpc.chains=t.map(n=>this.formatChainId(n)),t.forEach(n=>{this.rpc.rpcMap[n]=(r==null?void 0:r[n])||this.getRpcUrl(n)})),s&&Je(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(n=>this.formatChainId(n)),s.forEach(n=>{this.rpc.rpcMap[n]=(r==null?void 0:r[n])||this.getRpcUrl(n)}))}getRpcUrl(e,t){var s;return((s=this.rpc.rpcMap)==null?void 0:s[e])||`${OE}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const qE=Hs;var LE=Object.defineProperty,UE=Object.defineProperties,BE=Object.getOwnPropertyDescriptors,Da=Object.getOwnPropertySymbols,ME=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable,Ea=(i,e,t)=>e in i?LE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,pl=(i,e)=>{for(var t in e||(e={}))ME.call(e,t)&&Ea(i,t,e[t]);if(Da)for(var t of Da(e))zE.call(e,t)&&Ea(i,t,e[t]);return i},FE=(i,e)=>UE(i,BE(e));function VE(i){if(i)return{"--w3m-font-family":i["--wcm-font-family"],"--w3m-accent":i["--wcm-accent-color"],"--w3m-color-mix":i["--wcm-background-color"],"--w3m-z-index":i["--wcm-z-index"]?Number(i["--wcm-z-index"]):void 0,"--w3m-qr-color":i["--wcm-accent-color"],"--w3m-font-size-master":i["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":i["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const HE=i=>{const[e,t]=i.split(":");return dl({id:t,caipNetworkId:i,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function KE(i){var e,t,s,r,n,o,a;const c=(e=i.chains)==null?void 0:e.map(HE).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(p=>{var d;return p.id===((d=i.defaultChain)==null?void 0:d.id)}),h={projectId:i.projectId,networks:c,themeMode:i.themeMode,themeVariables:VE(i.themeVariables),chainImages:i.chainImages,connectorImages:i.walletImages,defaultNetwork:l,metadata:FE(pl({},i.metadata),{name:((t=i.metadata)==null?void 0:t.name)||"WalletConnect",description:((s=i.metadata)==null?void 0:s.description)||"Connect to WalletConnect-compatible wallets",url:((r=i.metadata)==null?void 0:r.url)||"https://walletconnect.org",icons:((n=i.metadata)==null?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:i.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(i.explorerRecommendedWalletIds)?i.explorerRecommendedWalletIds:[],excludeWalletIds:i.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(i.explorerExcludedWalletIds)?i.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=i.mobileWallets)!=null&&o.length||(a=i.desktopWallets)!=null&&a.length){const p=[...(i.mobileWallets||[]).map(f=>({id:f.id,name:f.name,links:f.links})),...(i.desktopWallets||[]).map(f=>({id:f.id,name:f.name,links:{native:f.links.native,universal:f.links.universal}}))],d=[...h.featuredWalletIds||[],...h.excludeWalletIds||[]],b=p.filter(f=>!d.includes(f.id));b.length&&(h.customWallets=b)}return h}function dl(i){return pl({formatters:void 0,fees:void 0,serializers:void 0},i)}var GE=Object.freeze({__proto__:null,convertWCMToAppKitOptions:KE,defineChain:dl});const S0=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:qE,OPTIONAL_EVENTS:ul,OPTIONAL_METHODS:hl,REQUIRED_EVENTS:As,REQUIRED_METHODS:Os,default:Hs},Symbol.toStringTag,{value:"Module"}));export{Gl as H,bn as a,ql as b,ZE as c,YE as d,Ns as e,t0 as f,e0 as g,S0 as i,XE as r,Ra as t,Wl as w};
